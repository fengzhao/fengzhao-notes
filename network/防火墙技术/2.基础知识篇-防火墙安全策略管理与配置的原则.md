# 安全策略管理与配置的原则

https://support.huawei.com/enterprise/zh/doc/EDOC1100164709



作为防火墙的管理员，你面临着巨大的挑战。业务要求网络提供快速的连接，日益活跃的网络犯罪威胁着业务的安全，你需要在性能与安全之间寻求平衡。

安全策略的配置和管理，无疑是一个关键的问题。根据咨询公司Gartner的报告，99%的防火墙问题是由误配置导致的。

在开始配置安全策略之前，请了解这些原则性建议。遵循这些最佳实践，不仅是为了保证你正确地配置安全策略，还可以为后续的管理和维护提供方便。





## 建立完善的安全策略管理流程



安全策略管理流程是信息安全策略（Information Security Policy）的组成部分。它并不是具体的技术指导，而是保证技术为业务服务的管理方法。

最开始的时候，每一台防火墙的安全策略都比较简单。然而，新的服务，新的设备，都可能需要新的安全策略。

安全策略列表日益庞大，变更和管理的复杂度都大幅提升。组织需要建立一个审核和测试所有策略申请的流程，并严格执行。

策略管理流程可以根据业务需要来微调，通常应该考虑以下内容，以确保新增和修改是合理的、有据可查的。



1、业务方申请人发起新增安全策略请求，说明需要添加什么样的安全策略。业务主管评估安全策略的必要性以后，提交给安全团队。









# 什么是安全策略？



安全策略（Security Policy）在安全领域具有双重含义。

宏观上，安全策略指的是一个组织为保证其信息安全而建立的一套安全需求、控制措施和流程要求。它不仅建立了信息安全的总体目标，定义了信息安全的管理结构，还提出了对组织成员的安全要求。这种安全策略通常以文档的形式存在，属于企业治理范畴。

具体到防火墙产品上，安全策略指的是用于保护网络的规则。它是由管理员在系统中配置，决定了哪些流量可以通过，哪些流量应该被阻断。安全策略是防火墙产品的一个基本概念和核心功能。防火墙通过安全策略来提供业务管控能力，以保证网络的安全。

为了避免歧义，通常把针对一个组织的安全策略称为信息安全策略（Information Security Policy），而把后者称为防火墙安全策略（Firewall Security Policy，有时也简称为防火墙策略Firewall Policy）、防火墙规则（Firewall Rule）。在本文档中，我们主要介绍防火墙安全策略，并简称为安全策略。



## 安全策略的组成

每一条安全策略都是由匹配条件和动作组成的规则。防火墙接收到报文以后，将报文的属性与安全策略的匹配条件进行匹配。

如果所有条件都匹配，则此报文成功匹配安全策略，防火墙按照该安全策略的动作处理这个报文及其后续双向流量。

因此，安全策略的核心元素是匹配条件和动作。



### 匹配条件

安全策略的匹配条件描述了流量的特征，用于筛选出符合条件的流量。安全策略的匹配条件包括以下要素。

- 谁：谁发出的流量，即用户。在Agile Controller单点登录场景下，还可以指定用户的接入方式、用户使用的终端设备类型。
- 从哪里来，到哪里去：流量的来源和目的，包括源/目的安全区域、源/目的IP地址、源/目的地区和VLAN。地区本质上是IP地址在地理区域上的映射。
- 干什么：访问的服务、应用或者URL分类。
- 什么时候：即时间段。

以上匹配条件，在一条安全策略中都是可选配置；但是一旦配置了，就必须全部符合才认为匹配，即这些匹配条件之间是“与”的关系。一个匹配条件中如果配置了多个值，多个值之间是“或”的关系，只要流量匹配了其中任意一个值，就认为匹配了这个条件。

一条安全策略中的匹配条件越具体，其所描述的流量越精确。你可以只使用五元组（源/目的IP地址、端口、协议）作为匹配条件，也可以利用防火墙的应用识别、用户识别能力，更精确、更方便地配置安全策略。

### 动作

安全策略的基本动作有两个：允许和禁止，即流量能否通过。

- 如果动作为允许，你还可以对此符合此策略的流量执行进一步的内容安全检查。华为防火墙的内容安全检查功能包括反病毒AV、入侵防御IPS、URL过滤、文件过滤、内容过滤、应用行为控制、邮件过滤、APT防御、DNS过滤等。每项内容安全检查都有各自的适用场景和处理动作。防火墙如何处理流量，由所有内容安全检查的结果共同决定。
- 如果动作为禁止，你还可以选择发送向服务端或客户端反馈报文，快速结束会话，减少系统资源消耗。

用户、终端设备、时间段、地址、地区、服务、应用、URL分类等匹配条件，以及内容安全检查所需的各种配置文件，在防火墙上都以对象的形式存在。你可以先创建对象，然后在多个安全策略中引用。

### 策略标识

为了便于管理，安全策略还提供了如下属性。

- 名称：用于唯一标识一条安全策略，不可重复。为每一条安全策略指定一个有意义的名称（如安全策略的目的），能提高维护工作效率。
- 描述：用于记录安全策略的其他相关信息。例如，你可以在这个字段记录触发此安全策略的的申请流程编号。这样，在例行审计时可以快速了解安全策略的背景，比如什么时间引入此安全策略，谁提出的申请，其有效期多久，等等。
- 策略组：把相同目的的多条安全策略加入到一个策略组中，可以简化管理。你可以移动策略组，启用/禁用策略组等。
- 标签：标签是安全策略的另一种标识方式，你可以给一条安全策略添加多个标签，通过标签可以筛选出具有相同特征的策略。例如，你可以根据安全策略适用的应用类型，添加高风险应用、公司应用等标签。在为安全策略设置标签时，建议使用固定的前缀，如用“SP_”代表安全策略，并用颜色区分不同的动作。这会使标签更容易理解。



## 安全策略的配置方式

华为防火墙提供了多种配置方式，你可以选择命令行、Web界面或者北向接口（RESTCONF和NETCONF）来配置安全策略。接下来，我们将以一个实例来展示最常用的Web界面和命令行配置。

例如：为了允许Trust安全区域内的、192.168.1.0/24和192.168.2.0/24网段的设备能够正常上网，需要创建一条[表1-1](https://support.huawei.com/enterprise/zh/doc/EDOC1100164799#table1982914493410)所示的安全策略。



**图1-1** 安全策略的配置示例



![img](2.基础知识篇-防火墙安全策略管理与配置的原则.assets/download)



**表1-1** 安全策略示例

| 序号 | 名称                         | 源安全区域 | 目的安全区域 | 源地址/地区                  | 目的地址/地区 | 用户 | 服务      | 动作   |
| ---- | ---------------------------- | ---------- | ------------ | ---------------------------- | ------------- | ---- | --------- | ------ |
| 101  | Allow access to the Internet | trust      | untrust      | 192.168.1.0/24192.168.2.0/24 | any           | any  | httphttps | permit |



使用命令行配置如下：

```shell
<sysname> system-view
[sysname] security-policy
[sysname-policy-security] rule name "Allow access to the Internet"
[sysname-policy-security-rule-Allow access to the Internet] source-zone trust
[sysname-policy-security-rule-Allow access to the Internet] destination-zone untrust
[sysname-policy-security-rule-Allow access to the Internet] source-address 192.168.1.0 mask 24
[sysname-policy-security-rule-Allow access to the Internet] source-address 192.168.2.0 mask 24
[sysname-policy-security-rule-Allow access to the Internet] service http https
[sysname-policy-security-rule-Allow access to the Internet] action permit
[sysname-policy-security-rule-Allow access to the Internet] quit
[sysname-policy-security] 
```





## 缺省策略与匹配规则

防火墙出厂存在一条显式的缺省策略default，默认禁止所有的域间流量。缺省策略永远位于策略列表的最底端，且不可删除。

用户创建的安全策略，按照创建顺序从上往下排列，新创建的安全策略默认位于策略列表底部，缺省策略之前。

防火墙接收到流量之后，按照安全策略列表从上向下依次匹配。一旦某一条安全策略匹配成功，则停止匹配，并按照该安全策略指定的动作处理流量。

如果所有手工创建的安全策略都未匹配，则按照缺省策略处理。

基于以上两点：

- 建议保持缺省策略的动作为禁止，不要修改。缺省策略的目的，是保证所有未明确允许的流量都被禁止，这是防火墙作为一个安全产品的基本设计理念。
- 安全策略的顺序至关重要。在创建安全策略之后，你需要根据业务需要手动调整安全策略的顺序，以保证策略匹配结果符合预期。

例如：安全策略列表中已经有一条名为"Block high-risk ports"的安全策略101，阻断了所有高风险服务。

现在，你要为来自Trust区域的管理终端访问位于DMZ区域的服务器开放RDP远程桌面服务，新增了一条名为“RDP for admin”的安全策略201。



**表1-2** 安全策略的顺序-新增配置后

| 序号 | 名称                  | 源安全区域 | 目的安全区域 | 源地址/地区                       | 目的地址/地区             | 用户 | 服务                        | 动作   |
| ---- | --------------------- | ---------- | ------------ | --------------------------------- | ------------------------- | ---- | --------------------------- | ------ |
| 101  | Block high-risk ports | any        | any          | any                               | any                       | any  | 自定义服务：High-risk ports | deny   |
| ……   |                       |            |              |                                   |                           |      |                             |        |
| 201  | Allow RDP for admin   | trust      | dmz          | 自定义地址组：Management terminal | 自定义地址组：Server farm | any  | rdp-tcprdp-udp              | permit |
| 202  | default               | any        | any          | any                               | any                       | any  | any                         | deny   |



因为安全策略101完全包含了安全策略201的匹配条件，按照安全策略的匹配规则，安全策略201永远也不会被命中。

来自Trust区域的远程桌面访问命中安全策略101，就按照其动作被阻断了。

因此，新增安全策略201之后，你需要手动调整其顺序，把它放到安全策略101前面。调整后安全策略的序号自动变化。

















