# 概述



**ARP（Address Resolution Protocol）即地址解析协议，**对应的 RFC 文档是 [RFC826](https://tools.ietf.org/html/rfc826)。 ****

**它用于实现从 IP 地址到 MAC 地址的映射，即询问目标IP对应的MAC地址**。



在计算机网络通信中，主机与主机通信的数据包需要依据OSI模型从上到下进行数据封装，当数据封装完整后，再向外发出。

所以在局域网通信中，在数据链路层，不仅需要源目IP地址的封装，也需要源目MAC的封装。



在局域网中，当主机或其它三层网络设备有数据要发送给另一台主机或三层网络设备时，它需要知道对方的网络层地址（即IP地址）。

但是仅有IP地址是不够的，因为IP报文必须封装成帧才能通过物理网络发送，因此发送方还需要知道接收方的物理地址（即MAC地址）







这就需要一个从IP地址到MAC地址的映射。**ARP 协议就是一个实现将IP地址解析为MAC地址的协议。**

一般情况下，上层应用程序更多关心IP地址而不关心MAC地址，所以需要通过ARP协议来获知目的主机的MAC地址，完成数据封装。

比如，我们常见的http协议，应用层封装http报文，传输层封装端口号，网络层封装IP地址，数据链路层封装MAC地址。

应用程序开发，主要是在考虑应用层。





## ARP请求应答原理

在一个只有两台主机互联的局域网里面，当PC1需要跟PC2进行通信时，此时PC1是如何处理的？

根据OSI数据封装顺序，发送方会自顶向下（从应用层→传输层→网络层→数据链路层→物理层）封装数据，然后发送出去，这里以PC1 ping PC2的过程举例。

我们给PC1指令"ping ip2"，这就告知了目的IP，此时PC1便有了通信需要的源目IP地址，但是PC1仍然没有通信需要的目的MAC地址。



**这就好比我们要寄一个快递，如果在快递单上仅仅写了收件人的姓名（IP），却没有写收件人的地址（MAC），那么这个快递就没法寄出，因为信息不完整。**



所以PC1要发送一个广播包。

- 首先，Host_1会查找自己本地缓存的ARP表，确定是否包含Host_3对应的ARP表项。

如果Host_1在ARP表中找到了Host_3对应的MAC地址，则Host_1直接利用ARP表中的MAC地址，对数据报文进行帧封装，并将数据报文发送给Host_3。

如果找不到，则先缓存该数据报文，并以广播方式发送一个ARP请求报文。（广播请求）

ARP请求报文中的源MAC地址和源IP地址为Host_1的MAC地址和IP地址，目的MAC地址为全0的MAC地址，目的IP地址为Host_3的IP地址。