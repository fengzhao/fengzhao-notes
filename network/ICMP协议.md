

# 简介



ICMP是（Internet Control Message Protocol）Internet控制报文协议。它是TCP/IP协议簇的一个子协议，用于在IP主机、路由器之间传递控制消息。

控制消息是指网络通不通、主机是否可达、路由是否可用等网络本身的消息。这些控制消息虽然并不传输用户数据，但是对于用户数据的传递起着重要的作用。



ICMP 的全称是 `Internet Control Message Protocol(互联网控制协议)`，它是一种互联网套件，它用于**IP 协议中发送控制消息**。

也就是说，ICMP 是依靠 IP 协议来完成信息发送的，它是 IP 的主要部分，但是从体系结构上来讲，它位于 IP 之上，因为 ICMP 报文是承载在 IP 分组中的，就和 TCP 与 UDP 报文段作为 IP 有效载荷被承载那样。

这也就是说，当主机收到一个指明上层协议为 ICMP 的 IP 数据报时，它会分解出该数据报的内容给 ICMP，就像分解数据报的内容给 TCP 和 UDP 一样。

ICMP 协议和 TCP、UDP 等协议不同，它不用于传输数据，只是用来发送消息。

因为 IP 协议现在有两类版本：IPv4 和 IPv6 ，所以 ICMP 也有两个版本：**ICMPv4 和 ICMPv6**。





在IP通信中，经常有数据包到达不了对方的情况。原因是，在通信途中的某处的一个路由器由于不能处理所有的数据包，就将数据包一个一个丢弃了。

或者，虽然到达了对方，但是由于搞错了端口号，服务器软件可能不能接受它。在IP 网络上，由于数据包被丢弃等原因，为了控制将必要的信息传递给发信方。

ICMP 协议是为了辅助IP 协议，交换各种各样的控制信息而被制造出来的。



RFC792 的开头部分里写着"ICMP 是IP 的不可缺少的部分，所有的 IP 软件必须实现ICMP协议。也是，ICMP 是为了分担 IP 一部分功能而被制定出来的。





### ICMP 的主要功能

对于 ICMP 的功能，主要分为两个：

- ICMP 的第一个功能是**确认 IP 包是否能够成功到达目标地址**，当两个设备通过互联网相连时，任意一个设备发送给另一个设备的 IP 包如果没有到达，就会生成 ICMP 数据包发送给设备共享。
- ICMP 的第二个功能是进行`网络诊断`，经常使用 ICMP 数据包的两个终端程序是 `ping` 和 `traceroute`，traceroute 程序用于显示两台互联网设备之间可能的路径并测量数据包在 IP 网络上的时延。

ping 程序是 traceroute 的简化版本，我们经常使用 ping 命令来测试两台设备之间是否互联，ping 通常用来测试两台主机之间的连接速度，并准确报告数据包到达目的地并返回后所花费的时间。

现在我们知道了，如果在 IP 通信过程中由于某个 IP 包由于某种原因未能到达目标主机，那么这个具体的原因将由 ICMP 进行通知。









### 与 ICMP 有关的攻击



涉及 ICMP 攻击主要分为 3 类：**泛洪(flood)、炸弹(bomb) 和信息泄露(information disclsure)**。

- 泛洪将会产生大量流量，导致针对一台或者多台计算机的有效 Dos 攻击。
- 炸弹指的是发送经过特殊构造的报文，这类报文能够导致 IP 或者 ICMP 的处理失效或者崩溃。
- 信息泄露本身不会造成危害，但是能够帮助辅助其他攻击。

针对 TCP 的 ICMP 攻击已经记录在了 RFC5927 中。