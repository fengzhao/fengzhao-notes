# 概述



Burp Suite是用于攻击web应用程序的集成平台框架。它包含了许多Web安全工具，并为这些工具设计了许多接口，满足安全人员自行扩展程序功能的需求。

所有的工具都共享一个能处理并显示HTTP消息，持久性，认证，代理，日志，警报的一个强大的可扩展的框架。



Burp Suite由英国的PortSwigger公司开发，它以其灵活、可定制和易于使用的特点而受到全球安全专业人士的青睐，使用 Java 语言开发。

BurpSuite可执行程序是Java文件类型的jar文件，免费版的可以从免费版下载地址进行下载。

免费版的BurpSuite会有许多限制，很多的高级工具无法使用，如果您想使用更多的高级功能，需要付费购买专业版。



 Burp Suite以代理方式工作，默认的代理端口为8080。

在具体应用中，可以将运行Burp Suite工具的主机设置成一个Web浏览器使用的代理服务器，以便拦截所有被扫描的Web网站的流量，供系统查看、分析和修改。

此外, Burp Suite还提供了地图功能，可以对被扫描主机和目录生成一个地图，以直观的形式供使用者进行分析。



Burp Suite平台主要提供了以下工具：

- **Proxy（代理）**：Proxy是一个拦截HTTP/HTTPS的代理服务器，通过代理服务器来拦截浏览器与目标应用程序之间的流量，为进一步查看或修改相关信息提供原始数据流。
- **Spider（网络爬虫）**：Spider是一个具有特殊应用功能的网络爬虫，它能完整地枚举应用程序的内容和功能。
- **Scanner（扫描）**：Scanner是 Burp Suite具有的一个高级应用工具，使用该工具可以扫描发现Web应用程序的安全漏洞。
- **Intruder（干扰者）**：Intruder是 Burp Suite提供的一个可配置的暴力破解攻击工具，主要实现对Web应用程序进行自动攻击，包括收集有用的数据、漏洞模糊测试等。
- **Repeater（中继器）**：Repeater是一个帮助攻击者完成Web站点扫描的辅助工具，利用该工具可以根据攻击者的需要单独发送HTTP请求，并对请求的响应进行分析，通过分析补充判断Web站点存在的安全漏洞。
- **Sequencer（定序器）**：Sequencer是一个用于在扫描得到的随机样本中对指定的数据项进行分析的工具。例如，利用Sequencer 工具可以测试应用程序的会话令牌(sessiontokens)。
- **Decoder（编码器）**：Decoder是 Burp Suite提供的一款编码解码工具，利用Decoder可以将原始数据转换成各种需要的编码和哈希表。
- **Comparer（比较器）**：Comparer是一个以可视化方式对比分析两项数据之间差异性的工具。例如，在枚举用户名的过程中，利用Comparer 工具可以对比分析登录成功和失败时服务器端反馈结果的区别。



  



## 工作原理



从本质上讲，Burp Suite是一个基于Java的框架，旨在作为进行Web应用程序渗透测试的综合解决方案。Burp Suite已经成为针对Web和移动(mobile )应用程序包括依赖于应用程序编程接口(APIs)的应用程序进行实际安全评估的行业标准工具。 



简而言之，Burp Suite可以捕获并操作浏览器和Web服务器之间的所有HTTP/HTTPS流量，这一基本功能构成了Burp Suite框架的主干。

在拦截web请求之后，用户可以灵活地将它们发送到Burp Suite框架内的各种组件中，Burp Suite可以在Web请求到达目标服务器之前拦截、查看和修改Web请求(requests)，甚至可以在浏览器接收到响应之前对响应消息(responses)进行操作，这种能力使得Burp Suite成为手动测试Web应用程序的宝贵工具。




HTTPS 劫持其实是一个老生常谈的话题，从上古时代的 HTTPS 降级，到现在很稳定的安全工具 BurpSuite，xray 等，以及一些常见的网络调试工具 Fiddler、Charles、surge，很多都直接或者间接利用了 HTTPS 的 MITM 攻击。

大多原理都是在本底启动代理服务器，浏览器显式配置代理就可以抓包进行调试、漏洞测试了。它们都是直接或者间接利用了 HTTPS 的 MITM 攻击。



**"MITM" 是 "Man-in-the-Middle" 的缩写，意思是中间人攻击。**

MITM攻击是一种网络攻击技术，攻击者通过欺骗的手段，让自己成为通信双方之间的中间人。

从而可以窃取双方之间的通信内容、修改通信内容、甚至篡改通信流量，从而实现窃取信息、伪造信息等攻击目的。

"未知攻，焉知防"，在渗透测试中，MITM劫持可以被用来模拟真实的黑客攻击，以测试系统和应用程序的安全性。



渗透测试中使用MITM攻击的一个典型场景是在测试Web应用程序时。攻击者可以使用MITM技术拦截应用程序和服务器之间的通信，以获取用户名和密码等敏感信息，或者篡改应用程序返回的数据。

攻击者可以使用代理工具，来捕获应用程序发送和接收的数据，对数据进行修改或篡改，然后重新发送到应用程序或服务器。

这样就可以测试应用程序是否可以有效地防范MITM攻击，并且是否能够正确地处理应用程序和服务器之间的通信。

MITM攻击还可以用来测试网络的弱点，并检测是否存在潜在的漏洞。

通过MITM攻击，渗透测试人员可以捕获网络中传输的数据，并进行分析和审查，以发现可能存在的安全问题。



例如，攻击者可以利用MITM攻击来欺骗局域网内的设备，并拦截设备之间的通信流量，从而窃取敏感信息，或者篡改数据包，对网络进行进一步的攻击。

总的来说，MITM劫持是渗透测试中常用的一种技术，它可以帮助测试人员发现网络中可能存在的安全漏洞，提供相应的建议和解决方案，从而保护系统和应用程序的安全。



BurpSuite 代理工具是以拦截代理的方式，拦截所有通过代理的网络流量，如客户端的请求数据、服务器端的返回信息等。

Burp Suite 主要拦截HTTP 和 HTTPS 协议的流量，通过拦截， Burp Suite 以中间人的方式对客户端的请求数据、服务端的返回信息做各种处理，以达到安全测试的目的。







**系统代理**

这个概念大家想必大家都比较熟悉， 比如 MacOS，在 系统偏好->网络->高级->代理 里就可以修改系统代理。

Windows中同样有这样的设置。但是在这里设置代理后, 【**应用软件会不会走这个代理完全取决于应用软件自己**】。



比如 Chrome 浏览器会走这儿设置的代理， 而电脑上的 Terminal ，开发工具，典型的firefox，等很多应用就选择无视这个代理。

在浏览器已经导入`Burpsuite`的证书之后，抓包，浏览器仍然显示 **抓取HTTPS包提示不是私密链接**

URL输入chrome://flags/，搜索：Allow invalid certificates for resources loaded from localhost 设置为Enable 

这里其实工作在应用层，在这里拦截的话，抓包工具只需要处理应用层的协议包即可。

这也是目前大部分抓包工具实现的方式。许多抓包软件从系统代理捕获数据包，应用程序很容易跳过系统代理。



BurpSuite的基本思路是**伪装成目标 HTTPS 服务器**，让浏览器（client）相信BurpSuite就是目标站点。为了达成目标，BurpSuite必须：

（1）生成一对公私钥，并将公钥和目标域名绑定并封装为证书；

（2）让操作系统或浏览器相信此证书，即通过证书验证。



所以， BurpSuite需要在操作系统添加一个根证书，这个根证书可以让浏览器信任所有BurpSuite颁发的证书。

之后，BurpSuite拥有了两套对称密钥，一套用于与client交互，另外一套与server交互，而在BurpSuite处可以获得HTTPS明文。



**核心原理：不安全的 CA 导致信任链崩坏**

**不安全的 CA 可以给任何网站进行签名，TLS 服务端解密需要服务端私钥和服务段证书，然而这个不安全的 CA 可以提供用户暂时信任的服务端私钥和证书**。



这就好比你信任了一个信用极差的人进入你的家，这个信用极差的人可以在你的家里乱翻乱拿无恶不作。

HTTP 抓包神器 Fiddler 的工作原理是在本地开启 HTTP 代理服务，通过让浏览器流量走这个代理，从而实现显示和修改 HTTP 包的功能。

如果要让 Fiddler 解密 HTTPS 包的内容，需要先将它自带的根证书导入到系统受信任的根证书列表中。

一旦完成这一步，浏览器就会信任 Fiddler 后续的「伪造证书」，从而在浏览器和 Fiddler、Fiddler 和服务端之间都能成功建立 TLS 连接。



而对于 Fiddler 这个节点来说，两端的 TLS 流量都是可以解密的。



> Charles is an HTTP and SOCKS proxy server. Proxying requests and responses enables Charles to inspect and change requests as they pass from the client to the server, and the response as it passes from the server to the client. This section outlines some of the proxying functions that Charles provides. Also see the [Tools](https://www.charlesproxy.com/documentation/tools/) section.





## 使用

Burp Suite有三个版本：Community Edition（免费版）、Professional Edition（专业版）、Enterprise Edition（企业版）

- Community Edition（免费版）
- Professional Edition（专业版）
- Enterprise Edition（企业版）

Community版是免费的，但功能较为简单；Professional版则需要付费，但功能更加强大。

选择哪个版本的`Burp Suite`取决于你的需求和预算。

如果是初学者或者经济条件不允许，可以选择Community版；如果需要更加完善的功能和更高的性能，可以选择Professional版。

Burp Suite的版本号可能会随着时间的推移而变化，因此建议从PortSwigger官方网站上获取最新的版本信息。



众所周知国内我们使用的 `Burp Suite Pro`大多数是大佬们分享出来的专业破解版的 Burp Suite，每次启动的时候都得通过加载器来启动 Burp Suite。

在`cmd`里执行`java -jar /your_burpsuite_path/burpSuite_pro.jar`即可启动`BurpSuite`。

或者将`burpsuite_pro.jar`放入`class_path`目录下，直接执行`java-jar burpsuite_pro.jar`也可以启动。



如果Java可运行环境配置正确的话，当你双击 burpSuite.jar 即可启动软件。

这时 BurpSuite 自己会自动分配最大的可用内存，具体实际分配了多少内存，默认一般为64M。

当我们在渗透测试过程，如果有成千上万个请求通过BurpSuite，这时就可能会导致BurpSuite因内存不足而崩溃，从而会丢失渗透测试过程中的相关数据





在日常工作中，最常用的web客户端就是的web浏览器，可以通过代理的设置，做到对web浏览器的流量拦截，并对经过BurpSuite代理的流量数据进行处理。

当BurpSuite启动之后，默认分配的代理地址和端口是`127.0.0.1:8080`，我们可以从BurpSuite的`proxy`选项卡的`options`上查看。



# 功能

## Dashboard(仪表盘)

主要分为三块：Tasks(任务)、Event log(事件日志)、issue activity(动态发现的问题)



Dashboard 是Burp Suite 的任务管理中心，用于监控和操作主动及被动扫描任务。

**默认情况下，Burp Suite 会自动启用两个被动扫描任务（审计和爬虫），用于实时分析目标的安全性。**



### 扫描器

实时任务







## **Target(目标)**

Burp Suite的Target（目标）模块是一个强大的工具，主要用于生成站点地图、设置作用域和分析目标应用的整体状况。

以下是关于Burp Suite Target模块的详细介绍：

- **站点地图Site Map**：以树状结构显示目标应用的所有页面和资源，帮助测试人员了解目标应用的结构和功能。
- **作用域**：定义拦截内容的范围，例如通过域名或主机名限制拦截内容，从而减少无效的噪音。
- **漏洞定义**：列出Burp Scanner可以检测到的所有漏洞的定义，帮助测试人员识别和修复潜在的安全漏洞。





SiteMap会在目标中以树形和表形式显示，并且还可以查看完整的请求和响应。树视图包含内容的分层表示，随着细分为地址，目录，文件和参数化请求的URL 。

您还可以扩大有趣的分支才能看到进一步的细节。如果您选择树的一个或多个部分，在所有子分支所选择的项目和项目都显示在表视图。



代理

爬虫

扫描

重放

入侵

序列器

编码





## 代理

代理工具可以说是Burp Suite测试流程的一个心脏，它可以让你通过浏览器来浏览应用程序来捕获所有相关信息，并让您轻松地开始进一步行动。

在一个典型的测试中，侦察和分析阶段包括以下任务：

- 手动映射应用程序-使用浏览器通过BurpSuite代理工作，手动映射应用程序通过以下链接，提交表单，并通过多步骤的过程加强。这个过程将填充代理的历史和目标站点地图与所有请求的内容，通过被动蜘蛛将添加到站点地图，可以从应用程序的响应来推断任何进一步的内容(通过链接、表单等)。也可以请求任何未经请求的站点(在站点地图中以灰色显示的)，并使用浏览器请求这些。

- 在必要是执行自动映射-您可以使用BurpSuite自动映射过程中的各种方法。可以进行自动蜘蛛爬行，要求在站点地图未经请求的站点。请务必在使用这个工具之前，检查所有的蜘蛛爬行设置。



使用内容查找功能发现，可以让您浏览或蜘蛛爬行可见的内容链接以进一步的操作。

使用BurpSuite Intruder(入侵者)通过共同文件和目录列表执行自定义的发现，循环，并确定命中。

注意，在执行任何自动操作之前，可能有必要更新的BurpSuite的配置的各个方面，诸如目标的范围和会话处理。

分析应用程序的攻击面 - 映射应用程序的过程中填入代理服务器的历史和目标站点地图与所有的BurpSuite已抓获有关应用程序的信息。



这两个库中包含的功能来帮助您分析它们所包含的信息，并评估受攻击面的应用程序公开。

此外，您可以使用BurpSuite的目标分析器报告的攻击面的程度和不同类型的应用程序使用的URL 。



Burp Proxy代理模块作为BurpSuite的核心功能，拦截HTTP/HTTPS的代理服务器，作为一个在浏览器和目标应用程序之间的中间人，允许你**拦截**，**查看**，**修改**在两个方向上的原始数据流。

Burp 代理允许你通过监视和操纵应用程序传输的关键参数和其他数据来查找和探索应用程序的漏洞。通过以恶意的方式修改浏览器的请求，Burp 代理可以用来进行攻击。

如：SQL 注入，cookie 欺骗，提升权限，会话劫持，目录遍历，缓冲区溢出。



拦截的传输可以被修改成原始文本，也可以是包含参数或者消息头的表格，也可以十六进制形式，甚至可以操纵二进制形式的数据。

在 Burp 代理可以呈现出包含 HTML 或者图像数据的响应消息。













HTTP history(HTTP请求历史)

记录了所有被拦截的请求和响应，使用户能够查看和分析以前的请求和响应。用户可以使用过滤器来搜索特定请求和响应，以便更轻松地查找和分析流量。





拦截，



- **Target(目标)**

  **Site Map**

  SiteMap会在目标中以树形和表形式显示，并且还可以查看完整的请求和响应。树视图包含内容的分层表示，随着细分为地址，目录，文件和参数化请求的URL 。

  您还可以扩大有趣的分支才能看到进一步的细节。如果您选择树的一个或多个部分，在所有子分支所选择的项目和项目都显示在表视图。

  

  **Proxy（代理）**BurpProxy的拦截功能主要由Intercept选项卡中的Forward、Drop、Interception on/off、Action、Comment以及Highlight构成。

  - **Forward**：当你编辑信息之后，发送信息到服务器或浏览器 
  - **Drop**：当你不想要发送这次信息可以点击drop放弃这个拦截信息 
  - 
    - 如果按钮显示 Interceptionis On，表示请求和响应将被拦截或自动转发根据配置的拦截规则配置代理选项。
    - 如果按钮显示Interception is off，则显示拦截之后的所有信息将自动转发。
  - **Action**：说明一个菜单可用的动作行为操作可以有哪些操作功能 

- 

- **intercept（拦截）**用于显示和修改HTTP请求和响应，通过你的浏览器和Web服务器之间。在BurpProxy的选项中，您可以配置拦截规则来确定请求是什么和响应被拦截。







## 主动扫描



向应用发送新的请求，并分析 payload 判断漏洞

- 优点：扫描效果好
- 缺点：产生大量的请求，对业务性能有影响，建议用于非生产环境。

Burp 在检测过程中，采用各个技术来验证漏洞是否存在，比如诱导时间延迟、强制修改 Boolean 值，与 模糊测试的结果进行比较，以达到高准确性的漏洞扫描报告。







**数据拦截与控制**

BurpProxy的拦截功能主要由Intercept选项卡中的Forward、Drop、Interception is on/off、Action、Comment及Highlight构成，它们的功能分别是：

- Forward的功能是当你查看过消息或者重新编辑过消息之后，点击此按钮，将发送消息至服务器端。
- Drop的功能是你想丢失当前拦截的消息，不再forward到服务器端。
- Interception is on表示拦截功能打开，拦截所有通过BurpProxy的请求数据；
- Interception is off表示拦截功能关闭，不再拦截通过BurpProxy的所有请求数据。
- Action的功能是除了将当前请求的消息传递到Spider、Scanner、Repeater、Intruder、Sequencer、Decoder、Comparer组件外。
  - 还可以做一些请求消息的修改，如改变GET或者POST请求方式、改变请求body的编码。
  - 同时也可以改变请求消息的拦截设置，如不再拦截此主机的消息、不再拦截此IP地址的消息、不再拦截此种文件类型的消息、不再拦截此目录的消息，也可以指定针对此消息拦截它的服务器端返回消息。



## Intruder

Intruder(入侵者，或译为攻击器) 是Burp Suite的内置模糊测试工具，它允许我们自动化地修改请求并通过使用不同的输入值来进行重复测试，这在模糊测试或者暴力破解攻击中非常有用。



> Fuzz Testing (模糊测试)是一种测试方法，即构造一系列无规则的“坏”数据（“坏”数据：非正常数据）插入应用程序，判断程序是否出现异常，以发现潜在的bug。在信息安全领域，也有人尝试引入fuzz testing思想进行安全漏洞挖掘,而且效果不错。
>
> Fuzzing通过自动或半自动生成随机数据并输入到目标程序中，监视程序异常（如崩溃、断言失败等），从而发现bug，甚至是安全漏洞。
>
> 模糊测试 （fuzz testing, fuzzing）是一种软件测试技术。其核心思想是自动或半自动的生成随机数据输入到一个程序中，并监视程序异常，如崩溃，断言(assertion)失败，以发现可能的程序错误，比如内存泄漏。模糊测试常常用于检测软件或计算机系统的安全漏洞。
>
> 一般涉及生成数据列表，并让程序按数据列表内容请求测试的都可以称为fuzz。fuzz模糊测试，主要作用在于我们遇到一些可疑的页面，进行一些测试。



类似地，我们也可以导入模糊测试字典，并结合Intruder对子目录、端点或虚拟主机进行模糊测试，Intruder的主要功能与Wfuzz或Ffuf命令行工具类似。

简而言之，作为一种执行自动化请求的工具，Intruder非常强大，但是还有一个问题：如果想不限速率地使用Intruder，那么我们必须下载Burp Suite专业版。

当我们在Burp Suite社区版中使用Intruder模块时，它会受到一定的速率限制，而这种速度限制可能会让许多渗透测试人员选择使用其他工具来进行模糊测试和暴力破解攻击。尽管如此，Intruder模块仍然是一个很有价值的工具，值得我们去学习如何有效地使用它。



 Intruder可以接受一个请求(通常是Burp Proxy先捕获到请求再转发至Intruder中)，并能使用这个请求作为模版来自动向目标服务器发送大量具有细微差别的请求。例如，通过捕获包含登录尝试的请求，我们可以配置Intruder将用户名和密码字段替换为字典中的值，从而能够允许我们对登录表单进行暴力破解攻击；











当我们切换到Intruder的Positions子选项卡时，我们还可以从中查看"Attack types" 下拉菜单并选择具体的攻击类型。 Intruder为我们提供了四种可选的攻击类型，每种攻击类型都有其特定的使用目的： 

- Sniper(狙击手)：该攻击类型是默认且最常用的选项，它会循环遍历有效载荷集，并且每次将一个有效载荷插入到请求中已定义的每个攻击位置；Sniper攻击将以线性方式迭代所有有效载荷，从而允许我们进行精确和集中的Web安全测试。 
- Battering ram(攻城锤)：Battering ram攻击类型与Sniper攻击类型的不同之处在于——Battering ram攻击会同时发送所有的有效载荷，并且每个有效载荷将插入到其对应的各自攻击位置；当我们想测试竞争条件漏洞或者需要在测试中同时发送多个payload时，这种攻击类型会非常有用。 
- Pitchfork(干草叉)：Pitchfork攻击类型可以使用不同的有效载荷来同时测试多个攻击位置，该攻击类型允许测试人员定义多个有效载荷集，并且每个有效载荷集都会与请求中的特定攻击位置相关联；当存在需要单独测试的不同参数时，这种攻击类型会非常有效。 
- Cluster bomb(集束炸弹)：Cluster bomb攻击类型结合了Sniper和Pitchfork中的方法，它能对每个攻击位置执行类似于Sniper的攻击，但也会针对每个攻击位置同时测试所有的有效载荷；当测试中存在多个攻击位置且需要有不同的有效载荷时，这种攻击类型会很有用。 每种攻击类型都有其优点，适合不同的测试场景，了解它们之间的差异有助于我们根据具体的测试目标来选择合适的攻击类型。
  

### Sniper攻击

在使用这种攻击类型时，我们将提供一组有效载荷，这可以是单词列表(字典)或者一系列数字，并且我们将使用"Payload Set"来引用那些将要插入到请求中的有效载荷，然后Intruder会获取"Payload Set"中的每个有效载荷，并依次将每个有效载荷插入到请求中的每个已定义的攻击位置。









## Intercept

用于显示和修改HTTP请求和响应，通过你的浏览器和Web服务器之间。

在BurpProxy的选项中，您可以配置**拦截规则**来拦截对应的**请求报文**和**响应报文**(例如，范围内的项目，与特定文件扩展名，项目要求与参数，等)。 该面板还包含以下控制：



**Intercept**  

Interception is on/off  这个按钮用来切换和关闭所有拦截。

Intercept 是Proxy模块的核心功能之一，它允许用户拦截应用程序的HTTP和HTTPS请求，查看和修改请求，然后转发到目标服务器。

使用Intercept，用户可以深入分析应用程序的请求和响应，并查找潜在的漏洞。Intercept还可以帮助用户快速验证漏洞的利用。   





**Forward**

放行

**Drop**

丢弃

**Action**

动作



# 如何自己实现HTTPS劫持



1. 先通过一个简单的 HTTP Connect 请求来连接代理服务器
2. 代理服务器返回 200，表明 Connect 管道建立完毕
3. Client 开始进行 TLS 连接，中间人通过 SNI 来获知需要连接的目标是谁
4. 中间人连接真正的服务器
5. 中间人开始根据 SNI 和 CA 自动签发假的服务端证书，并返回给用户，并进行握手
6. 握手成功，客户端开始发送 HTTP 请求
7. 中间人开始做用户到真正服务器的流量互相转发（可劫持）