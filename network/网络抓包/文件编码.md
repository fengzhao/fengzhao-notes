# **文件类型和拓展名**

数据/文件以二进制的形式存储在计算机系统内，不同类型的数据有着其独有的特征用于被正确的应用程序识别，这些特征有文件名的扩展名、文件头标识等。

一般文件名可能有两部分组成如 新建文本文档.txt，其中.txt 这个文件名的后缀用于表示文件格式，被称为文件扩展名。

常见的扩展名有表示视频文件的.mp4、.avi，表示音频文件的.mp3、.wav、表示图像的.png、.jpg等。

其实在Linux中，不需要后缀名的，目前有些Linux下的文件有后缀名其实也只是为了符合Windows的用户以后缀名辨别文件类型的习惯而已。

一看文件名叫做temp.tar.gz，就知道这是个压缩包，但是这并不代表一定是对的，实际上我即使去掉了tar.gz，Linux照样可以识别出这是个压缩包文件类型。



在windows中，文件名一般都有拓展名，比如我们把 `docx` 拓展名的`word`文件，改成 exe 拓展名，在windows电脑中可能就无法打开了。

在windows7/windows10中，有个设置，叫为特定的文件或协议设置默认的应用，就是这个意思。

文件的扩展名是用来识别文件类型的。通过给他指定扩展名，我们可以告诉自己，也告诉操作系统我们想用什么方式打开这个文件。

比如操作系统会把.jpg的文件默认用图片显示软件打开，.zip 文件会默认用解压软件打开等等。



Linux中的file命令之所以可以判断二进制文件的类型，就是依靠这个文件头标识。

你即使更改了后缀名也不会影响这个文件头标识，所以依靠后缀名来判断常规文件类型是不靠谱的。



**文件头标志**

图像查看器不能正常显示文本文件中的内容，记事本打开图像文件也会显示乱码，这是因为二者的编码方式不同。

**每种类型的文件都有其特有文件编码方式，如在文件的头、尾或其他特定位置设置一定字节的数据用于标识文件类型。**

通常这些字节会设置在文件头的特定位置，被称为文件文件头标志（file signatures）或魔数（magic numbers, Magic Bytes）。

**查看文件头的工具**

在windows中可以用 UtraEdit 这个软件来打开任意文件，查看其文件头。

我们可以也利用 vscode 插件**hexdump for VSCode**以十六进制的形式查看二进制文件。

多打开几个文件试试，你会发现同一种类型的文件，他们的头信息是完全相同的。接下来，我们就可以根据头信息来判断文件类型了。

实测打开现代化的docx文件，对比其文件头，发现其本质上是zip文件。

如下图是两个png格式的图像文件用16进制打开后的内容，它们前面部分字节的内容是相同的，这些字节主要用于表示文件格式，后面的字节用于表示每个图像的元数据及图像信息。其中前8个字节的内容都是8950 4e47 0d0a 1a0a，这是表示png格式的文件头，其中50 4e47是PNG的ASCII码。

其实所有的文件都是以二进制存储的，都是01001010101...本质上没有什么差别。

在每一个文件（包括图片，视频或其他的各种非ASCII文件）的开头都有一片区域来显示这个文件的实际用法，这就是文件头标志，如果你要查看一个文件头的16进制标识，你可以采用Ultra-Edit这个工具尝试一下，常见的文件头标识如下：

LNK 4C 00 00 00 01 14 02 00 Windows shortcut file（这是Windows的快捷方式）

jar 5F 27 A8 89 JAR Archive File （这是jar包）

jpg; jpe; jpeg FF D8 FF E0 00 JPG Graphic File（这是JPG）

各种类型的文件头标志

https://www.cnblogs.com/gwind/p/8215771.html

https://blog.51cto.com/u_2982693/3354695

https://docs.fileformat.com/zh/page-description-language/svg/



**文件上传判断文件头**

对于有文件上传等业务系统，为了避免用户上传非法文件，上传可执行的webshell文件造成漏洞。

利用文件头判断文件类型：

上传文件时经常需要做文件类型判断，例如图片、文档等，普通做法是直接判断文件后缀名，而文艺青年为了防止各种攻击同时也会加上使用文件头信息判断文件类型。

常见的判断思路：

- 前端判断 
- 后端判断（文件）



对上传路径和上传文件重命名，即使传了可执行文件，攻击者也无法知晓访问路径，无法请求URL并执行。









# 如何确定一个网页的编码?

现在开始讲网页的编码，一个网页，简单讲就是一个 html 的 **文本文件**。那么如何去确定这样一个文本文件的编码呢?



概括地讲, 确定网页的编码有以下几种方式:

- 缺省
- 文档内的编码声明
- 响应头中的 content-type 字段中的编码信息
- BOM

还有一种废弃的方式是在链接（link）中添加 charset 属性，比如像这样一个 a 标签

```html
<a href="/mysite/mydoc.html" charset="iso-8859-1">
```


如果没有使用其它几种方式指定编码， 就会用这里这个值。不过这种方式已经 不建议使用（deprecated）， 这里稍微提一提它。



**文档内声明**

```html
<!-- html4 写法 --> 
<meta http-equiv="Content-Type" content="text/html; charset=gbk"> 

<!-- html5 的标准写法 --> 
<meta charset="utf-8">   
```



**响应头中的 content-type 字段中的编码信息**







### 多方式并存且存在冲突时的优先级









有的时候， 不是说你声明了某个编码， 你的文档就会自然而然地就用这个编码来保存。**这个一致性是要由源码的作者来保证的**

如果两者不一致， 那么结果将会是乱码。比如页面 meta 宣称是 gbk 编码, 实际保存所用的却是 utf-8。当在浏览器中打开时, 将发生乱码



这个文件在 IDE 中, 比如在 Eclipse 中打开时也是乱码的。因为较为智能的 IDE html 编辑器在打开这个文件时会参考里面 meta 声明的值来解码, 反而被误导了。



> 

