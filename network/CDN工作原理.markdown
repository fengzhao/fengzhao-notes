## 什么是CDN？





`CDN` 的全称是 `Content Delivery Network`，即内容分发网络。

`CDN` 是构建在现有网络基础之上的智能虚拟网络，依靠部署在各地的边缘服务器，通过中心平台的负载均衡、内容分发、调度等功能模块.

使用户就近获取所需内容，降低网络拥塞，提高用户访问响应速度和命中率。

`CDN` 的关键技术主要包括了节点调度、节点负载均衡和内容存储、分发、管理技术。

具体来说，CDN就是采用更多的缓存服务器（CDN边缘节点），布放在用户访问相对集中的地区或网络中。

随着互联网的爆炸式发展，用户越来越多，加上宽带接入网的出现，内容源服务器和骨干网络的压力越来越大，无法及时响应用户的访问需求。

`CDN` 技术最初的核心理念就是，**将内容缓存在终端用户附近**。

当用户访问网站时，利用全局负载技术，将用户的访问指向距离最近的缓存服务器上，由缓存服务器响应用户请求。（有点像电商的本地仓吧？）



由于 `CDN` 跟互联网骨干网的相关性很大，背后涉及到的网络技术和资源较为复杂，大部分公司都没`CDN`。都只能采购一些云计算公司的产品。



比较著名的 CDN 厂商有：

-  阿里云、腾讯云（知乎就用了腾讯CDN）、七牛云（）
- AWS、cloudflare、akamai（飞书就用了这家的）





> 参考
>
> https://zhuanlan.zhihu.com/p/52362950
>
> https://spike.dev/2020/10/26/deep-dive-into-cdn-%e6%b7%b1%e5%ba%a6%e5%89%96%e6%9e%90-cdn-%e7%b3%bb%e7%bb%9f/



## CDN的主要应用场景

在计算机的世界中，缓存无处不在，从 CDN 诞生之初，就可以看出 CDN 最主要的应用场景就是缓存资源，加速用户访问效率。

随着信息安全的发展，DDos 攻击也一直是困扰着人们的一个难题，如果域名直接解析到源站的公网 IP 上，应用的公网IP暴露在网上。

一旦出现 DDos 攻击，对很多公司也是头疼的。也没有足够的能力去解决这种问题。

所以 CDN 的另一个作用就是隐藏源站 IP 地址，攻击的黑客只能看到 CDN 厂商的 IP 地址，攻击只能打到 CDN 厂商那边。



- 图片小文件：如果您的网站或应用 App 的主要业务为图片和小文件下载，包括各类型图片、html、css、js小文件等。
- 大文件下载：网站或应用App的主要业务为大文件下载，平均单个文件大小在20M以上，如游戏、各类客户端下载和App下载商店等。
- 视音频点播：网站或应用App的主要业务为视频点播或短视频类。支持MP4、FLV 主流视频格式。
- 全站加速：全站加速是阿里云一款独立产品，主要用于动态内容加速，也可以实现动静分离加速。
- 安全加速：如果您的网站易遭受攻击且必须兼顾加速的业务场景，则需要使用安全加速功能，提升全站安全性。



## CDN 用到的两种主要技术



### Anycast IP 

我们知道，DDoS 作为一个比较 dirty 的攻击手段，从原理上其实并不是很好防御，基本只能通过升级硬件，加大带宽的方式处理。

而 Cloudflare 处理 DDoS 的方式比较特别，部分原因是因为他们的边缘节点 IP 是 Anycast IP 。

简单来说，就是同一个公网IP地址出现在了世界各地，世界各地的主机都是访问到了离自己最近（延迟最低）的主机所宣告的那个相同 IP。

举一个不恰当的例子，假设我们在中国上海访问 220.243.141.102 这个公网IP，这个IP所在的机器可能在北京某某数据中心。

假设我们在美国纽约访问 220.243.141.102 这个公网IP，这个IP所在的机器可能是洛杉矶某某数据中心。

在我们学习了计算机网络之后，我们知道了一个比较容易理解的道理：「IP 地址在互联网上是一台主机唯一的地址」，

这样当我们「ping 美国一台主机的 IP」的时候，ICMP 包会通过路由协议，走各种线路，最终到达目的主机。

而其中产生的网络延迟很大一部分就是由于距离所导致的，或者说，由于光速也就那样了，所以中美之间肯定会有 100+ms 的延迟，

由于地理位置造成的网络延迟，在国内也是很明显的。所以CDN不仅仅是用在全球加速，甚至为了国内各地加速，也可以使用这种方法。



由于有了 Anycast 网络和「计算机网络基础」的铺垫，即使是 DDoS 的攻击，数据包的行径也是要根据基本法。

所以 DDoS 的模式从之前的多点对一点变成了多点对多点，这样流量就被分散掉了，每个节点上的压力就会小了很多。



https://www.cloudflare.com/zh-cn/learning/cdn/glossary/anycast-network/









### DNS分区解析

------

实现 CDN 的第二种方法就是 DNS 分区解析，在使用 CDN 的时候，通常会让你添加一个加速域名。



比如，知乎在国内



其实就是把 CDN 域名进行 DNS 轮询的意思，



例如域名 www.dns-example.com，有三台服务器，分别是联通IP，移动IP，电信IP，DNS解析配置如下：

- 将域名 指向 联通IP地址 （1.1.1.1）
- 将域名 指向 移动IP地址 （2.2.2.2）
- 将域名 指向 电信IP地址 （3.3.3.3）



