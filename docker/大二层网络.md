# 数据中心为什么需要大二层网络？



在开始之前，首先要明确一点，大二层网络基本上都是针对数据中心场景的，因为它实际上就是为了解决数据中心的服务器虚拟化之后的虚拟机动态迁移这一特定需求而出现的。

对于普通的园区网之类网络而言，大二层网络并没有特殊的价值和意义（除了某些特殊场景，例如WIFI漫游等等）。

所以，现在所说的大二层网络，一般都是指**数据中心的大二层网络**





传统的数据中心网络通常都是二层+三层网络架构





![img](https://o3-cn-apig.shixizhi.huawei.com/bpitservicegateway/sxzservicecommunity/web/attachment/down-attachment?attachmentId=20250415154835_82507be6-652b-451b-8da9-05f8fee4c53a)





这种网络架构其实和园区网等网络的架构是一样的，这种架构相当于零售行业的“加盟店”形式，而与之相对应的“三层到边缘”架构，以及我们下面要谈到的“大二层”架构，就相当于“直营店”了。

之所以采用这种网络架构，是因为这种架构非常成熟，相关的二三层网络技术（二层VLAN+xSTP、三层路由）都是成熟的技术，可以很容易的进行部署，也符合数据中心分区分模块的业务特点。







# 服务器虚拟化趋势

由于传统的数据中心服务器利用率太低，平均只有10%～15%，浪费了大量的电力能源和机房资源。所以出现了服务器虚拟化技术。

**服务器虚拟化技术**是把一台物理服务器虚拟化成多台逻辑服务器，这种逻辑服务器被称为虚拟机（VM）

每个VM都可以独立运行，有自己的OS、APP，当前也有自己独立的MAC地址和IP地址，它们通过服务器内部的虚拟交换机（vSwitch）与外部实体网络连接。

通过服务器虚拟化，可以有效地提高服务器的利用率，降低能源消耗，降低客户的运维成本，所以虚拟化技术目前得到了广泛的应用。







服务器虚拟化对于数据中心网络来说，也没啥特别大的影响，无非就是接入的主机规模变大一些而已（原来一台物理服务器算一个主机，现在每个VM算一个主机），还是可以用二三层网络架构来连接的，规模变大了，多划分一些二层域就行。

但是服务器虚拟化之后，带来了一项伴生的技术，那就是**虚拟机动态迁移**，这就给传统的数据中心网络带来了很大的麻烦。当然在讲麻烦之前，我们先得搞清楚虚拟机动态迁移是怎么回事。



**所谓虚拟机动态迁移，就是在保证虚拟机上服务正常运行的同时，将一个虚拟机系统从一个物理服务器移动到另一个物理服务器的过程。**

该过程对于最终用户来说是无感知的，从而使得管理员能够在不影响用户正常使用的情况下，灵活调配服务器资源，或者对物理服务器进行维修和升级。





# 虚拟机动态迁移对网络的影响



对于数据中心来说，二三层网络架构是有一个弱点的，那是什么弱点呢？这个弱点就是服务器的位置不能随便在不同二层域之间移动。

因为一旦服务器迁移到其他二层域，就需要变更IP地址，TCP连接等运行状态也会中断，那么原来这台服务器所承载的业务就会中断，而且牵一发动全身，其他相关的服务器（比如WEB-APP-DB服务器之间都是相互关联的）也要变更相应的配置，影响巨大。

（这和园区网不一样，园区网里面接入的办公PC等，换一个办公区，换一个二层域，重新获取一下IP地址，对于业务来说，几乎没什么影响）。



幸好在传统的数据中心中，物理服务器位置的跨二层域迁移的场景是非常少见的，而且即使发生迁移，也都是物理层面的，业务肯定都已经中断了，更换IP地址所以这个隐患并不明显。

但是在服务器虚拟化之后，虚拟机的动态迁移会成为一种经常出现的场景。

为了保证迁移时业务不中断，就要求在迁移时，不仅虚拟机的IP地址不变，而且虚拟机的运行状态也必须保持原状（例如TCP会话状态），所以虚拟机的动态迁移只能在同一个二层域中进行，而不能跨二层域迁移。

而传统的二三层网络架构限制了虚拟机的动态迁移只能在一个较小的局部范围内进行，应用受到了极大的限制。为什么这么说？我再卖个关子，到下一章再详细说。



所以，为了打破这种限制，实现虚拟机的大范围甚至跨地域的动态迁移，就要求把VM迁移可能涉及的所有服务器都纳入同一个二层网络域，这样才能实现VM的大范围无障碍迁移。

就好比你原来住在南京，现在迁移到苏州了，原来各城市的社保系统是独立的（小二层网络），所以你要办理社保关系迁移（IP地址变更），办过的人都知道这有多痛苦。

而据说从2015年开始整个江苏省的社保系统现在纳入统一管理了（大二层网络），那么从南京迁移到苏州，人过去就行了，社保关系不需要任何变更（IP地址不变，业务不中断）。





https://forum.huawei.com/enterprise/cn/zh/thread/blog/580900975856730112?blogId=580900975856730112