# 计算机网络基本概念

- network：网络，一组相互连接的网络、通讯的设备。[网络](https://www.cloudflare.com/learning/network-layer/what-is-the-network-layer/)是由两个或两个以上相连的计算机组成。

- internet：互联网，多个互联互通的网络。（通用名词，泛指多个计算网络互联组成的网络）

- Internet：因特网，互联全世界的网络。（专有名词）。特指网络世界上最大的一张互联网。我们平时说的上网就是上因特网。

- ISP：Internet Server Provider，因特网服务提供商，向用户提供网络接入服务的运营商。又称因特网服务提供者、互联网服务提供商、网络服务供应商，即指提供互联网访问服务的公司。

- LAN：局域网，LAN 是包含在较小地理区域内的网络，通常位于同一建筑物内。家庭 WiFi 网络和小型企业网络是常见的 LAN 示例。

  - 大多数 LAN 是从一个中心位置连接到[互联网](https://www.cloudflare.com/learning/network-layer/how-does-the-internet-work/)，即[路由器](https://www.cloudflare.com/learning/network-layer/what-is-a-router/)。

  - 家庭 LAN 通常使用单个路由器，而较大空间中的 LAN 可能另外使用[网络交换机](https://www.cloudflare.com/learning/network-layer/what-is-a-network-switch/) ，以提高数据包传输效率。

    

- 以太网：以太网最早是指由DEC（Digital Equipment Corporation）、Intel和Xerox组成的DIX（DEC-Intel-Xerox）联盟开发并于1982年发布的标准。

  经过长期的发展，以太网已成为应用最为广泛的局域网，包括：

  - 标准以太网（10 Mbit/s）
- 快速以太网（100 Mbit/s）
  - 千兆以太网（1000 Mbit/s）
  - 万兆以太网（10 Gbit/s）等。
  
  IEEE 802.3规范则是基于以太网的标准制定的，并与以太网标准相互兼容。

  在TCP/IP中，以太网的IP数据报文的封装格式由RFC894定义，IEEE802.3网络的IP数据报文封装由RFC1042定义。

  当今最常使用的封装格式是RFC894定义的格式，通常称为Ethernet_II或者Ethernet DIX。

- 

两个设备之间通信的五个要素：**发送者、接收者、介质、协议、数据。**

通信是双向的，主机A要发送数据给主机B，主机B也要回复。



如果要实现不同厂商的硬件，软件之间相互兼容，连通，就需要遵循一个统一的标准。



**计算机网络标准化工作 :**

**① 法定标准 :** 权威机构制订的正式的，合法的标准 , 比如计算机网络中指的是 OSI 七层参考模型 ;

**② 事实标准 :** 市场竞争中 , 占据了主流的的技术 , 该技术的协议标准 , 成为了 事实上的标准 , 计算机网络中指的是 TCP / IP 协议 ;

二、标准化工作流程

**RFC ( Request For Comments ) 标准化工作流程 :** 因特网标准的形式 , RFC 因特网标准 从制定 到正式称为标准 , 经过四个阶段 ;

**① 因特网草案 ( Internet Draft ) :** 该阶段的标准不是 RFC 文档 ; 只是一个草案 , 然后以邮件方式 , 发送给 RFC 编辑邮箱 ;

**② 建议标准 ( Proposed Standard ) :** 该阶段开始称为 RFC 文档 ;

**③ 草案标准 ( Draft Standard ) :** 将 上一个 建议标准放到网上 , 让其它人建议修改 , 请求评论 , 形成草案标准 ;

**标准化工作组织 :**

**① ISO ( International Organization for Standardization ) 国际标准化组织 :** 主要贡献是 提出了 OSI 七层参考模型 , HDLC 协议 ;

**② ITU ( International Telecommunication Union ) 国际电信联盟 :** 主要贡献是 制定通信规则 ;

**③ IEEE ( Institute of Electrical and Electronics Engineers ) 国际电气电子工程师协会 :** 学术机构 , 主要贡献是 制定 IEEE 802 系列的标准 , 5G 标准 ;

**④ IETF ( Internet Engineering Task Force ) 因特网工程任务组 :** 负责 因特网 相关标准制定 ; 审核 RFC 标准文档 ;





自 1997 年起，中国互联网络信息中心（CNNIC）定期组织开展中国互联网络发展状况统计调查工作，每年发布两次《中国互联网络发展状况统计报告》，至今已持续发布 52 次。《报告》力图通过统计数据真实反映我国互联网发展历程，成为我国政府部门、国内外行业机构、专家学者和广大人民群众了解中国互联网发展状况的重要参考。



# 因特网的组成



- 边缘部分

  由所有连接在因特网上的**主机**组成（台式电脑，大型服务器，笔记本电脑，平板，智能手机等）。这部分是**用户直接使用**的，用来进行**通信**（传送数据、音频或视频）和**资源共享**。

- 核心部分

  由**大量网络**和连接这些网络的**路由器**组成。这部分是**为边缘部分提供服务**的（提供连通性和交换）。



路由器是一种专用计算机，但我们不称它为主机，路由器是实现分组交换的关键构建，其任务是转发收到的分组，这是网络核心最重要的部分。

处在互联网边缘的部分就是连接在互联网上的所有的主机。这些主机又称为**端系统 (end system)**。

**端系统在功能上可能有很大的差别：**

1. 小的端系统可以是一台普通个人电脑，具有上网功能的智能手机，甚至是一个很小的网络摄像头。
2. 大的端系统则可以是一台非常昂贵的大型计算机。
3. 端系统的拥有者可以是个人，也可以是单位（如学校、企业、政府机关等），当然也可以是某个ISP。



**端系统之间通信的含义**

“主机 A 和主机 B 进行通信”实际上是指：“运行在主机 A 上的某个程序和运行在主机 B 上的另一个程序进行通信”。



**即“主机** **A** **的某个进程和主机** **B** **上的另一个进程进行通信”。简称为“计算机之间通信”（端到端通信）。端系统之间的通信方式通常可划分为两大类：**

**客户-服务器方式/CS架构：**

- 客户 (client) 和服务器 (server) 都是指通信中所涉及的两个应用进程。
- 客户 - 服务器方式所描述的是进程之间服务和被服务的关系。
- 客户是服务的请求方，服务器是服务的提供方。

> **服务请求方和服务提供方都要使用网络核心部分所提供的服务。**

**对等连接方式：**

- **对等连接** (peer-to-peer，简写为 **P2P** ) 是指两个主机在通信时并不区分哪一个是服务请求方还是服务提供方。
- 只要两个主机都运行了对等连接软件 ( P2P 软件) ，它们就可以进行**平等的、对等连接通信**。
- 双方都可以下载对方已经存储在硬盘中的共享文档。



# 因特网性能指标





## 速率





## 带宽和延迟

**带宽是指在单位时间（一般指的是1秒钟）内能传输的数据量**，是几乎所有互联网服务提供商在商业和营销中称之为"速度"的东西。

带宽 bandwidth ：**带宽是指在单位时间（一般指的是1秒钟）内能传输的数据量**，是几乎所有互联网服务提供商在商业和营销中称之为“速度”的东西。

带宽（bandwidth）也称为吞吐量（throughput），是指在一个固定的时间内（1秒），从网络一端流到另一端的最大数据位数，也可以理解为网络的两个节点之间特定数据流的平均速率。

带宽的单位是比特/秒（bit/s，简写为bps）。



带宽可以用高速公路做比喻来帮助理解它的含义：高速公路的车道可以衡量传输的能力。公路的宽度好比是带宽，行驶在公路上的汽车就好比是网络传输的数据。

车道越多，车辆通行能力就越强，发生堵车的概率就越低。同样的，拥有更宽的带宽，也就是有更大的数据传输能力。



在日常，我们与运营商签宽带，一般都是讲百兆带宽/千兆带宽，一百兆（100M），两百兆，其实这是一个带宽单位。表示单位时间内传输的数据量（每秒）。

在计算机网络或网络运营商中，100兆的准确描述应该是 100 Mbps，就是就是 Mega bits per second 。

在计算机中，数据容量的单位是大家常见的：B，KB，MB，GB。这个B是指 bytes 。

1 bytes = 8 bits

所以，100 Mbps = 100/8 MB/s = 12.5‬ MB/s

百兆宽带，理论上的下载速度，应该可以达到上述值，但是要考虑网络传输各种信号衰减和延迟，实际达不到这个理想环境。



**中国网络运营商带宽**

随着移动互联网的兴起、“云时代”的到来，把文件存储在网盘、把拍好的照片、视频分享到网上，已成为网民越来越普遍的需求。

网速快慢，不仅指下载速度，还需要更多需要提高上传速率。

而恰恰是在上传速率上，中国的宽带运营商显露出了严重的不足——**上下行不对称已经形成默认的潜规则，用户的上行带宽远远低于下行带宽。**

**ADSL时代，上行下行不对称是技术问题**，ADSL（Asymmetric Digital Subscriber Loop）技术是一种不对称数字用户线实现宽带接入互连网的技术，它采用频分复用技术把普通的电话线分成了电话、上行和下行三个相对独立的信道，从而避免了相互之间的干扰，一根线缆内多条电线上的对称信号会显著地限制数据传输速率与线缆的有效通信长度，在大多数情况下，其下行与上行带宽之比可达到10:1的比率。

**到了光纤时代，技术上是不存在不对称问题的**，光纤具有频带宽、容量大、信号质量好、可靠性高等特点，是目前宽带业务发展的方向。

是利用两条光纤分别负责上行和下行，不存在ADSL上下行不对称的技术问题，以PON技术为例，下行和上行是频分复用，互不影响，并且因为光纤传输的原理，即使你家离局端20公里，速率也不会有太大变化。



从拨号上网的ADSL时代发展到光纤，技术上已经解决了宽带网络的上下行速率对等问题。

但是实际上，光纤用户依然被宽带运营商限制了上行带宽，即使是光纤入户（FTTH）的百兆带宽，上传带宽也不足4M（上传速度最大为512K/s）。

他们都受网络带宽和设备性能制约。 在日常网络传输中大致1Mbps=1024/8Kb/s=128Kb/s(1/8)。

例如上行的网络带宽为100Mbps,那么最大上传速度就是12800Kb/s，也就是12.5Mb/s



**国内家庭宽带速率的现状**

如今家庭宽带已经普及100M宽带，而200M，500M甚至1000M的宽带也慢慢开始在各城市推广上线。根据工信部《工业和信息化部公告》〔2018年第54号〕

> 标准规定：公众用户固定宽带接入业务，当下行小于等于150M时，签约上行接入速率与签约下行接入速率按照最低1：5的比例配置，当下行大于150M时，签约上行速率不低于30M。从2019年1月1日起生效.

如果你家是电信200M用户，那么理应上行速率为30M，转换为上传速度，理论上满速约为4M/S，外网访问内网在线播放1080P电影实测流畅。



在网络中，有两个常见的与带宽有关的概念——“上行速率”、“下行速率”。

- 上行速率是指用户向网络发送信息时的数据传输速率；

- 下行速率是指网络向用户发送信息时的传输速率。

  

例如，用户用FTP上传文件到网上，影响上传速度的就是“上行速率”；而从网上下载文件，影响***的就是“下行速率”。





延迟 delay：数据从一个节点到另外一个节点所经历的时间，通常以 ms 为单位。

http://www.jiangmen.gov.cn/bmpd/jmszwfwsjglj/ztzl/wlxxaq/xxjs/content/post_1768548.html







# 中国互联网



中国互联网的一个重要特点是网络访问路径归中国政府所有，私营企业和个人只能从国家租用带宽。

前四大国网，即

| 中国骨干网名称         | 英文缩写 | 主管部门   | 运营者     | 服务对象                 | 开通时间 | 备注 |
| ---------------------- | -------- | ---------- | ---------- | ------------------------ | -------- | ---- |
| 中国科学技术网         | CSTNET   | 中国科学院 | 中国科学院 | 科研院校，政府，科技企业 |          |      |
| 中国公用计算机互联网   | ChinaNet | 邮电部     | 邮电部     | 公众                     |          |      |
| 中国教育和科研计算机网 | CERNET   | 国家教委   |            | 科研院校                 |          |      |
| 中国金桥信息网         | CHINAGBN | 电子工业部 |            |                          |          |      |



- 中国科学技术网

- 中国公用计算机互联网

- 中国教育和科研计算机网

- 中国金桥信息网

  

是中国大陆互联网的“骨干”。后来占主导地位的电信提供商也开始提供互联网服务。

2015 年 1 月，中国在连接北京、上海和广州的三个接入点的基础上，在世界互联网骨干网中增加了 7 个新接入点。

公共互联网服务通常由省级电信公司提供，有时在网络之间进行交易。没有全国性网络的互联网服务供应商无法与他们的带宽供应商电信公司竞争，而且经常会倒闭。

这些网络之间的互连是互联网用户的一个大问题，因为通过全球互联网的互联网流量非常缓慢。然而，主要的互联网服务提供商不愿帮助竞争对手。





## 骨干网

几台计算机连接起来，互相可以看到其他人的文件，这叫局域网，整个城市的计算机都连接起来，就是城域网，把城市之间连接起来的网就叫骨干网。

城域网逐渐向上汇聚，连接到省节点。省节点汇聚，连接到上层普通核心节点。核心节点汇聚，再连接到核心骨干节点。

另外，各个骨干节点互相连接，以提高连通性和带宽。这样，实现了中国电信的全国网络交换。



这些骨干网是国家批准的可以直接和国外连接的互联网。其他有接入功能的ISP（互联网服务提供商）想连到国外都得通过这些骨干网。

骨干网（Backbone Network）是用来连接多个区域或地区的高速网络。

每个骨干网中至少有一个和其他骨干网进行互联互通的连接点。不同的网络供应商都拥有自己的骨干网，用以连接其位于不同区域的网络。



ISP所管辖的网络就叫骨干网，骨干网的服务商就叫ISP。

## 中国骨干网

1987 年 9 月 20 日，北京中国兵器工业计算机应用研究所的钱天白教授，发出了我国第一封电子邮件，内容是：

> “Across the Great Wall we can reach every corner in the world. ”（“越过长城，我们能到达世界的每个角落。” ）

这封邮件当时具有极为深远的意义，它被视为中国与互联网的第一次 “亲密接触”。而钱天白教授，也被世人称为 “中国互联网之父”。



其实，当时钱天白所使用的网络，并不是我国自主建设的 Internet 骨干网。

而是 1986 年计算机应用技术研究所与德国卡尔斯鲁厄大学合作建设的一个国际联网项目——中国学术网（Chinese Academic Network，简称 CANET）



这封邮件的传输路径，也颇为曲折。邮件发出之后，首先通过意大利公用分组网 ITAPAC 设在北京侧的 PAD 机，跨过半个地球，进入意大利本土的 ITAPAC 主网。然后再进入德国的 DATEX―P 分组网。最终，到达卡尔斯鲁厄大学。

当时这条线路的速率仅仅只有 300bps。

不管怎么说，这封邮件还是拉开了中国互联网时代的序幕。此后，越来越多的国内高校和科研院所，开始加入到互联网的研究中，并尝试组建更大规模的计算机网络。



1994 年 4 月 20 日，NCFC 接入 Internet 的 64K 国际卫星专线正式开通（通过美国 Sprint 公司），实现了与 Internet 的全功能连接。从这一天起，中国正式迈入互联网世界的大门，被国际上承认为真正拥有全功能 Internet 的第 77 个国家。

一个月后，5 月 21 日，中科院计算机网络信息中心完成了中国国家顶级域名（CN）服务器的设置，改变了中国的 CN 顶级域名服务器一直放在国外的历史。

（中国顶级域名 CN 由钱天白教授于 1990 年 11 月 28 日代表中国正式在 SRI-NIC 正式注册登记。）



NCFC 连入 Internet 之后，中科院对它进行了进一步的扩建。

1995 年 4 月，中科院启动京外单位联网工程（简称 “百所联网”工程），目标是在北京地区已经入网的 30 多个研究所的基础上把网络扩展到全国 24 个城市，实现国内各学术机构的计算机互联，并与 Internet 互联。

1996 年 2 月，中科院做出决定，将以 NCFC 为基础发展起来的这个互联网络，正式改名为 “中国科技网（CSTNet）”。



### 四大IP骨干网

(1) 中国公用计算机互联网 CHINANET

(2) 中国教育和科研计算机网 CERNET

(3) 中国科学技术网 CSTNET

(4) 中国联通互联网 UNINET

(5) 中国网通公用互联网 CNCNET

(6) 中国国际经济贸易互联网 CIETNET

(7) 中国移动互联网 CMNET

(8) 中国长城互联网 CGWNET（建设中）：国防部，给军队专用，

(9) 中国卫星集团互联网 CSNET（建设中）



http://www1.cnic.cas.cn/xwdt/ttxw/201404/t20140419_4093684.html



### 中国科学技术网  

中国科技网实在中关村地区教育与科研示范网（NCFC）和中国科学院网（CASnet）的基础上，建设和发展起来的覆盖全国范围的大型计算机网络，是我国最早建设并获得国家正式承认具有国际出口的中国四大互联网络之一。

中国科技网的服务主要包括网络通信服务，信息资源服务，超级计算服务和域名注册服务。中国科技网拥有科学数据库，科技成果，科技管理，技术资料和文献情报等特有的科技信息资源，向国内外用户特工各种科技信息服务。

中国科技网的网络中心还受国务院的委托，管理中国互联网信息中心（CNNIC），负责提供中国顶级域"CN"的注册服务。



### 中国教育和科研计算机网（CERNET）

1994 年 7 月初，由清华大学等六所高校建设的 “中国教育和科研计算机网”试验网开通，并通过 NCFC 的国际出口与 Internet 互联。

1994 年 8 月，由国家计委投资，国家教委主持的中国教育和科研计算机网（CERNET）正式立项。

1995 年 12 月，“中国教育和科研计算机网（CERNET）示范工程”建设完成。这张网，就是我们现在常说的 “教育网”（大学生读者应该比较熟悉）。

CERNET是中国第一个覆盖全国的、由国内科技人员自行设计和建设的国家级大型计算机网络。该网络由教育部主管；

由清华大学、北京大学、上海交通大学、西安交通大学、东南大学、华中理工大学、华南理工大学、北京邮电大学、东北大学和电子科技大学等十所高校承担建设，于 1995年11月建成。

全国网络中心设在清华大学，八个地区网点分别设立在北京、上海、南京、西安、广州、武汉、成都、和沈阳。CERNET是为教育、科研和国际学术交流服务的非盈利性网络。



### 中国金桥信息网（CHINAGBN）

1993 年 3 月 12 日，朱镕基副总理主持会议，提出和部署建设国家公用经济信息通信网（简称金桥工程）。

1993 年 8 月 27 日，李鹏总理批准使用 300 万美元总理预备费，支持启动金桥前期工程建设。

1994 年 6 月 8 日，金桥前期工程建设全面展开。1995 年 8 月，金桥工程初步建成，在 24 省市开通联网（卫星网），并与国际网络实现互联。

1996 年 9 月 6 日，中国金桥信息网（CHINAGBN）连入美国的 256K 专线正式开通。

中国金桥信息网宣布开始提供 Internet 服务，主要提供专线集团用户的接入和个人用户的单点上网服务。



最终，国内形成了四大骨干网的格局。正是这些网络，支撑起了中国互联网的起步。

1997 年 12 月，四大骨干网实现互联互通。此后，中国的互联网，进入了崭新的时代！



### 中国电信/ChinaNet

1994 年 9 月，就在中国迈入互联网世界后不久，中国邮电部电信总局与美国商务部签订协议，正式启动中国公用计算机互联网的建设。

这个网，就是现在大名鼎鼎的中国第一骨干网——ChinaNet。



中国邮电部在 1995 年建立了 ChinaNet（中国公用计算机互联网），也就是大家俗称的 163 网。这张网，当时是国内普通网民接入互联网的主要通道。



1995 年 1 月，根据协议约定，邮电部电信总局分别在北京、上海开通了接入美国 Internet 的 64K 专线（同样是通过美国 Sprint 公司）。北京和上海这两个节点之间，采用 2M 带宽相连。

1996 年 1 月，电信总局正式开始向全社会提供 Internet 接入服务（通过电话网、DDN 专线以及 X.25 网等方式），于1996年6月在全国正式开通。这一举动，宣告了中国互联网民用化时代的开始。

由于窄带拨号接入的入网领示号为 163，因此 ChinaNet 也被称为 163 网络（和网易的 163 没有关系）。



因为当时中国邮电还没有实行 “邮电分营”，所以这张网是邮电部电信总局负责建设和维护。1997 年，邮电部实施 “邮电分营”，这张网的责任主体，变成了 “中国电信”（老电信）。

同年，中国电信各省公司开始独立建设省内 IP 骨干网（省网）。建成之后，整个 ChinaNet 分为骨干网、省网和城域网三级结构。其中，骨干网分为核心层、汇聚层两层。



1998年7月，ChinaNet骨干网第二阶段建设开始。八个大区域的骨干带宽被扩展到155M，且所有节点路由器被替换为千兆路由器。

到了2000年的下半年，中国电信借助DWDM（波分复用）和千兆路由器技术，再次对ChinaNet进行大规模升级和扩容。网络节点间的路由中继，由155M提升到2.5Gbps，提速16倍。

截至到2000年底，ChinaNet在国内总带宽已达到800Gbps。2001年3月，ChinaNet的国际出口总带宽突破3Gbps。



从2002年开始，ChinaNet逐步进入10G时代。ChinaNet的数据传输能力，达到国际先进水平。2003年，ChinaNet进行优化整合，推行扁平化，取消省网，网络结构调整为骨干网和城域网两级。



**ChinaNet 163主干网主要以202.97开头，AS4134，是电信最基础的负载网，2021年针对NTT和美国都进行了升级更新扩容。**

因为ChinaNet用户量大，高峰期会策略性丢包，且有QOS策略（企业、机房用的163和家用163完全不一样的感受）

（中国电信上海最近可以千兆宽带加50元/月升级精品网，就是这种高qos的163），它的特点是：宽带大，用户量大





CN2是中国电信网络线路，全名为中国电信下一代承载网，英文为Chinatelecom Next Carrier Network，缩写为CNCN，由于是两个CN字母组成，所以简称CN2。2004年左右，为了满足高品质业务的需求，中国电信启动了CN2网络的招标建设。2005年开始建设。

CN2，全称Chinatelecom Next Carrier Network（中国电信下一代承载网络），简称CNCN，又称CN2，刚好符合它作为中国电信第二张承载网的身份。

中国电信将CN2定位为“精品网络项目”，非常有前瞻性。后来的事实证明，CN2在抢占政企高端市场方面，确实发挥了重要作用。

CN2的基本建网特点，就是扁平化、大容量和轻载运行。建网初期的核心技术，是IP/MPLS。从架构上来看，CN2和ChinaNet有很大区别。

CN2一共是7个核心节点，分别是北京、上海、广州、南京、武汉、西安、成都。



相比老大哥ChinaNet的设备和技术都先进很多，比ChinaNet的体验更好，这些也决定了价格，一般只用于政企客户和数据中心，只有个别地区才能申请CN2家宽，如上海。在国内，CN2还是主要承载省际之间的网络互联。



为了解决境外服务器回到国内的网络拥堵问题，中国电信的CN2网络在这里起到非常关键的作用。

CN2还在香港、新加坡、东京、伦敦、法兰克福等国际大城市设立了POP节点，提供国际Internet接入和网间互联业务。

目前，CN2主要由北京出口到伦敦，上海出口到圣何塞、洛杉矶、法兰克福、东京、香港，广州出口到圣何塞、洛杉矶、新加坡、香港。



**这里补充一下：AS4809即CN2的主要IP段是59.43。**



目前中国电信共有两条线路接入全球互联网，分别是：163骨干网(也就是CN1)线路以及现在新建设的CN2线路；

**出海的时候这两条线路是相互独立的**，163骨干网(CN1)线路和CN2线路的简单区别如下：

- **163骨干网接入的是as4134带宽、CN2线路接入的是as4809带宽；**
- **163骨干网是以202.97 IP地址开头的路由，而CN2线路是以59.43 IP地址开头的路由；**
- **163骨干网海外出口带宽容量大，价格便宜，而CN2线路整体带宽容量较小，费用高；**



CN2 GT线路：中国电信CN2产品线中的Global Transit产品，特点是：**国际出口拥有单独的线路，但进入国内使用的是163出口线路；**

CN2 GIA线路：也是中国电信一款比较受欢迎的产品，特点是：就是在与目标服务器的连接路由中，从国内的跨省部分就开始走CN2，无需与普通用户产生拥挤，所以线路优化的更为彻底，属于专线，拥堵更少，连接更快，干扰最小。

​	**CN2 GIA拥有独立的回国线路，目前使用的用户有限，所以快速访问基本没有什么大问题；**

​	CN2 GIA作为目前中外国际线路中的最高级别，是企业型和高端用户的优先选择，与其它线路相比，CN2 GIA具有独一无二的连接优势

CN2 GT：GT是Global Transit的简称，其实就是依托于ChinaNet(AS4134)和CN2网络连接全球，国内部分走ChinaNet，国际部分走CN2。

一些VPS或者服务器商家把电信链路称之为CN2 GT，一些叫CN2，其实都是一个意思，但是跟直连还是两码事，这个要搞清楚。



### 中国联通

1994年7月19日，中国联通经国务院批准，正式挂牌成立，主要经营GSM移动通信业务。随着2G向3G的演进，有了GPRS数据业务，中国联通也建设了UNINET骨干网，作为自家GPRS网络的接入点，也是面向全国提供互联网服务的载体。

因为UNINET的拨号上网接入号码为“165”，所以这个网也被称为165网。

1999年10月22日，中国网通（小网通、老网通）由中科院、广电总局、铁道部、上海市政府四方出资成立，在全国17个城市开通互联网服务。

网通也建设了一张自己的骨干网，就是“中国网通公用互联网”（CNCNET）。

此外，邮电部当年除了163网之外，在1997年还建设了一张中国公众多媒体通信网。这张网络很特别，完全独立于163网，采用私有地址10.0.0.0/8，只能国内互相访问，相当于是一张“国内局域网”。如果需要访问163网和Internet的话，需要找专门的代理服务器跳转。

因为这张网络的接入号码为169，故又称169网。169网有一个很大的优势，就是价格便宜。当时163的使用费是每小时10元，而169只需要每小时4元。因此，169受到很多普通网民的喜爱。

2002年，国内电信行业重组，中国电信“南北分家”。北方九省一市电信公司从原中国电信剥离，与小网通、吉通合并，成立新的中国网通（大网通、新网通）。

“南电信，北网通”，于是，中国网通在既有CNCNET的基础上，得到了中国电信从163网拆出来的部分精华骨干网。为了区别于中国电信的163网，网通带走的这个网被称为“CHINA169”。

值得一提的是，当时吉通并入中国网通，CHINAGBN（中国金桥网）也随之并入CHINA169中。

2008年，中国电信业再次重组，中国联通和中国网通合并，变成新的中国联通。新的中国联通，自然而然地接管了CHINA169。

此外，网通最初的骨干网CNCNET（主要承载原网通NGN软交换、DCN等业务）也交给联通运营。这个CNCNET（自治域为AS9929，经常被称为9929网络）保持相对独立，后来被称为“联通A网”。

与之相对应的“联通B网”，就是原联通建设的IP承载网，主要承载2G/3G移动网业务的那个网。后来好像逐渐没用了，业务迁到了A网。

2018年，联通将IP承载A网改名为CUII，中国联通工业（产业）互联网。CUII的定位有点像中国电信的CN2，主要提供国际和国内跨地市MPLS-VPN和大客户互联网专线任务的承载，常用于企业宽带和IDC，极少用于家用宽带。

总之，联通主要就是“China169+CUII”的双网格局。







### 中国移动CMNET

2000年4月20日，中国移动正式成立，5月16日挂牌。

中国移动成立初期，也是主要以移动语音业务为主。后来，随着业务的发展，才逐步建设了较为完整的IP骨干网，名为CMNET（China Mobile Network，中国移动互联网），自治域为AS9808，也称9808网络。

当时，CMNET是中国移动GPRS网络的两大接入点（另一个是CMWAP）之一。通过CMNET接入点，中国移动手机用户可以接入CMNET网络，访问Internet。

CMNET为骨干网和省网两级自治域、多层结构。骨干网分为核心层、汇聚层和接入层。



北京、上海、广州3个节点为核心节点，它们与相连链路共同构成骨干核心层。骨干核心层提供大区内省份流量的交换，并负责全网与国际Internet、国内其他运营商的互联。

汇聚层负责汇接各省到骨干网的连接。南京、武汉、成都、西安、沈阳等节点为汇聚节点，负责本大区内省份流量之间的交换。

接入层负责汇聚本省省际流量和出网流量。接入节点一般双上联核心节点，部分流量较大的省份，会采用多上联。

国内和国际网间互联方面，节点都设置在北京、上海、广州。

除了CMNET之外，中国移动还有IP专用承载网，简称IP专网。当时建设这个网的主要目的，是为了承载高价值客户业务，如话音，流媒体，信令，网管，大型客户的VPN等业务。

IP专网为三层结构，分别为核心、汇聚和接入三层，采用单一自治域，目前已经延伸到国内330多个主要地市。





### ISP互联



这一层级的网络主要由电信运营商构建，可以是网络覆盖全球的顶级运营商，也可以是覆盖某区域、某国家甚至某几个城市的中小运营商。

电信运营商在这一层级因其覆盖范围、网络能力的差异，同样形成了 Tier1-Tier3 的层级结构。



中间层网络是对基础网络的补充与加强，不会产生直接面向终端用户的新互联网应用，而是服务于互联网的应用，也可称之为叠加网络层。

该层级涉及的企业涵盖面最广，既有专营CDN 和云业务的第三方服务商，也有电信运营商和内容服务提供商，甚至经营网络基础设施的 IDC 服务提供商、软件服务提供商和硬件设备厂商也加入其中。



物理互联是互联网网络之间的物理连接方式，可以分为直接电路相联以及交换中心互联。

直接电路，顾名思义，是两个互联网网络通过彼此的互通路由器进行直接电路的连接；



交换中心是多个网络主体为连通各自网络而建立的集中交换平台，也是他们之间交换流量和资源的服务场所。

直接电路相连通常适用于较大网络之间的流量交换，交换中心互联通常适用于大网与小网，以及小网之间的小流量集中交换。





逻辑互联是互联网网络之间交换流量与路由信息的方式，可以分为对等互联（Peering）与转接互联（Transit）。

对等互联，指两个网络通过 IP 路由协议，相互公平地交换各自网络及其客户网络的路由可达信息，但不允许对方通过自己访问与自己建立对等互联关系的第三方网络，对等互联通常适用于规模相当的网络之间，通常是免费模式，如全球顶级运营商 AT&T、NTT、TATA 网络间就采取了对等互联。



转接互联，指处于主导地位的网络向其他网络提供（出售）自己网络的完全路由可达信息，后者通过前者而获得互联网的通达性。与对等互联类似，转接互联也是通过 IP 路由协议实现不同网络之间的流量和路由信息交换。但转接互联是典型的客户－提供者的商务关系，用户（通常是下游网络）购买提供者（通常是上游网络，处于主导地位）的业务，转接服务的提供者允许其客户访问自己网络中的任一目的地址，并允许其透过自己的网络访问其他网络，因此转接服务的客户方通常需要按带宽规模向提供方支付互联结算费用，如中国移动、中国联通购买了 AT&T、Verizon 等全球顶级运营商的转接服务。





主要采用分层汇接方式，纵向分为骨干网、城域网和接入网三个层级。

首先，骨干网是最顶层的省际高速网络，基础电信运营商在各省省会及主要城市设置骨干节点，并在节点间设置直联链路，共同构成骨干网。骨干网内按分层方式设置核心节点、接入节点等，但近两年骨干网分层结构日渐模糊，逐渐向单层次、网状网（full-mesh）发展。其次，骨干网之下设置省网及城域网，用于省内流量的疏导，但近年来，随着网络扁平的不断深化，大部分省网基本被取消。城域网内部架构通常采用分层星形汇接结构，一般分为两到三层，下层节点以星形汇接的方式上联至上层节点。

城域网流量经过层层汇聚后，省际流量汇聚到骨干节点后再通过骨干网疏导。最后，城域网之下设置接入网，用于宽带用户/企业接入互联网。接入网包含固定接入网和移动接入网两部分。固定接入网即宽带用户/企业通过 DSL、光纤等固定方式接入，随着光纤宽带网络建设加速实施，目前大部分用户采用光纤接入方式；移动接入网即移动用户通过基站的移动方式接入（不含 WIFI 方式），随着4G 网络大规模部署，4G 用户逐渐成为主流，



网间架构以直联为主，网间带宽接近 4T。我国基础电信运营商的公众互联网网间主要通过设置在京沪穗等13个城市的骨干直联点，以及设置在京沪穗的交换中心实现互联





### 全球互联网发展历程

在互联网网络形成之初，能够提供的网络应用非常有限，电信运营商作为基础网络层的主体，负责接入所有的互联网企业与终端用户。

在此阶段，互联网网络架构实则是基础网络层架构



少数电信运营商搭建了全球性的互联网骨干网络，他们之间通过网络两两直联，构成了全球互联网的顶层架构。

这些电信运营商也被称之为 Tier-1 级运营商或全球顶级运营商。

其他区域或地区级的电信运营商，其互联网网络主要集中在某个区域或某个国家甚至某几个城市，他们通过购买 Tier-1 级运营商的转接服务，或者通过加强彼此之间的网络对等互联，实现全球通达，这些电信运营商被称之为 Tier-2 或 Tier-3 级运营商。

而其他终端用户、互联网内容提供商、各类有上网需求的企业主要通过接入这些电信运营商的网络实现连通。





进入二十一世纪后，随着互联网跨越式的发展，新业务新应用不断涌现，互联网日渐融入到人们工作、生活中，为满足人们不断提升的互联网应用体验要求，互联网业务需要尽可能靠近用户端，也推动着互联网网络架构一方面从基础网络单层结构扩展为基础网络与应用网络的多层结构，另一方面，网络互联方式更加丰富，网络主体在多个层面广泛对等互联，推向架构逐步迈向扁平。



一是 Tier2、Tier3 级运营商积极寻找互联机会。随着 Tier2、Tier3 级运营商网络的扩张，网间流量快速增长，在高昂转接结算费的压力下，下游网络开始寻找广泛对等互联机会。根据 PCH《2016年全球对等互联调查报告》，互联协议中 99.98%属于对等互联，仅有0.02%属于购买转接服务。与此同时，低连通度网络比例正在大幅缩减，2011 年-2016 年，低连通度网络占比从 62%降至 35%，缩减近一半。



二是各类互联网企业自建网络，形成应用网络层。随着互联网内容提供商的规模扩张，业务节点的不断增加，完全依托电信运营商网络难以实现多节点内容的实时同步与便利调度，互联网内容提供商纷纷自建骨干网络。与此同时，随着互联网创新的活跃，互联网上出现了将互联网应用更便捷地推向用户终端的 CDN 服务商，提供弹性网络资源降低互联网应用开发成本的云服务提供商，他们与互联网内容提供商一样，也搭建了自有骨干网，共同构建应用网络层。



三是交换中心的出现，促进网络扁平化演进。互联网交换中心的出现，吸引了包括中小电信运营商、互联网内容提供商、学校、研究机构等网络的广泛接入。各类网络主体通过接入交换中心，实现“一点接入、多点连通”，很好地满足了他们低成本、广覆盖的互联需求，促进网络的扁平化演进。





现阶段，随着互联网应用形态的不断丰富，互联网应用创新的日益活跃，互联网网络架构的应用网络层越发壮大，大型内容提供商、CDN 和云服务提供商开始掌握网络话语权。



以 Google、微软等公司为代表的大型互联网企业开始了全面的网络基础设施布局，涉足了包括自有骨干网、海缆、宽带接入（有线、无线）、数据中心、云服务、DNS 域名解析等多个领域。从节点来看，如 CDN 服务提供商 Akamai 在全球 100 多个国家、900 多个城市拥有超过 2500 多个节点，甚至高于全球顶级运营商的节点数量；从网络规模来看，全球互联网企业自建骨干网带宽复合增长率 70%，远超运营商骨干网带宽 39%复合增长率。

由此，大型内容提供商议价能力和互联地位大幅提升，Google、Amazon、Facebook 等都与多家 Tier1运营商实现对等互联。

**应用层网络正在牵引网络流量与网络架构的变迁**

互联网的流量不再完全由基础网络层的路由策略决定，应用层网络通过部署全局负载均衡（GSLB）、CDN 等方式引导自有流量。从流量看，Akamai
承载全球 30%的流量，而 Google 的网络一旦发生故障，将影响全球40%流量，这都充分说明了应用网络层对于网络的掌控力正在逐步加强。





全球互联网发展驶入快车道，流量增长不断提速。全球化背景下，区域之间、国家之间的信息往来日趋频繁。作为数据传输和资源共享的主要载体，互联网在支撑企业跨境运营、公众跨境访问方面发挥了重要作用，其承载的数字化信息流量在加速增长。2012 年-2016 年，全球互联网流量从 510.6 EB 攀升至 1125.6 EB，年复合增长率达到 21.9%；预计 2017 年-2021 年，全球互联网流量将以更高的速度增长至 3200 EB 以上，这对互联网网络架构有效承载流量提出更高要求。





配合完成视频分发、提升用户体验的 CDN 网络逐渐成为互联网流量的主要载体。随着蓝光、4K、超高清等技术渐被广泛应用于各类视频服务，互联网视频业务对全球互联网流量的贡献力度正在逐年增强。2012 年-2016 年，互联网视频业务流量在全球互联网流量中的占比从 65%上升到 73%。而 CDN 网络作为保障视频业务质量的基础，受到愈来愈多的互联网视频服务提供商的青睐，而互联网巨头倾向于自建 CDN 实现包括视频在内的多种静态自有内容的分发。由此，CDN 对互联网流量的承载和疏导作用日益凸显，自建 CDN 成为主力军。2012 年-2016 年，CDN 承载流量在全球互联网流量中的占比从33.7%上升到 52.0%，其中 Google、Amazon、Facebook 和 Microsoft等巨头自建 CDN 的流量占比在 2016 年达到 61%；预计 2017 年-2021年，CDN承载流量在全球互联网流量中的占比将持续累积至70%以上，这恰好是网络掌控力转向应用网络层的例证。



不论是 Google 曾在美国试点的 GoogleFiber、搭建的浮空通信平台，还是 Google、百度、阿里、腾讯纷纷运营的公共递归 DNS，都属于互联网企业对
于基础网络层业务的尝试。而迅雷、小米等诸多互联网企业试图将CDN 的缓存节点推向用户边缘，则算是对基础网络层服务的间接替代。





# ASN和BGP

我们已经理解同一个运营商比如中国电信的网络的流量连接。那么，如果是中国联通和中国电信的互相连接呢？

ISP 之间往往会在核心机房出连接，进行流量交换。



**AS4837 中国联通 辽宁朝阳市 -> AS4837 中国联通 辽宁沈阳 -> AS4837 中国联通 北京 -> AS4134 中国电信骨干网 北京 -> AS4134 中国电信 广东广州 -> AS4134 中国电信 广东深圳**



需要在 ISP 之间流量交换，也是我们跨运营商连接往往质量不如同运营商连接的原因之一。

 

一般大型 ISP 之间的流量阶段会因为流量不均衡，分为对等和不对等的关系。不对等的关系，往往意味着网间的流量需要在经济上进行结算。

有趣的是，根据工业和信息化部的安排，中国电信、中国联通和中国移动三大运营商以及中国教育和科研计算机网、中国科技网、中国国际经济贸易互联网、中国长城互联网等公益性网络无需向任何其他运营商支付网间结算费用（2020 年 7 月 1 日以前，中国移动须单方面向中国电信和中国联通按照最高 8 万元 / Gbps / 月支付网间结算费用）。





## 跨国传输

跨国互联网传输，不得不请出我们的海底光缆了。

海底光缆，Submarine (Undersea) Optical Fibre Cable，又称海底通讯电缆，是用绝缘材料包裹的导线，铺设在海底，用以设立国家之间的电信传输。



比如亚太直达海底光缆，就提供了中美的网络连接能力。

亚太直达海底光缆（英语：Asia-America Gateway，简称 AAG），又称亚美国际海缆，是一条长 20,000 千米（12,000 英里）的海底通信光缆系统，通过关岛和夏威夷横跨太平洋，连接东南亚与美国大陆。这条海缆取代 2000 年启用、2016 年退役的中美海缆。



## 自治系统

更具体地说，自治系统（AS）是具有统一路由策略的巨型网络或网络群组。连接到 Internet 的每台计算机或设备都连接到一个 AS。

通常，每个 AS 由单个大型组织（例如 Internet 服务提供商（ISP）、大型企业技术公司、大学或政府机构）运营。

**自治系统或自治域**（英文：Autonomous system, AS）是指在互联网中，一个或多个实体管辖下的所有 IP 网络和路由器的组合，它们对互联网执行共同的路由策略。AS 必须具有一个公开且正式登记的自治系统编号（ASN）。

ASN 编号是受由互联网地址分派机构（IANA, Internet Assigned Numbers Authority）统一管理的。



每个 AS 都分配有一个官方编号或自治系统编号（ASN），类似于每个企业如何获得具有唯一官方编号的营业执照。外部各方通常仅通过编号来引用 AS。

AS 编号或 ASN 是介于 1 和 65534 之间的唯一 16 位数字或介于 131072 和 4294967294 之间的 32 位数字。

它们通过这种格式表示：AS（数字）。例如，Cloudflare 的 ASN 是 AS13335。据不完全估计，全世界有超过 90,000 个 ASN 在使用。



我们熟知的互联网是由一个又一个的自治系统 AS 组成的。我们平时可能会对设备的 IP 地址比较关注。但是，无论我们使用的家庭宽带还是机房网络，设备都会连接到 1 个 AS。我们可以这样作比喻，IP 地址就是我们具体地址的门牌号。AS 更像是我们的管辖邮局。而 ASN 更像是受到统一规定的邮政编码。



| **所属类型**          | **ASN** | **名称**                                       | **IPv4 IP** **数量** | **IPv6 IP** **数量** |
| --------------------- | ------- | ---------------------------------------------- | -------------------- | -------------------- |
| 运营商 ISP            | AS3356  | LEVEL3 - Level 3 Parent, LLC, US               | 29,798,832           | 73,301,954,048       |
| 互联网企业            | AS15169 | GOOGLE - Google LLC, US                        | 14,223,104           | 103,096,123,392      |
| 互联网企业 / 云服务商 | AS45090 | TENCENT-NET-AP - Tencent                       | 4,906,496            |                      |
| 大学 / 研究机构       | AS7377  | UCSD - University of California, San Diego, US | 12,855,552           | 5,368,709,120        |

不同规模的 AS 例子，不同类型的机构都可以是作为一个 AS 存在于互联网上。

另外，每个 AS 都会控制一定数量的 IP 地址空间。这样，我们如果想要达到某一 IP 地址，就有迹可循了（之后我们会介绍 BGP）。





### Internet Exchange Point (IXP)

Internet 交换点 (IXP) 是一个物理位置，Internet 服务提供商 (ISP) 和 CDN 等 Internet 基础设施公司通过它相互连接。这些位置位于不同网络的 “边缘”，并允许网络提供商在他们自己的网络之外共享传输。通过在 IXP 位置内部存在，公司能够缩短来自其他参与网络的传输路径，从而减少延迟，缩短往返时间，并可能降低成本。



IXP 的作用很好理解：在物理结构上，假如我们有 AS1、AS2、AS3，如果我们要形成直接的互联关系，最暴力的方式两两互联形成星型结构，然而这么做是不经济的。如果有一个专业的机房，给我们提供了一个稳定量大的集换节点，许多 AS 都去接入这家节点，我们就能很方便地和各个 AS 做直接流量交换。—— 当然，实际的接入会考虑到成本问题，可以灵活地制定和数个 AS 的流量交换策略。

IXP 工作在 OSI 网络模型第二层，协议栈和我们家用的路由器没什么两样，重点在其规模。



## AS 规模和连接关系

考虑连接关系之前，我们还是要考虑一些技术世界外的关系。

不同 AS 之间的规模可能是不同的，那么 AS 之间的流量流入和流出可能也是不同的。这意味着，在商业关系上，AS 之间可以分为也意味着不同的结算关系。

- Tier1 级别的运营商一般是有海底光缆、覆盖大的巨型运营商，如 AS3356 Level 3，AS3491 PCCW 等。

- Tier2 Tier3 级别的运营商向下分销。这就意味着流量是和商业行为绑定的。

互联网中的自治域之间存在着商业上的竞争关系，跨自治域的流量传输遭遇质量降级甚至传输失败并不鲜见。



### AS 连接关系

有许多对 AS 拓扑关系的研究工作。这里介绍 Caida.org 对 AS 关系的定义。

- Provider 和 Customer
  - 即提供者与消费者的关系。商业关系上，是 Customer 向 Provider 付费
  - Customer 为了连接更广泛的网络，会通过 Provider 访问互联网的其余部分（后文说的 Transmit）
- Customer 和 Provider
  - 即消费者与提供者的关系。商业关系上，是 Provider 向 Customer 收费
  - Provider 向 Customer 提供更广泛的互联网访问
- Peer 和 Peer
  - 两家 AS 往往流量规模相当，他们不互相结算流量
  - 这个连接关系只交换两家 AS 的内部流量

#### Transit

即我们刚才提到的 Provider 和 Customer 关系。由上层 ISP 提供向其和互联网其余部分的连接。Customer 向 Provider 付费。

#### Peering

AS 之间通过私有专线或者接入 IX 的方式，形成对等的连接。AS 之间互相的流量是对等的，所以才产生这种不结算的关系。





## BGP 协议

边界网关协议（英语：Border Gateway Protocol，缩写：BGP）是互联网上一个核心的去中心化自治路由协议。它通过维护 IP 路由表或 “前缀” 表来实现自治系统（AS）之间的可达性，属于矢量路由协议 (wikipedia)。

我们这之前提到，AS 控制一定数量的 IP。换句话解释，BGP 会将 AS 自身的 IP 路由信息发送给邻居连接的 AS，并接受其他 AS 传递的 BGP 信息，

我们本节会对 BGP 的原理进行了解，去理解 BGP 是如何让我们全世界可达的。具体对 BGP 协议有兴趣的读者可以参阅相关的更深入的资料。

BGP 也分为 EBGP 和 IBGP。我们这里重点讨论的是 **AS** **之间的 EBGP**（运行于不同 AS 之间的 BGP 称为 EBGP）。





# **接入网和接入技术**

接入网是指将端系统连接到其边缘路由器的物理链路。边缘路由器是端系统到任何其他远程端系统的路径上的第一台路由器。



接入技术要解决的问题是如何将用户连接到各种网络上，分为两个层面：

一是个人用户如何连接到网络（主要指互联网）上

二是单位的局域网如何连接到 Internet 以及分公司网络与总公司网络的连接，即网络之间的相互连接问题。



用户计算机连接到某个 ISP（Internet Service Provider，互联网服务提供商），直接访问互联网。

PPP（Point to Point Protocol），即点对点的协议，它是一种数据链路层协议，它为在廉价的线路（RS232 串口链路、电话 ISDN 线路等）上传输 OSI 模型中的网络层报文提供了一种有效的方法。人们早期通过拨号上网就是使用了这种技术。



**ASDL**

ADSL（Asymmetric Digital Subscriber Line， 非对称数字用户线路）是 xDSL 家族（ADSL、VDSL、HDSL 等）中的一员，因为 ADSL 技术提供的上行带宽和下行带宽不对称（不相等），因此称为非对称数字用户线路。ADSL 利用分布广泛的公共电话线路来为用户提供互联网服务，在用户电话进线处用一个分离器将电话线一分为二，一边连接用户的电话机，另一边连接一个 ADSL Modem（俗称“猫”）的终端设备，在 ADSL Modem 上通过双绞线连接计算机，用户通过拨号方式来访问互联网。

ADSL 采用频分复用（FDM）技术把普通的电话线分成了三个独立的信道，即语音信道、上行信道和下行信道。

语音信道用于传输电话语音，上行信道和下行信道用于传输上网的数据，三个信道不会相互干扰，这样就解决了 PPP 拨号方式下打电话和上网不能同时进行的问题。 理论上，ADSL 可在 5km 的范围内，在一对铜缆双绞线上提供最高 1Mbps 的上行速率和最高 8Mbps 的下行速率，能同时提供话音和数据业务。

一般来说，ADSL 速率完全取决于线路的距离，线路越长，速率越低。 ADSL 技术能够充分利用现有公共交换电话网的线路资源，只需要在线路两端加装 ADSL 设备即可为用户提供较好的宽带服务，无须重新布线，从而可极大地降低建设成本。

因此，ADSL技术在居民宽带接入中得到了广泛的应用，为互联网的推广和普及起到了极大的推动作用。

最新的 ADSL2+技术可以提供最高 24Mbps 的下行速率，和第一代 ADADSL2+打破了 ADSL 接入方式带宽限制的瓶颈，在速率、距离、稳定性、功率控制、维护管理等方面进行了改进，其应用范围更加广阔。



**FTTB/FTTO/FTTH/FTTR**

随着互联网的发展，人们对多媒体音视频的使用已非常普遍，高清图像和视频的传输需要大的带宽线路，但传统的 ADSL 只能提供最高理论值为 8Mbps 的下载带宽，这个带宽是永远不会改变的，而且在实际使用过程中，由于普通电话线路噪声的影响，很难达到 8Mbps 的理想带宽。显然，传统的 ADSL 技术已不能满足用户对上网带宽的需求，迫切需要一种新的技术来取代传统的电话线路。

FTTx是“光纤到x（Fiber To The x）”是光纤通信中光纤接入的总称，x代表光纤线路的目的地。

如 x = H(Fiber to the Home)光纤到户，x = O(Fiber to the Office)光纤到办公室x = B(Fiber to the Building) 光纤到楼。

FTTx技术范围从区域电信机房的局端设备到用户终端设备，包括

- 光线路终端OLT（Optical Line Terminal）
- 光网络单元ONU（Optical Network Unit）
- 光网络终端ONT（Optical Network Terminal）



根据光网络单元ONU在用户端的位置不同，FTTx有多种类型，可分成

- 光纤到交换箱（FTTCab）

- 光纤到路边（FTTC）

- 光纤到大楼（FTTB）

  “B"代表"Building”，即光纤到楼宇。FTTB通常将光纤引入多户住宅楼宇或商业大厦，而不是单一住宅。在这种情况下，光纤通常到达建筑物内的一个中心位置，然后通过内部布线将互联网服务传送到各个单位。

- 光纤到户（FTTH）

  “H"代表"Home”，即光纤到户。这种情况下，光纤被铺设到用户的家庭内，通常调制解调器或光纤终端设备被安装在用户的家中，以提供互联网服务。FTTH适用于个人家庭，服务范围覆盖整个家庭。

- 光纤到办公室（FTTO）

- 光纤到桌子（FTTD）

  “D"代表"Desk”，即光纤到桌子。这种应用通常见于企业环境，光纤被铺设到每个工作台，以提供高速网络连接。

等服务形态。美国运营商Verizon将FTTB及FTTH合称光纤到驻地（FTTP）。

由于光传输技术的极大进步，以及光纤制造成本的大幅下降，使得大面积的光纤布线成为可能。同时，国家为实现互联网战略，在全国各大中小城市积极实施“光进铜退”工程，各大运营商将光纤铺设到了城市的每一栋楼内，即所谓的光纤到楼（Fiber to The Building，FTTB），很多地方已实现了光纤到户（Fiber to The Home，FTTH），从而取代基于铜线的传统公共电话网。**千兆光纤入户**的方案正在受到运营商的关注。

FTTB 采用的是专线接入，光纤直接通到大楼，再用双绞线接到用户的计算机上，用户上网无须拨号，使用起来与单位的局域网用户是一样的。 FTTH 是光纤直接通到用户家中，连接到一个称为“光猫”的用户终端设备上，在“光猫”的 LAN 口上连一条双绞线到用户的计算机上，再通过与 ADSL 一样的拨号方式上网。





CPE的全称叫做Customer Premise Equipment，业内喜欢称之为“客户终端设备”。其实，Premise有“前提、假设”的意思，更准确的翻译应该是“客户前置设备”

所谓“前置”，是指它总是站在用户设备的“前面”。它的作用，是将移动通信信号（4G、5G等）或有线宽带信号，转换成本地局域网信号，供用户设备使用。

CPE，即**用户终端设备，通常是指安装在用户地点，如家庭或企业中，由互联网服务提供商(ISP)管理的设备**。 

`CPE`可能包括各种类型的设备，例如调制解调器(Modem)、网关、无线接入点(WAP)甚至是一些特定的网络终端设备，其核心目的是为用户提供网络接入服务。

从本质上来说，**光猫属于CPE的一种**。 光猫和5G CPE的区别在于，光猫向上连接的是运营商光纤接入网设备，而5G CPE连接的是5G基站。 

目前5G CPE产品，使用的都是和5G手机相同或类似的5G芯片，它拥有强大的5G接入能力，支持SA/NSA组网，兼容4G/5G信号。

5G CPE，属于一种5G终端设备。它接收运营商基站发出的5G信号，然后转换成Wi-Fi信号或有线信号，让更多本地设备（手机、平板、电脑）上网。

可以说，5G CPE就是一个加强版“光猫”。5G CPE的优势，就是移动性和灵活性。

与常规“光猫”只能固定在一处使用不同，5G CPE可以“移动”。凡是有5G信号的地方，都可以使用5G CPE。

例如，当我们一家人去郊区别墅度假时，可以使用5G CPE，架设一个Wi-Fi 6高速热点，让家庭成员们都能够上网，分享游玩的视频。

再比如，当公司外出举办活动或参加展会时，可以使用5G CPE，方便员工和客户上网。甚至你要去摆地摊，也可以带上CPE，相当于带了一根光纤宽带在身边。

传统的“光纤宽带”，开通起来还算比较容易，去营业厅办理套餐，就能开通。但取消就麻烦多了。现在的宽带业务，基本上都有协议期，协议期没结束，就不能随意停机。



5G CPE体积大，天线增益更强，功率更高，信号收发能力比手机更强，所以还经常被用于各种外场5G场景测试。

简而言之，5G CPE融合了Wi-Fi的低成本，还有5G的大带宽，将两者的优势结合，形成对传统光纤宽带的有力补充。

除了上网之外，5G CPE未来还会充当家庭智能网关的作用。

一直以来，家用路由器市场都是众多厂商的竞争焦点。不是因为路由器赚钱，而是因为它是全家网络流量的出入口，也是家庭数字应用的基础平台。

5G CPE，扮演着和路由器同样的角色，它将是未来5G家庭的“智慧网关”，更是全家智能生活的支点。

用户通过5G CPE，可以控制家中的多种智能设备，在实现万物互联的同时，显著提高了家庭成员的生活体验。

https://36kr.com/p/2172154926737923





**无源光网络PON(Passive Optical Network)技术**是最新发展的点到多点的光纤接入技术。

PON是一种纯介质网络，利用光纤实现数据、语音和视频的全业务接入。

无源光网络是指利用**点对多点拓扑**和**分光器**将数据从单个传输点传送到多个用户端点的光纤网络，与 AON 相比，多个客户通过光纤分支树和无源分路器/合路器单元连接到单个收发器，完全在光域中运行，在 PON 架构中没有电源。

PON 是指（服务提供商的中心局）局端的 **OLT（光线路终端）设备**和（终端用户）客户端的 **ONU（光网络单元）设备**，以及连接 OLT 和 ONU 的 ODN（光分配网络）全部采用无源设备的光接入网络。

- OLT是放置在局端的终结PON协议的汇聚设备。
- ODN是一个连接OLT和ONU的无源设备，它的功能是分发下行数据，并集中上行数据。
- ONU是位于客户侧的给用户提供各种接口的用户侧终端。

在PON中，OLT到ONU的数据传输方向称之为下行方向，反之为上行方向。上下行方向数据传输原理是不同的：

- 下行方向：OLT采用广播方式，将IP数据、语音、视频等多种业务，通过1：N无源光分路器分配到所有ONU单元。当数据信号到达ONU时，ONU根据OLT分配的逻辑标识，在物理层上做判断，接收给它自己的数据帧，丢弃那些给其它ONU的数据帧。
- 上行方向：来自各个ONU的多种业务信息，采用时分多址接入TDMA(Time Division Multiple Access)技术，分时隙互不干扰地通过1：N无源光分路器耦合到同一根光纤，最终送到OLT。

因此，设备上的PON接口亦称之为PON上行接口。

PON 有 EPON 和 GPON 两种技术。IEEE 802.3ah工作组制定了Ethernet PON(EPON)标准，ITU/FSAN制定了Gigabit PON(GPON)标准。

- EPON（**以太网无源光网络**） 采用 IEEE 802.3 标准，采用以太网格式封装，技术简单，成本较低；

  可提供上、下行对称的1.25Gbit/s线路传输速率，实现一个点到多点结构的吉比特以太网光纤接入系统。EPON属于IEEE以太网标准的范围，对于向全IP网络过渡是一个很好的选择。

- GPON（**千兆无源光网络**） 由 ITU-T 标准化，采用 GEM 封装，技术复杂，成本较高。



在EFM提出EPON概念的同时，ITU/FSAN又提出了GPON，并对其进行了标准化，其技术特色是在二层采用ITU-T定义的通用成帧规程GFP（Generic Framing Procedure）对Ethernet、TDM、ATM等多种业务进行封装映射，能提供1.25Gbit/s和2.5Gbit/s下行速率，和155Mbit/s、622Mbit/s、1.25Gbit/s、2.5Gbit/s几种上行速率，并具有较强的OAM功能。当前在高速率和支持多业务方面，GPON有优势，但技术的复杂和成本目前要高于EPON，产品的成熟性也逊于EPON。

近年来，PON承载由于其具备长距离传输、高QoS保证和高带宽性能等优势，已经逐渐成为下一代接入网的主流承载技术。

EPON 和 GPON 两者虽然都是无源光网络，但采用的是不同的标准体系。由于 GPON 的技术更先进，随着制造成本的下降，GPON 是今后的发展主流。

| 项目               | EPON             | GPON                                        |
| ------------------ | ---------------- | ------------------------------------------- |
| 下行速率           | 1.25Gbit/s       | 1.25Gbit/s或2.5Gbit/s                       |
| 上行速率           | 1.25Gbit/s       | 155Mbit/s、622Mbit/s、1.25Gbit/s或2.5Gbit/s |
| 分路比             | 取决于光功率预算 | 取决于光功率预算                            |
| 最大传输距离       | 10km或20km       | 20km                                        |
| 数据链路层协议     | 以太网           | GEM或ATM                                    |
| 封装效率           | 高               | 更高                                        |
| 技术标准化程度     | 完备             | 一般                                        |
| 芯片、器件成熟程度 | 高               | 一般                                        |
| 理论成本           | 低               | 低                                          |
| 实际成本           | 低               | 高                                          |

## **光线路终端 (OLT)**

OLT是无源光网络的起点，它通过以太网电缆连接到核心交换机。

OLT 的主要功能是为 PON 网络转换、帧和传输信号，并协调光网络终端复用以共享上行传输。

OLT设备一般包含机架、CSM（Control and Switch Module）、ELM（EPON Link Module，PON卡）、冗余保护-48V直流电源模块或1个110/220V交流电源模块、风扇。

在这些部分中，PON卡和电源支持热插拔，同时内置另一个模块，OLT 有两个浮动方向：**上游**（从用户那里分配不同类型的数据和语音流量）和**下游**（获取数据、语音、

OLT 是放在 ISP 数据机房的连接设备，也称为 OLT 交换机，一般直接连在 BRAS 下，一个 OLT 通过分光器可以挂多个 ONU。

它的功能包括一方面将承载各种业务的信号在局端进行汇聚后向终端用户传输，另一方面将来自终端用户的信号按照业务类型分别送入各种业务网中，它是 PON 的核心部分。

## **光网络单元（ONU）/光网络终端（ONT）**

ONU 将通过光纤传输的光信号转换为电信号。然后将这些电信号发送给各个订户。

通常，ONU 和最终用户的住所之间有一段距离或其他接入网络，此外，ONU 可以发送、聚合和整理来自客户的不同类型的数据，并将其向上发送到 OLT。

整理是优化和重组数据流的过程，以便更有效地交付，OLT 支持带宽分配，允许平滑地将数据浮动传输到 OLT，这些数据通常以突发的形式从客户到达，ONU 可以通过多种方式和电缆类型连接，如双绞铜线、同轴电缆、光纤或通过 Wi-Fi。

最终用户设备也可以称为光网络终端 (ONT)，其实ONT本质上和ONU是一样的，ONT 是 ITU-T 术语，而 ONU 是 IEEE 术语，属于不同的标准体，都是指GEPON系统中的用户侧设备，但在实践中，ONT和ONU根据它们的位置有一点区别。

**ONT是光网络终端，应用于最终用户，俗称光猫。ONU是指光网络单元，它与最终用户之间可能还有其他网络。**

举个简单的例子，比如在一个小区里面，ONT是直接放在用户家中的设备，而ONU可能就是放置在楼道中，各个用户通过交换机等设备连接至ONU。

ONT（Optical Network Terminal）即光网络终端，俗称光猫，是接入网络中为家庭用户提供网络的设备，可以提供高速上网、IPTV、语音、WiFi等业务。

ONU设备是指光网络单元（Optical Network Unit）设备，它是一种用于光纤网络接入的终端设备。

ONU设备常见于光纤到户（FTTH）网络中，它充当光纤网络与用户设备之间的桥梁，实现光纤信号的解析和转换，以便用户设备能够与光纤网络进行通信。

ONU设备通常包含一个光学接口，用于接收来自光纤网络的光信号，并将其转换为电信号供用户设备使用。

ONU设备还提供一个或多个用户接口，用于连接用户设备，如计算机、路由器、电话等。通过这些用户接口，用户设备可以通过ONU设备与光纤网络进行通信，实现高速、稳定的网络接入。

**ONU 是放置在客户端的光网络连接设备，现在运营商提供的光纤入户业务中，家庭用户终端设备使用的“光猫”就是一种 ONU。**

它的一端通过光纤连接到 ISP 运营商，另一端通过电口（双绞线）连接到用户计算机。

图 7-5 所示是一款“光猫”实物图，左边是连接光纤的接口，标记为 POTS 的端口可以连接电话机，LAN 口可连接计算机。有的 ONU 设备上还有 CATV（电视）接口。

桥接型ONT仅负责透传，为用户提供上网和IPTV通道，在用户设备如路由器或者PC上拨号成功后才可以连网。部分桥接ONT还支持语音功能，可以连接电话机。

桥接型ONT如果下游连接一个无线路由器，就可以无线上网了。

网关型ONT相比桥接型ONT来说，它可以实现路由转发自动分配IP地址，无需用户自己拨号即可连网。部分网关型ONT还自带双频WiFi（2.4G Hz & 5G Hz），可提供无线网络。

智能ONT与传统ONT最大的差别在于，它可以与传感器（门磁/烟雾/水浸/红外报警器等）配套使用，提供实时视频监控、智能提速、家居控制等新功能，结合云平台和智慧家APP还可实现智能家居的远程控制。

融合网关主要是将STB功能（iTV）集成到网关ONT上，减少盒子的数量，安装化繁为简，并且支持4K视频，它主要用于酒店场景，一站式解决Wi-Fi覆盖和视频体验。

10G PON ONT的用户侧速率可达千兆，不仅可以满足家庭用户的4K/8K高清视频、AR/VR、家庭云，视频通话等高带宽业务，还可提供高达万兆的专线接入业务。

ODN 位于 OLT 和 ONU 之间，为 OLT 和 ONU 提供光传输手段，完成光信号在传输过程中的分配任务。

它不是单独的一个设备，而是包括了光纤、光纤配线架、光交接箱、光分线盒、光分路器、光转接头和尾纤等一系列设备。

简单地说，就是把 OLT 和众多 ONU 连接起来的中间设施，是运营商光网络的最基础部分。

ODN 是无源的，所谓无源就是不需要供电，无须担心因停电而造成网络中断，只要保证中心机房设备正常工作即可，因此对运营商来说是非常省事的。

FTTH 的优点主要有：

第一，它是无源网络，从局端到用户，中间基本可以做到无源，对运营商来说维护非常简单；

第二，传输介质采用的是光纤，因此传输距离远，适合于大规模部署；

第三，从理论上来讲，单模光缆的带宽可以做到无穷大，也就是说单模光缆的带宽可以是无限的，因此不再有 ADSL 的带宽限制；

第四，FTTH 的上行数据带宽和下行数据带宽是相等的，不存在 ADSL 中的非对称情况。



ONT就是我们俗称的光猫，分为

- SFU（SingleFamilyUnit，单个家庭用户单元）
- HGU（HomeGatewayUnit，家庭网关单元）
- SBU（SingleBusinessUnit，单个商业用户单元）



SFU一般具有1～4个以太网接口、1～2个固定电话接口，有的型号还具有有线电视接口。

SFU不带家庭网关功能，需通过以太网口连接的终端才能拨号上网，远端管理功能弱。FTTH早期使用的光猫属于SFU，目前已很少使用。



近几年开通的FTTH用户配备的光猫均为HGU。相对于SFU，HGU具有如下优点：

（1）HGU属于网关设备，便于家庭内部组网；而SFU则是一个透传设备，不具备网关能力，在家庭组网时一般需要如家用路由器的网关类设备配合。

（2）HGU支持路由模式，具备NAT功能，是一个三层设备；而SFU型仅支持二层桥接模式，相当于一个二层交换机。

（3）HGU可以实现自身宽带拨号应用，下挂的电脑、移动终端等可以不拨号直接上网；而SFU则必须由用户电脑等终端或家用路由器拨号上网。

（4）HGU更易于大规模运维管理。HGU通常自带wifi，并带有USB接口。



SBU主要用于FTTO用户的接入，一般具有以太网接口，有些型号具有E1接口、固定电话接口，或带wifi功能示。

相对于SFU和HGU，SBU的电气防护性能更好、稳定性更高，也常用于室外如视频监控等场合。





ONU分为MDU（Multi-DwellingUnit，多住户单元）和MTU（Multi-TenantUnit，多租户单元）

MDU主要应用于FTTB应用类型下的多个住宅用户的接入，一般具有至少4个用户侧接口，通常具有8路、16路、24路FE或FE+POTS（固定电话）接口。





## PPPoE协议

PPP 协议是为串行通信设计的，它具有身份认证和计费等优点，但它是窄带技术，带宽非常有限。而以太网技术发展迅猛，尤其是快速以太网的广泛应用为用户提供了更大的带宽，但在传统的以太网模型中，并不存在所谓的用户计费的概念。

因此，如何解决高带宽和用户控制管理之间的矛盾是运营商迫切需要解决的问题。

IETF 的工程师们提出了在以太网上传送 PPP 数据包的思想，即 PPPoE 协议（Point to Point Protocol over Ethernet），它是在以太网络中传输 PPP 帧信息的技术，它将 PPP 与以太网的优点结合在一起，从而有效地解决了带宽与用户控制管理之间的矛盾，极高的性价比使 PPPoE 在 ADSL、FTTH 等宽带应用中被广泛采用，为推动互联网的发展起到了巨大的作用。

PPPoE 协议使用 Client/Server 模型，PPPoE 的客户端为 PPPoE Client，PPPoE 的服务器端为 PPPoE Server。

PPPoE Client 向 PPPoE Server 发起连接请求，两者之间会话协商通过后，PPPoE Server 向 PPPoE Client 提供接入控制、认证等功能。

**PPPoE（PPP over Ethernet）协议是一种把PPP帧封装到以太网帧中的链路层协议。PPPoE可以使以太网网络中的多台主机连接到远端的宽带接入服务器。**







现在宽带默认是由光猫进行拨号上网，也叫路由模式。这样的优点是比较稳定，缺点是多设备使用就逊色一些。

做到了插上即用，适合大多数人，也是现在网络运营商装维人员的默认安装方法。

运营商喜欢路由模式主要有两个原因：

- 免去用户配置路由器的麻烦和问题，节省装维用人成本。同样数量的用户，装维人员比原来少一大半。
- 路由模式方便控制终端。比如限制接入数量、并发上限，屏蔽端口、应用，乃至智能路由、负载均衡。这方面最成熟的就是上海 SDN 云宽带。

光猫除了完成光电转换外，还有路由器的功能，实现PPPOE拨号、NAT地址转换等。家庭无线路由器直接插在光猫宽带上网端口，通过自动获取IP地址的方式上网，这是光猫的默认模式。


目前默认的都是路由模式，但最早期的光猫都是桥接模式，因为光猫无WIFI，无路由器则无WIFI，后来变为带WIFI的光猫，IPTV的推出，宽带速率逐步提高，也是顺应时代的发展，逐步更新换代，让我们真正体验光的速度。





缺点

- 光猫的路由功能、无线速率低，而且大部分的光猫只能支持802.11n无线标准，也就是支持单频2.4G频段，单频2.4G无线接入的速率低。

  同时也不能满足家庭的有线联网设备的接口数量。如果对网速要求较高，比如玩大型游戏，下载高清视频等，自带无线WIFI不能满足需求，需要外接路由器。







光猫工作在桥接模式下，相当于“网桥”的功能，需要家庭无线路由器PPPOE拨号，才能连接到互联网。



# OSI参考模型

国际标准化组织ISO为了使网络应用更为普及，推出了OSI参考模型，即开放式系统互联（Open System Interconnect）模型，一般都叫OSI参考模型。

OSI参考模型是ISO组织在1985年发布的网络互连模型，其含义就是为所有公司使用一个统一的规范来控制网络，这样所有公司遵循相同的通信规范，网络就能互联互通了。

### **OSI模型的七层框架**

OSI模型定义了网络互连的七层框架（物理层、数据链路层、网络层、传输层、会话层、表示层、应用层）。

每一层实现各自的功能和协议，并完成与相邻层的接口通信。



OSI模型各层的通信协议，大致举例如下表所示：

表：OSI模型各层的通信协议举例

| OSI层级名称 | 说明                                                         |                                                              |
| ----------- | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 应用层      | HTTP、SMTP、SNMP、FTP、Telnet、SIP、SSH、NFS、RTSP、XMPP、Whois、ENRP、等等 | 解决通过应用进程之间的交互来实现特定网络应用的问题           |
| 表示层      | XDR、ASN.1、SMB、AFP、NCP、等等                              | 解决通信双方交换信息的表示问题（数据字符集转换，数据格式化，文本压缩，数据加解密等） |
| 会话层      | ASAP、SSH、RPC、NetBIOS、ASP、Winsock、BSD Sockets、等等     | 解决进程之间的会话问题                                       |
| 传输层      | TCP、UDP、TLS、RTP、SCTP、SPX、ATP、IL、等等                 | 解决进程之间基于网络的通信问题                               |
| 网络层      | IP、ICMP、IGMP、IPX、BGP、OSPF、RIP、IGRP、EIGRP、ARP、RARP、X.25、等等 | 解决分组在多个网络之间传输（路由）的问题                     |
| 数据链路层  | 以太网、令牌环、HDLC、帧中继、ISDN、ATM、IEEE 802.11、FDDI、PPP、等等 | 解决分组在一个网络（或一段链路）上传输的问题                 |
| 物理层      | 例如铜缆、网线、光缆、无线电等等                             | 解决使用何种信号来传输比特0和1的问题                         |



# TCP/IP 协议体系结构模型

TCP/IP包含了一系列的协议，也叫TCP/IP协议族（TCP/IP Protocol Suite，或TCP/IPProtocols），简称TCP/IP。

TCP/IP协议族提供了点对点的连结机制，并且将传输数据帧的封装、寻址、传输、路由以及接收方式，都予以标准化。



TCP/IP协议是Internet互联网最基本的协议，其在一定程度上参考了七层ISO模型。

但是这显然是有些复杂的，所以在TCP/IP协议中，七层被简化为了五层。

TCP/IP模型中的各种协议，依其功能不同，被分别归属到这四层之中，常被视为是简化过后的七层OSI模型。

| OSI 参考层编号 | 等效的 OSI 层          | TCP/IP 层 | TCP/IP 协议示例                                              |
| :------------- | :--------------------- | :-------- | :----------------------------------------------------------- |
| 5、6、7        | 应用层、会话层、表示层 | 应用      | NFS、NIS、DNS、LDAP、`telnet`、`ftp`、`rlogin`、`rsh`、`rcp`、RIP、RDISC、SNMP 等 |
| 4              | 传输层                 | 传输      | TCP、UDP、SCTP                                               |
| 3              | 网络                   | 网络层    | IPv4、IPv6、ARP、ICMP                                        |
| 2              | 数据链路层             | 数据链路  | PPP、IEEE 802.2                                              |
| 1              | 物理层                 | 物理网络  | 以太网 (IEEE 802.3)、令牌环、RS-232、FDDI 等等               |



### 数据的封装与解封装

- 应用数据需要**经过每一层处理**之后才能通过网络传输到目的端。

- **数据封装**：逐层向下传递数据，并添加报头和报尾的过程为**封装（封包）**

- **数据解封装**：反之，接收方需要**逐层向上**传递数据，称为**解封（拆包）**

- OSI 把每一层数据称为 PDU（Protocol Data Unit，协议数据单元）
- TCP/IP 









# 物理层

在计算机网络中，用来连接各种网络设备的传输媒体种类众多。

**传输媒体**也称为传输介质或传输媒介，它就是数据传输系统中在发送器和接收器之间的物理通路。一类是**导引型传输媒体**，另一类是**非导引型传输媒体**。

- 在导引型传输媒体中，常见的有同轴电缆、双绞线、光纤、电力线。

- 在非导引型传输媒体中，常见的是无线电波、微波、红外线，可见光。例如使用2.4G赫兹和5.8G赫兹频段的WiFi。 

计算机网络体系结构中的物理层，就是要解决在各种传输媒体上传输比特0和1的问题，进而给数据链路层提供**透明**传输比特流的服务。

> 所谓透明，是指数据链路层看不见，也无需看见物理层究竟使用的是什么方法来传输比特0和1的，他只享受物理层提供的比特流传输服务即可。



**"物理层" 概念 :** 各种计算机通过**传输媒体**连接 , 物理层负责解决在**传输媒体**上传输数据比特流 ;

传输媒体不属于计算机网络体系结构的任何一层。如果非要将它添加到体系结构中，那只能将其放置到物理层之下。



**机械特性 :** 定义物理连接特性 , 包括 采用的规格 , 接口形状 , 引线数目 , 排列情况 , 引脚数量 ;

​			**引脚排列示例 :** 水晶头的引脚排列情况 , 插座的间距规格等 ;

**电气特性 :** 传输二进制时 , 传输信号的 电压范围 , 阻抗匹配 , 传输速率 , 距离限制 ;

- **电压范围示例 :** 规定信号电平 +10V ~ +15V 表示二进制数据 0 , 信号电平 -10V ~ -15V 表示二进制数据 1 ;
- **电缆长度示例 :** 路由器 到 主机间的电缆长度必须在 20 米以内 ;



**功能特性 :** 描述电平的意义 , 接口部件信号线用途 ;

- **电平意义示例 :** 描述当一个接口的引脚处于高电平的含义 ;
- **注意与 电气特性 区分 :** 电气特性是描述 根据 电压 得到 电平 , 功能特性是指 电平的意义 ;



## 常见传输介质和网络设备



### 双绞线/同轴电缆/网线

网线应该是一个统称的概念，准确说应该包含双绞线、光缆、同轴电缆等。

**同轴电缆**一般用于早期以太网，传输速度通常在 10Mbps 以内。当然粗缆是可以到 1-2Gbps 的速度，不过现在几乎被我们接下来要说到的网线给取代了。

内导体同质心线，可以是单股实心线，或者是多股的角和线。绝缘层、网状编织的外导体屏蔽层、绝缘保护套层。同轴电缆的横切面可以看出各层都是共圆心的，也就是同轴心的。这就是同轴电缆名称的由来。

同轴电缆有两类，一类是50欧阻抗的基带同轴电缆，用于数字传输，在早期局域网中广泛使用。

另一类是75欧阻抗的宽带同轴电缆，用于模拟传输，目前主要用于有线电视的入户线。

同轴电缆价格较贵，且布线不够灵活和方便，随着集线器的出现，在局域网领域，双绞线取代了同轴电缆。



**我们经常说的网线实际上是双绞线**，市面上的网线通常为八芯双绞线，传输距离建议不超过一百米。

双绞线采用了一对互相绝缘的金属导线对绞的方式来抵御频率小于25MHz以下电磁波干扰。

把两根绝缘的铜导线按一定密度互相绞在一起，可以降低信号干扰的程度，每一根导线在传输中辐射的电波会被另一根线上发出的电波抵消。

“双绞线”的名字也是由此而来。但是在常规的企业应用、家庭应用中光缆和同轴电缆用量很少，所以大家都把双绞线默认为网线了。

网线从大类上可以分为非屏蔽网线、屏蔽网线。

- 屏蔽网线有一层或几层屏蔽层，在数据传输时可减少电磁干扰，所以它的稳定性较高，主要用在干扰比较大的地方。

- 非屏蔽网线没有那一层铝箔屏蔽层。市面上主流的常用的都是非屏蔽网线



常见的网线标准有五类线、超五类线、六类线、超六类线和七类线这五种标准。**不同标准传输速率不同，但是都不建议超过 100 米**。

| 常用线型 | 最高传输速率 | 传输距离 | 概述                                                         |
| :------: | :----------: | :------: | ------------------------------------------------------------ |
|  五类线  |   100Mbps    |   100m   | 目前已经慢慢的被淘汰，被超五类线代替；                       |
| 超五类线 |    1Gbps     |   100m   | 目前主流，市面上流通的网线一般以超五类网线为主；线材表皮标有"CAT.5e"的字样。 |
|  六类线  |  超过 1Gbps  |   100m   | 支持千兆网络，经常被称为“千兆网线”；线材表皮标有"CAT.6"的字样。 |
| 超六类线 |    10Gbps    |   100m   | 超六类网线是六类线的改进版，表皮标有“CAT.6A”的字样，经常称为6A线，并且大多数有“十字骨架”； |
|  七类线  |    10Gbps    |   100m   | 七类线是一种屏蔽双绞线，主要用于万兆网，传输速率可达10Gbps   |



双绞线的绞合度是不一样的，而且八根芯的颜色也不一样，常见网线标准之间的区分就是绞合度、铜芯粗细、有无龙骨、有无屏蔽层等。

其实这八根芯的颜色排列也是有讲究的，在我们线缆制作中会有线序的说法，下面就是两种线序标准：



|  标准  |  1   |  2   |  3   |  4   |  5   |  6   | 7    | 8    |
| :----: | :--: | :--: | :--: | :--: | :--: | :--: | ---- | ---- |
| T568-A | 绿白 |  绿  | 橙白 |  蓝  | 蓝白 |  橙  | 棕白 | 棕   |
| T568-B | 白橙 |  橙  | 白绿 |  蓝  | 白蓝 |  绿  | 白棕 | 棕   |





### 光纤：远距传输理想之选

现在在中大型商用场景下网线已经远远不能满足我们当前的网络规模了，即便是加上中继，传输质量和范围都无法满足我们现在的需求，所以有了光纤的出现。

**光纤全称光导纤维**，通常由玻璃或塑料制成，最外层会涂一层隔绝光线的材料。

光纤具有绝缘性能好、信号衰减小、传输速度快、传输距离大的优势，通常应用于主干网的连接，不受外界电磁场的影响，带宽几乎无限制，**可以实现每秒万兆位的数据传送，传输距离可达数百公里。**

光纤有单模光纤和多模光纤之分：

- 单模光纤传输距离长，可达 20-120 公里的距离。

- 多模光纤适用于低速短距离的场景，比如说一个局域网里的交换机之间的互联，交换机和路由器之间的互联都可以用多模光纤，传输距离在 2 公里以内。

  可以存在多条不同角度入射的光线在一条光纤中传输。这种光纤就称为**多模光纤**。

 



**光口**

光口是光纤接口的简称，也可称之为：G口 (意思是G光纤口) 。 光纤接口是用来连接**光纤线缆的物理接口**。

其原理是利用了光从光密介质进入光疏介质从而发生了全反射。通常有SC、ST、FC等几种类型，应用于机房，机柜等大型设备的一个光纤带宽接口。



**电口**

电口是相对光口来讲的，是指防火器的物理特性，主要指**铜缆**，是处理的电信号。目前使用普遍的网络接口有百兆电口和千兆电口等。

简单来说，**电口就是普通的网线接口**，一般速率为10M或者100M,部分支持1000M。电口的最远距离为100米。





**RJ45**

RJ45接口通常用于数据传输，最常见的应用为网卡接口。

RJ45是各种不同接头的一种类型；RJ45头根据线的排序不同的法有两种：

- 橙白、橙、绿白、蓝、蓝白、绿、棕白、棕;

- 绿白、绿、橙白、蓝、蓝白、橙、棕白、棕;


因此使用RJ45接头的线也有两种即：直通线、交叉线。





**光模块**

现在的防火墙路由器交换机都是模块化组件化，一般设备本身没有光口不能连接光纤。

所以如果需要光纤通讯，需要单独选配光模块。

光模块（Optical Modules）作为光纤通信中的重要组成部分，是实现光信号传输过程中光电转换和电光转换功能的光电子器件。

它主要由光电子器件（光发射器、光接收器）、功能电路和光接口等部分组成，主要作用就是实现光纤通信中的光电转换和电光转换功能。



https://support.huawei.com/enterprise/zh/doc/EDOC1100115015

https://support.huawei.com/enterprise/zh/doc/EDOC1100130745



### 电磁波：突破网线限制

但随着终端的多样化，以及有线对设备移动范围的限制，我们开始使用**电磁波**作为对有线网络的扩展。

电磁波信号包括：无线电波、中波、短波、超声波、 微波、红外线、可见光、紫外线等。

电磁波的范围很广，适合作为信号传输的只有介于 3 Hz 和约 300 GHz 之间的无线电波，无线电波又被称为射频电波，我们的无线网络就是用的无线电波中超高频的一部分。

国内最常用的频段是 2.4 GHz 和 5 GHz 



无线网络信号是在空气中通过电磁波来传播的。电磁波有一定的频率。

WLAN 信号属于电磁波信号，

电磁波在日常生活与通信中有极为广泛的应用，如无线广播、电视信号、地面微波、 红外线、紫外线等

民用的这种无线电磁波的频率主要是有 2.4 GHZ （左右） 和 5G  GHZ 





2.4G工作频率范围为 2.4～2.483GHz，在此频率范围内定 义了 14 个信道，每个频道的频宽为 2.412GHz，相邻两个信道的中心频率之间相差 5MHz，信道 1 的中心频率为 2.412GHz，信道 2 的中心频率为 2.417GHz，以此类推至信 道 13。





信道 14 是特别为日本定义的，其中心频率与信道 13 的中心频率相差 12MHz。

不同的国家的信道开放情况不一样，在北美，如美国、加拿大开放的信道范围为 1～ 11 信道，在欧洲的大部分地区开放 1～13 信道，在中国也同样开放 1～13 信道，而在日 本开放全部的 1～14 信道。

从信道工作频率图可以看出，许多信道相互之间频率交叠，比如信道1在频率上与信道 2～5 都有交叠。

如果两个无线设备同时工作在信道 1、3，则其发送的无线信号会互相 干扰，而工作在信道 1、6，则信号相互之间没有干扰

为了最大程度地利用频段资源， 减少信道间的干扰，通常使用 1、6、11；2、7、12；3、8、13；4、9、14 这 4 组互不干 扰的信道。

由于只有部分国家开放了 12～14 信道，所以一般情况下，都使用 1、6、11 这 3 个信道进行无线部署。

在高密场景下通常推荐使用1、9、5、13四个信道组合方式。



### 路由器、交换机和 AP

到这里，我们常见的传输介质已经讲完了，接下来我们再来聊聊网络设备，前面有和大家简单提到过。我们主要讲路由器、交换机和 AP 这三种网络设备。

先来看看路由器，**路由器是连接两个网络的硬件设备**，是网络的大门，同时也承担寻路功能，因此，路由器又叫做网关设备。

它帮助我们将数据运送到互联网上，然后互联网中的无数台路由器又帮助我们将信息运送到目的地。



**交换机是用于数据转发交换的设备**。通常用于路由器和各终端直接的连接，可将交换机视为路由器接口的拓展。

随着网络的发展，也出现了三层交换机来承载部分内网寻路的工作，但是请大家记住，交换机的本职工作还是内网交换，在大型网络寻路中还是要通过路由器来实现；

同样的，路由器的工作是不同网络之间的寻路，**请不要将路由器作为交换机使用，尤其是终端较多的情况下。** 

**AP 是用于无线网络的交换机，用来接入无线终端，是无线网络中的核心设备。**

大家家里应该都会有无线路由器这种东西，AP 的功能和无线路由器上的天线是一样的，都用作无线终端的接入。

咱们的无线路由器上通常还会标有 LAN 和 WAN，LAN 口一般都是交换口，也就是一个小交换机，WAN 承担的就是路由功能啦。







### 以太网链路层的分层结构

在以太网中，针对不同的双工模式，提供不同的介质访问方法：

- 在半双工模式下采用的是CSMA/CD的访问方式。
- 而在全双工模式下则可以直接进行收发，不用预先判断链路的忙闲状态。

半双工和全双工是物理层的概念，而针对物理层的双工模式提供不同访问方式则是数据链路层的概念，这样就形成了以太网的一个重要特点：数据链路层和物理层是相关的。

由于以太网的物理层和数据链路层是相关的，针对物理层的不同工作模式，需要提供特定的数据链路层来访问。这给设计和应用带来了一些不便。



### 以太网双工模式

以太网的物理层存在半双工和全双工两种模式。

- **半双工**

  - 任意时刻只能接收数据或者发送数据。
  - 采用CSMA/CD访问机制。
  - 有最大传输距离的限制。

  HUB工作在半双工模式。

- **全双工**

  在有L2交换机取代了HUB组建以太网后，以太网由共享式转变为交换式。而且用全双工代替了半双工，传输数据帧的效率大大提高，最大吞吐量达到双倍速率。

  全双工从根本上解决了以太网的冲突问题，以太网从此告别CSMA/CD。

  全双工的工作模式：

  - 同一时刻可以接收和发送数据。
  - 最大吞吐量达双倍速率。
  - 消除了半双工的物理距离限制。

  

  最近10年制造的网卡、L2、ME设备都支持全双工模式，HUB除外。

  实现全双工的硬件保证：

  - 支持全双工的网卡硬件
  - 收发线路完全分离的物理介质
  - 点到点的连接



### 以太网自动协商

**自动协商的目的**

最早的以太网都是10M半双工的，所以需要CSMA/CD等一系列机制保证系统的稳定性。随着技术的发展，出现了全双工，接着又出现了100M，以太网的性能大大改善。但是随之而来的问题是：如何保证原有以太网络和新以太网的兼容？

于是，提出了自动协商技术来解决这种矛盾。自动协商的主要功能就是使物理链路两端的设备通过交互信息自动选择同样的工作参数。

自动协商的内容主要包括双工模式、运行速率以及流控等参数。一旦协商通过，链路两端的设备就锁定在同样的双工模式和运行速率。



**自动协商原理**

自动协商是建立在双绞线以太网的一种底层机制上的，它只对双绞线以太网有效。

在双绞线链路上，如果没有数据传输，链路并不是一直空闲，而是不断的互相发送一种频率较低的脉冲信号，任何具有双绞线接口的以太网卡都能识别这种信号。

如果再插入一些频率更低的脉冲，这些脉冲称为快速链路脉冲FLP（Fast Link Pulse），两端设备也能识别。于是，可以利用FLP进行少量的数据传输，达到自动协商的目的。







# WLAN 概述



WLAN 是无线局域网络的简称，全称为Wireless Local Area Networks，是一种利用无线技术进行数据传输的系统，该技术的出现能够弥补有线局域网络之不足，以达到网络延伸之目的。

Wi-Fi 是基于 IEEE 802.11 标准的 WLAN。WLAN（Wireless Local Area Network，无线局域网）有许多标准协议，如IEEE 802.11协议族、HiperLAN 协议族等。

Wi-Fi 是无线保真的缩写，英文全称为Wireless Fidelity，在无线局域网才对范畴是指“无线兼容性认证”，实质上是一种商业认证，同时也是一种无线联网技术，与蓝牙技术一样，同属于在办公室和家庭中使用的短距离无线技术。

同蓝牙技术相比，它具备更高的传输速率，更远的传播距离，已经广泛应用于笔记本、手机、汽车等广大领域中。

WIFI 是无线局域网联盟的一个商标，该商标仅保障使用该商标的商品互相之间可以合作，与标准本身实际上没有关系，但因为 WIFI 主要采用 802.11b 协议，因此人们逐渐习惯用WIFI来称呼 802.11b 协议。

从包含关系上来说，WIFI 是 WLAN 的一个标准，WIFI 包含于 WLAN 中，属于采用WLAN协议中的一项新技术。



在一些大型企业，企业园区，大学校园，公共景点，火车站等区域。要求无线全覆盖。这个时候需要一些企业级的无线技术。

IEEE 802 标准:

- 802.2 逻辑链路控制

- 802.3 以太网-CSMA/CD接入方法

- 802.10 安全

- 802.11 无线局域网

  - 它是IEEE国际电气和电子工程师协会制定的一个通用无线局域网标准。最初的IEEE 802.11标准只是用于数据存取，传输速率最高只能达到2Mb/s。

  - 由于速度慢不能满足数据应用发展的需求，所以后来该协会又推出了 IEEE 802.11b、 802.11a、 802.11g 这三个新的标准。

  - 这三个标准都是经IEEE批准的无线局域网规范，标准的确立也就意味着厂商们的认可和支持，它们之问技术差别很大，所走的发展道路也不一样。

    

  

IEEE 定义的二层标准：802.11 

- 802.11n (已经属于上一代标准，理论最大速度 600Mbit/s)**Wi-Fi 4**

- 802.11b  （）

- 802.11ac (目前大面积商用，号称是千兆WIFI) **Wi-FI 5**

- 802.11ax (目前还没有大面积商用)  **Wi-FI 6**



## 双频



**无线网络信号是在空气中通过电磁波为介质来传播的。电磁波有一定的频率。民用的这种无线电磁波的频率主要是有 2.4 GHZ （左右） 和 5  GHZ** 



2.4G、5G、6G频段各有不同的工作信道。

现在一般市面上买到的无线路由器都支持双频，可以发射两个不同频率的无线信号。分别由不同天线发射出来的。

- 2.4 GHZ    普通  速率低  干扰大  传输距离远（俗称穿墙能力，准确说应该是绕墙能力）  
  - （802.11 b g n ）
- 5 GHZ   高配 速率快 干扰小  传输距离近 （穿墙能力没有2.4G信号强）
  - （802.11 a n ac）

电磁波传输的速度是光速（光在真空中的速度3.00×108 m/s）。

对于电磁波来说，波长越长，越容易衍射，体现在“绕过物体的能力”。即我们平时说的信号穿墙能力的体现之一！

c=fλ  光速=频率*波长   光速固定，频率越高，波长越小。频率越低，波长越大。

根据不同频段无线电的特性，无线路由器所发出的信号对不同材质的穿透难度和衰减程度也是不同的。

Wi-Fi信号的穿透性能大致如下（由易到难）：空气<木板/玻璃<砖墙/水泥墙<瓷砖墙/钢筋水泥墙<金属板。

2.4 GHZ 

http://www.srrc.org.cn/article24658.aspx



2.4G频段被分为14个交叠的、错列的20MHz信道，信道编码从1到14，邻近的信道之间存在一定的重叠范围。





## 信号强度

在无线网络中，使用AP设备和天线来实现有线和无线信号互相转换。



有线网络侧的数据从AP设备的有线接口进入AP后，经AP处理为射频信号，从AP的发送端（TX）经过线缆发送到天线，从天线处以高频电磁波（2.4GHz/5GHz/6GHz频率）的形式将其发射出去。高

频电磁波通过一段距离的传输后，到达无线终端位置，由无线终端的接收天线接收，再输送到无线终端的接收端（RX）处理。反之，从无线终端的发送端（TX）发出去的数据，也是按照上述的流程，逆向处理一遍，输送给AP的接收端（RX）。



在发送和接收天线之间的信号即是无线信号。信号强度在无线信号传输过程中会逐渐衰减。在了解信号强度时，一并介绍常见的几个有关联的基本概念：射频发射功率、EIRP、RSSI、下行信号强度、上行信号强度。



## 无线AP

无线接入点（AP）：电信级无线覆盖设备，相当于一个连接有线网和无线网的桥。

其主要作用是将各个无线网络客户端连接到一起，实现大范围、多用户的无线连接，根据应用场景不同，AP通常可分为室内型和室外型，室内环境下覆盖范围通常在30米~100米，室外环境最大覆盖范围可达到800米。



## 无线AC

接入控制器（AC）：无线局域网接入控制设备，负责将来自不同AP的数据进行汇聚并接入Internet，同时完成AP设备的配置管理和无线用户的认证、管理，以及带宽、访问、切换、安全等控制功能。



**AC控制器的特性**

1、统一管理

类似于单一访问点的设置过程，AC控制器支持高达1000个无线访问点的集中配置，通过一个直观的WEB管理界面，就可以将无线的参数和安全设置下发到网络中的所有AP，简化了无线网络的部署和维护。 

2、 自动管理

设备能够自动发现网络中的AP，分配IP和信道；自动检测网络中的AP；自动进行链路检测；自动检测接入AP上网移动终端用户的信息，AP故障信息短信自动通知。

3、性能优化

自动检测网络状态，以确保最佳的性能和响应能力；自动重新分配信道和调整射频参数以保证最大连通性；可对AC和AP进行升级、备份、恢复等操作；可配置黑白名单，有效地控制接入设备；

可限定用户的上网速率等信息，实现可控的网络设置；智能云端版本升级。

4、配置标准

拥有固定的IP地址，操作简单、即插即用，即使非专业用户也能轻松使用。



## **Portal认证**



场景一：北京国际机场，岩松打开iPhone搜索Wi-Fi信号，看到机场Wi-Fi登录页面，输入手机号获取密码，输入密码后连接Internet刷微博。

场景二：某餐馆，顾客小e拿出手机扫了餐桌上的二维码，弹出“连接网络”页面，单击“连接网络”后以匿名方式连接Internet，在朋友圈和大家分享美食。

场景三：某酒店，出差人员张经理在酒店办理入住手续时获得以房间号为帐号和一个随机密码。通过手机连接酒店提供的Wi-Fi，输入帐号和密码后下载出差地的离线地图。

这几种连接Internet有一个共同点，就是都会弹出登录页面，术语称之为Portal认证页面。

根据国家接入互联网的相关规定，在接入互联网之前必须通过身份认证。从终端的角度看，考虑到终端的复杂性，在终端上安装认证客户端进行身份认证是不现实的。而几乎全部的智能终端都装有Web浏览器。身份认证最好是能够通过Web页面的方式进行。问题是，旅客如何申请登录帐号？

现在常用获取账号的方式有：

l  通过短信获取密码

l  公用的帐号和密码（扫描二维码）

把登录帐号和密码都编码在二维码图案中，使用智能终端扫描后即可自动完成登录。

l  通过打印纸条提供帐号和密码

l  关注微信公共帐号后获取上网帐号和密码

使用微信关注某个公共帐号后接入Internet。

Portal认证有如下优点：

l  不需要安装客户端。使用Web页面认证，使用方便，减少客户端的维护工作量。

l  便于运营。可以在Portal页面上开展业务拓展，如广告展示、责任公告、企业宣传等。

l  提供计费功能，通过计费功能来限制终端接入网络的时长。



Portal认证优势明显，故此无处不在。



Portal认证通常也称为Web认证，是基于网页的形式向用户提供身份认证和个性化的信息服务。

一般将Portal认证网站称为门户网站。用户上网时，必须在门户网站进行认证，只有认证通过后才可以使用网络资源。

**主动认证：**用户可以主动访问已知的 Portal 认证网站，输入用户名和密码进行认证，这种开始 Portal 认证的方式称作主动认证。

**强制认证：**反之，如果用户试图通过 HTTP 访问其他外网，将被强制访问Portal认证网站，从而开始 Portal 认证过程，这种方式称作强制认证。



Portal认证系统的典型组网方式由四个基本要素组成：认证客户端、接入设备、Portal服务器与认证/授权服务器。



**我们在图书馆，车站，等公共基础场所，一般 wifi 本身是没有密码的，我们连接上 wifi 后，访问外网，就会被重定向至 Portal 认证网站，要求通过手机短信或微信登录等方式验证上网。**

**Portal认证特点：**

1. 不需要安装客户端，直接使用 Web 页面认证，使用方便，减少客户端的维护工作量。
2. 便于运营，可以在 Portal 页面上开展业务拓展，如广告推送、责任公告、企业宣传等。
3. 技术成熟，被广泛应用于运营商、连锁快餐、酒店、学校等网络。

**应用场景：**

1. 访客接入
2. 低成本混合接入：Portal + MAC旁路。



https://forum.huawei.com/enterprise/zh/thread/580888141160660992



## 加密





### 什么是 WPA？

接下来是 WPA，即 Wi-Fi 保护访问。该协议于 2003 年推出，它是 Wi-Fi 联盟对 WEP 的替代协议。它与 WEP 有相似之处，但在处理安全密钥的方式和用户授权方式上进行了改进。WEP 为每个授权系统提供相同的密钥，而 WPA 使用临时密钥完整性协议 (TKIP)，该协议可动态更改系统使用的密钥。这可以防止入侵者创建自己的加密密钥以匹配安全网络使用的密钥。TKIP 加密标准后来被高级加密标准 (AES) 所取代。

此外，WPA 包括消息完整性检查，以确定攻击者是否已捕获或更改数据包。WPA 使用的密钥为 256 位，相比 WEP 系统中使用的 64 位和 128 位密钥有了显著提升。但是，尽管存在这些改进，WPA 的元素还是遭到利用 - 这导致 WPA2 诞生。

您有时会听到与 WPA 相关的术语“WPA 密钥”。WPA 密钥是用于连接到无线网络的密码。您可以从运行网络的任何人那里获取 WPA 密码。在某些情况下，无线路由器上可能会印有默认的 WPA 密码。如果您无法确定路由器密码，也可以重置它。

### 什么是 WPA2？

WPA2 于 2004 年推出，它是 WPA 的升级版本。WPA2 基于强大的安全网络 (RSN) 机制，并在两种模式下运行：





- **个人模式或预共享密钥 (WPA2-PSK)** - 依赖共享密码进行访问，通常用于家庭环境。对一些中小型企业网络或者家庭用户，部署一台专用的认证服务器代价过于昂贵，维护也很复杂，通常采用WPA/WPA2预共享密钥模式，即WPA/WPA2_PSK，事先在STA和WLAN设备端配置相同的预共享密钥，然后通过是否能够对协商的消息成功解密，来确定STA配置的预共享密钥是否和WLAN设备配置的预共享密钥相同，从而完成STA的接入认证。
- **企业模式 (WPA2-EAP)** - 顾名思义，更适合组织或企业使用。在大型企业网络中，通常采用802.1X的接入认证方式。802.1X认证是一种基于接口的网络接入控制，用户提供认证所需的凭证，如用户名和密码，通过特定的用户认证服务器（一般是RADIUS服务器）和可扩展认证协议EAP（Extensible Authentication Protocol）实现对用户的认证

两种模式都使用 CCMP - 它代表“计数器模式密码区块链消息身份验证代码协议”。CCMP 协议基于高级加密标准 (AES) 算法，该算法提供消息真实性和完整性验证。CCMP 比 WPA 最初的临时密钥完整性协议 (TKIP) 更强大、更可靠，使攻击者更难发现模式。

但是，WPA2 仍然有缺点。例如，它容易遭受密钥重新安装攻击 (KRACK)。KRACK 利用了 WPA2 中的一个弱点，该弱点允许攻击者伪装成克隆网络并强制受害者连接到恶意网络。这使黑客能够解密一小段数据，这些数据可能被聚合以破解加密密钥。但是，设备可以打补丁，WPA2 仍然被认为比 WEP 或 WPA 更安全。







### 什么是WPA3？

WPA3 是 Wi-Fi 保护访问协议的第三次迭代。Wi-Fi 联盟于 2018 年推出了 WPA3。WPA3 引入了供个人和企业使用的新功能，包括：

- **个性化数据加密**：在登录公共网络时，WPA3 通过一个并非共享密码的流程注册新设备。

​	WPA3 使用 Wi-Fi 设备调配协议 (DPP) 系统，该系统允许用户使用近场通信 (NFC) 标签或[二维码](https://www.kaspersky.com.cn/resource-center/definitions/what-is-a-qr-code-how-to-scan)来允许网络上的设备。

​	此外，WPA3 安全功能使用 GCMP-256 加密，而不是以前使用的 128 位加密。

**Equals 协议的同步身份验证**：这用于创建安全握手，其中，网络设备将连接到无线接入点，并且两个设备进行通信以验证身份和连接。即使用户的密码强度很低，WPA3 也可使用 Wi-Fi DPP 提供更安全的握手。

**更强的暴力破解攻击防护**：WPA3 只允许一名用户猜测一次，从而防止离线密码猜测，迫使用户直接与 Wi-Fi 设备交互，这意味着他们每次想猜测密码时都必须亲自到场。WPA2 在公共开放网络中缺乏内置的加密和隐私功能，使得暴力破解攻击成为重大威胁。

WPA3 设备在 2019 年开始广泛使用，并且向后兼容使用 WPA2 协议的设备。



Wi-Fi联盟于2018年开始了WPA3认证计划，但直到2020年，所有携带“Wi-Fi CERTIFIED™”标志的设备才强制要求支持WPA3。 自那时起，几乎所有的WiFi路由器制造商都推出了支持最新无线加密标准的型号，因此对于那些仍然依赖不支持WPA3的旧路由器的用户来说，有很多选项可供选择。



### WLAN密码破解

https://github.com/conwnet/wpa-dictionary



### 如何识别您的 Wi-Fi 网络安全机制类型：

**在 Windows 10 中：**

- 在任务栏中找到 Wi-Fi 连接图标并单击它
- 然后单击当前 Wi-Fi 连接下方的**属性**
- 向下滚动并在**属性**下查找 Wi-Fi 详细信息
- 在此设置下，查找**安全类型** ，其中显示了您的 Wi-Fi 协议

**在 macOS 中：**

- 按住 **Option** 键
- 单击工具栏中的 **Wi-Fi 图标**
- 这将显示您的网络详细信息，包括您的 Wi-Fi 安全类型

**在 Android 中：**

- 在您的 Android 手机上，进入**设置**
- 打开 **Wi-Fi** 类别
- 选择您连接的路由器并查看其详细信息
- 这将显示您的连接是什么 Wi-Fi 安全类型
- 此界面的路径可能因您的设备而异



# 企业基本组网概述



一般企业网络基本架构分为三层：

- 接入层： 为前端试备接入提供大量的接口
- 汇聚层：对接入层的大量流量和数据进行汇聚和控制
- 核心层：是整个网络的核心，提供高速转发的功能





![img](https://note.youdao.com/yws/public/resource/931d84b124c9ee9add706dd7cf23663b/xmlnote/CAAD1656534E482FAB0C5FAD19ED92FB/2355)

















# 数据链路层

**链路**是从一个结点到相邻结点的一段物理线路，**数据链路**则是在链路的基础上增加了一些必要的硬件（如网络适配器）和软件（如协议的实现）

**网络中的主机、路由器等都必须实现数据链路层**



**链路[Link]**是指从一个节点到相邻节点的一段物理线路（有线或无线），而中间没有任何其他的交换节点。

当在一条链路上传送数据时，出需要链路本身，还需要一些必要的通信协议来控制这些数据的传输，把实现这些协议的硬件和软件加到链路上，就构成了**数据链路。**

**帧**是数据链路层对等实体之间在水平方向进行逻辑通信的**协议数据单元PDU**。

>  （注：实体是指任何可发送或接收信号的硬件或软件进程对等实体是指通信双方相同层次中的实体。）



世界上有个协会叫作IEEE，即电子工程师协会，里面有个分会，叫作IEEE802委员会，是专门来制定局域网各种标准的。

802下面还有个分部，叫作802.3.就是我们经常提到的 IEEE802.3，这个部门制定的规范叫以太网规范，这个以太网规范中就定义了上面提到的“以太网首部”，这个以太网规范，实际只定义了数据链路层中的MAC层和物理层规范。

（注意数据链路层包括MAC子层和LLC子层两个子层，而LLC子层是在IEEE802.2中规范的）。



数据链路层属于计算机网路的低层。**数据链路层使用的信道主要有以下两种类型：**

- 点对点信道
- 广播信道



### MTU

考虑到对缓存空间的需求以及差错控制等诸多因素。

每一种**数据链路层**协议都规定了帧的数据载荷的长度上限，即**最大传送单元（Maximum Transfer Unit，MTU）**。



物理链路中并不能传输任意大小的数据包。**网络接口**配置的最大传输单元（MTU）

在我们最常用的以太网中，MTU 默认值是 1500（这也是 Linux 的默认值）。

一旦网络包超过 MTU 的大小，就会在网络层分片，以保证分片后的 IP 包不大于 MTU值。显然，MTU 越大，需要的分包也就越少，自然，网络吞吐能力就越好。



早期的以太网使用共享链路的工作方式，为了保证CSMA/CD（载波多路复用/冲突检测）机制，所以规定了以太帧长度最小为64字节，最大为1518字节。

- 最小64字节是为了保证最极端的冲突能被检测到，64字节是能被检测到的最小值；

- 最大不超过1518字节是为了防止过长的帧传输时间过长而占用共享链路太长时间导致其他业务阻塞。

所以规定以太网帧大小为64~1518字节，虽然技术不断发展，但协议一直没有更改。





大部分网络设备都是1500。如果本机的MTU比网关的MTU大，大的数据包就会被拆开来传送，这样会产生很多数据包碎片，增加丢包率，降低网络速度。

把本机的MTU设成比网关的MTU小或相同，就可以减少丢包 。



Maxitum Segment Size 最大分段大小。MSS最大传输大小的缩写，是TCP协议里面的一个概念

MSS就是TCP数据包每次能够传输的**最大数据分段**。

为了达到最佳的传输效能TCP协议在建立连接的时候通常要协商双方的MSS值，这个值TCP协议在实现的时候往往用MTU值代替（需要减去IP数据包包头的大小20Bytes和TCP数据段的包头20Bytes）, 通讯双方会根据双方提供的MSS值得最小值确定为这次连接的最大MSS值



https://info.support.huawei.com/info-finder/encyclopedia/zh/MTU.html





以太网帧格式多达5种，事实上，今天的大多数TCP/IP应用都是用Ethernet V2帧格式，而交换机之间的BPDU数据包是IEEE802.3/LLC的帧，VLAN Trunk协议如802.1Q和Cisco的CDP等则是采用IEEE802.3/SNAP的帧。

*估计是设备间一些协议才用到802.3帧格式，是因为需要802.3帧携带一些控制信息。*





以太网常用帧格式有两种，一种是Ethernet II，另一种是IEEE 802.3 格式。这两种格式区别是：

- Ethernet II中包含一个Type字 段，其中Type字段描述了，以太网首部后面所跟数据包的类型，例如**Type为0x8000时，为IP协议包**，**Type为8060时，后面为ARP协议包**。以太网中多数数据帧使用的是Ethernet II帧格式。

- IEEE 802.3格式中，此位置是长度字段。 



封装成帧是指数据链路层给上层交付下来的协议数据单元PDU添加帧头和帧尾使之成为帧。帧的首部和尾部中包含有一些重要的控制信息。







tcp-segmentation-offload

简称TSO，是一种利用网卡对TCP数据包分片，减轻CPU负荷的一种技术，有时也被叫做LSO (Large segment offload) ，TSO是针对TCP的，UFO是针对UDP的。  

如果硬件支持TSO功能，同时也需要硬件支持的TCP校验计算和分散/聚集 (Scatter Gather) 功能。命令： ethtool -K eth0 tso on|off 

在不支持TSO的网卡上，TCP层向IP层发送数据会考虑mss，使得TCP向下发送的数据可以包含在一个IP分组中而不会造成分片。 

mss是在TCP初始建立连接时由网卡MTU确定并和对端协商的，所以在一个MTU＝1500的网卡上，TCP向下发送的数据不会大于min(mss_local, mss_remote)-ip头-tcp头。 

网卡支持TSO时，TCP层会逐渐增大mss（总是整数倍数增加）。              

https://info.support.huawei.com/info-finder/encyclopedia/zh/MTU.html



### 链路层设备

个或多个以太网通过网桥连接后，就成为一个覆盖范围更大的以太网，而原来的每个以太网就成为一个网段，网桥工作在**链路层的MAC子层**，可以使以太网各网段成为**隔离开**的碰撞域（又称冲突域）。



#### 局域网交换机

以太网交换机的每个端口都直接与单台主机或另一个交换机相连，**通常都工作在全双工方式**。

以太网交换机的特点：

- 以太网交换机的每个端口都**直接**与单台主机相连（而网桥的端口往往连接到一个网段），并且一般都工作在全双工方式。
- 以太网交换机能同时联通多对端口，使每对相互通信的主机都能像独占通信媒体那样，**无碰撞**地传输数据。
- 以太网交换机是一种即插即用设备，其内部的帧的转发表是通过自学习算法**自动**地逐渐建立起来的。
- 以太网交换机由于使用专用的交换结构芯片，**交换速率较高**。
- 以太网交换机**独占**传输媒体的带宽。

以太网交换机主要采用两种交换方式：**①直通式交换机 ②存储转发式交换机**。

❗️❗️❗️对于**默认工作在全双工方式**下的交换机，假设是10Mb/s的以太网，虽然每个端口到主机的带宽还是10Mb/s，但由于一个用户在通信时是独占而不是和其他网络用户共享传输媒体的带宽，因此拥有N个端口的交换机1的总容量是N×10Mb/s，这正是**交换机的最大优点**。

> 举个例子吧，若一个网络采用一个具有24个10Mb/s端口的全双工交换机作为连接设备，则每个连接点平均获得的带宽为10Mb/s（假如说是传统的共享式10Mb/s以太网，每个结点平均获得的带宽只有10÷24Mb/s），该交换机的总容量是24×10Mb/s，如果这个交换机是半双工交换机，那总容量是12×10Mb/s。

从本质上说，**交换机**就是个多端口的网桥，工作在数据链路层（局域网交换机是数据链路层设备，能实现**数据链路层和物理层**的功能），可以**分割冲突域**，但是**不能分割广播域**（广播域属于网络层概念，只有网络层设备如路由器才能分割广播域）。

利用以太网交换机还可以方便的实现虚拟局域网VLAN，VLAN**不仅**可以隔离冲突域，**而且**可以隔离广播域。





# 网络层



https://support.huawei.com/enterprise/zh/doc/EDOC1100145161

## IP协议

在IP网络上，如果用户要将一台计算机连接到Internet上，就需要向因特网服务提供方ISP（Internet Service Provider）申请一个IP地址。

IP地址是在计算机网络中被用来唯一标识一台设备的一组数字。



### IPv4



IP地址是在网络中逻辑地标识网络节点位置的工具，代表了节点之间传递数据信息的原始发送者或最终接收者，即数据流的源或目的地址的编码。

- 对于一台主机，作为数据的终端，拥有1个IP地址就可以参与到网络中与其他节点进行通讯。

- 对于一个网络设备，作为数据的中转站，每个接口都拥有1个或多个IP地址，用于指导主机数据在网络中的转发。

- 为了方便网络的管理，网络按规模划分了网络段，单位是子网。子网的范围包含了若干主机和网络设备接口，因此它拥有一系列IP地址，也称为IP地址池，用于在内部进行分配。

  

IPv4地址由32位二进制数值组成，但为了便于用户识别和记忆，采用了“点分十进制表示法”。

采用了这种表示法的IPv4地址由4个点分十进制整数来表示，每个十进制整数对应一个字节。例如，IPv4地址使用二进制的表示形式为00001010 00000001 00000001 00000010，采用点分十进制表示法表示为10.1.1.2。

IPv4地址由如下两部分组成：

- **网络号码字段（Net-id**）：用来标识一个网络。
- **主机号码字段（Host-id）**：用来区分一个网络内的不同主机。对于网络号相同的设备，无论实际所处的物理位置如何，它们都是处在同一个网络中。



**IPv4地址的主要特点有**：

- IP地址不能反映任何有关主机位置的地理信息，只能通过网络号码字段判断出主机属于哪个网络。
- 当一台主机同时连接到两个网络上时，该主机就必须同时具有两个相应的IP地址，其网络号码Net-id是不同的，这种主机称为多地址主机（Multihomed Host）。
- 在IP地址中，所有分配到网络号码Net-id的网络都是平等的。

最初设计互联网络时，为了便于寻址以及层次化构造网络，每个IP地址包括两个标识码（ID），即**网络ID**和**主机ID**。

同一个物理网络上的所有主机都使用同一个网络ID，网络上的每个主机（包括网络上工作站，服务器和路由器等）有一个主机ID与其对应。

IP地址就是给英特网上的每个主机（路由器）的每个接口分配一个在全世界范围内是唯一的32位的标识符。(a.b.c.d)

IP 地址当中, 有一层逻辑的划分，就是 **网地址** 和 **主机地址** 。 前面一部分 N 位表示一个网， 后面剩下的表示网中的一台主机.

- 第一个字段是网络号。（ **网地址** ）用于识别主机所在的网络；
- 第二个字段是主机号。（**主机地址**）用于识别该网络中的主机。

一个主机号在前面的网络号所指明的网络范围内必须是唯一的，所以一个IP地址在整个网络中都是唯一的。目前分为A、B、C、D、E 五类IP地址。

按 **网地址** 所占位数的不同, IP 地址整个被分成了 A, B, C, D, E 五类.。其中D, E 类特殊, 我们主机会被分配到的地址是 A, B, C 类中的一种.

IP地址根据网络ID的不同分为5种类型，A类地址、B类地址、C类地址、D类地址和E类地址。



#### 子网掩码

IP地址是计算机在网络内的唯一标识，而子网掩码顾名思义是用于划分子网的。

子网掩码与IP地址一样都是由4个数段组成，每个数段的取值范围是0-255（共256个值，即2的8次方），在计算机网络中子网掩码与IP地址是必须组合使用的，子网掩码由连续的1和0组成：

- 连续的1表示网络地址（网络号），1的个数代表网络号的长度
- 连续的0表示每个子网中的主机地址，0的个数代表主机号的个数

**通过0的个数可以计算出子网的容量（即子网中主机的IP地址范围，该掩码同一网段下可以分配多少个IP）**



子网掩码只有一个作用，就是将某个IP地址划分成网络地址和主机地址两部分。掩码在二进制的表示形式上就是一堆连续的1，后面接连续的0

子网掩码是一个32位地址（32bits），**用于屏蔽IP地址的一部分以区别网络标识和主机标识，并说明该IP地址是在局域网上，还是在远程网上。**

**将子网掩码和IP地址按位AND运算，就可得到这个IP地址的网络号。**



224用8位二进制表示就是1110 0000，

子网掩码是255.255.255.224，而255.255.255这是固定的网络号，224是在主机号中划分出来的网络号（子网划分）。

224的二进制是1110 0000，也就是二进制的前三位都是1，也就是网络号。

答案中202.3.1都是一样的，重点是比较后面的数字是否在同一个网络号上。





**无类型域间选路**，简称**CIDR**。这种方式打破了原来设计的几类地址的做法，将32位的IP地址一分为二，前面是**网络号**，后面是**主机号**。

从哪里分呢？你如果注意观察的话可以看到，10.100.122.2/24，这个IP地址中有一个斜杠，斜杠后面有个数字24。这种地址表示形式，就是CIDR。

**后面24的意思是，32位中，前24位是网络号，后8位是主机号。**



截至 2023 年 12 月，我国 IPv4 地址数量为 39219 万个，IPv6 地址数量为 68042 块 /32，IPv6 活跃用户数达 7.62 亿；

我国域名总数为 3160 万个，其中，“.CN”域名数量为 2013 万个；

我国移动电话基站总数达 1162 万个，互联网宽带接入端口数量达 11.36 亿个，光缆线路总长度达 6432 万公里。



### A类地址

A类网络地址的IP地址范围为1.0.0.1－127.255.255.254； 在IP地址的四段号码中，第一段号码为网络号，剩下的三段号码为本地计算机的主机号。

如果用二进制表示IP地址的话，A类IP地址就由1字节的网络地址和3字节主机地址组成，网络地址的最高位必须是“0”。所以默认的子网掩码为：`255.0.0.0`。

A类IP地址中网络的标识长度为7位（第1个字节的最高位固定为0），主机标识的长度为24位。

- **范围：可用的A类网络有126个。每个网络中可以容纳`2^24-2`个，约一亿多个主机。**

- **应用：A类地址分配给规模特别大的网络使用。A类网络用第一个字节表示网络本身的地址，后面三个字节作为连接于网络上的主机地址。例如MS和IBM，阿里这样公司的网络。**

A 类占整个地址空间的 50%。 然而，只有 126 个组织可以分配 A 类网络地址。 有趣的是，每个组织都可以为 16,000,000 台主机提供地址。

超大型组织会分配整个 A 类地址块。时至今日，仍有公司和政府组织拥有 A 类地址。例如，通用电气公司拥有 3.0.0.0/8，苹果电脑公司拥有 17.0.0.0/8，美邮政总局拥有 56.0.0.0/8。

**明明第一个字节有8位！！！为什么可以表示的网络段只有126个？为什么1---127是128个，而网络段只有126个**

A类地址中的**私有地址**和**保留地址**：

① 10.X.X.X是私有地址（所谓的私有地址就是在互联网上不使用，而被用在局域网络中的地址）。

② 127.X.X.X是保留地址，用做循环测试用的。

A类地址默认子网掩码为255.0.0.0 。一个A类IP地址由1字节（每个字节是8位）的网络地址和3个字节主机地址组成，网络地址的最高位必须是“0”,即第一段数字范围为1～127。

每个A类地址理论上可连接16777214台主机，Internet有126个可用的A类地址。

随着IPv4位址枯竭已进入最后阶段，一些组织（如斯坦福大学，以前使用36.0.0.0/8，现在为[APNIC](https://zh.wikipedia.org/wiki/APNIC)拥有）已返还其拥有的块，以推迟地址耗尽时间。

中国共有**7976.6万**个A类IP，全球总共有20.974亿个A类IP地址。中国的A类IP地址占全球的**3.8031%**。

中国作为全球第一大人口大国，其人口13.64亿，占全球72.40亿的**18.84%**。相比之下，A类地址只占全球的**3.8031%**，相差数倍。反观美国，其人口3.226亿，占全球4.46%，其拥有A类地址据说占超过70%。

事实上，IP的地址的分配存浪费现象。比如：给苹果公司分配了17.0.0.0/8，及一个“完整”的A类IP地址，可以代表1677万个主机。然而苹果公司再有能耐，其研发部门、财务部门、市场部门等等部门加起来拥有的主机（电脑）加起来能够达到1677万么？这里还姑且不计算苹果公司的私有地址。再比如：子网划分可以很大程度上合理使用IP地址资源，然而子网划分技术本身又会产生许多无法分配给主机的广播地址（全1）和本网络地址（全0）。因此综上所述，能够真真切切使用A类IP地址的国人，远低于7976.6

### B类地址

一个B类IP地址是指，在IP地址的四段号码中，前两段号码为网络号码，剩下的两段号码为本地计算机的号码。

如果用二进制表示IP地址的话，B类IP地址就由2字节的网络地址和2字节主机地址组成，网络地址的最高位必须是“10”（二进制的10）（1000 0000(128) ——>1011 1111(191)）。

B类IP地址中网络的标识长度为14位(网络号范围:**128.1** ~ **191.255**)，主机标识的长度为16位，B类网络地址适用于中等规模规模的网络，每个网络所能容纳的计算机数为6万多台。

B 类占整个地址空间的 25%。 最多 16,384 个组织可以分配 B 类网络地址，每个网络可以支持 65,534 台主机。

只有那些特大型的公司/组织或政府部门有可能会使用到所有 65,000 个地址。 与 A 类网络类似，B 类地址空间浪费许多 IP 地址。

**私有号段**：172.16.0.0-172.31.255.255

/x  ，x 一般用十进制写法，表示二进制网络地址得前x位是固定的。

比如 ,  /8 ，表示前8位为固定，  192.0.0.0/8 就表示  192.n.n.n

比如 ,  /27 ，表示前27位为固定，  192.168.1.0/27  就表示  192.168.1.n（其中n转为二进制，表示 111x xxxx，二进制前三位是固定的）

又因为最后一部分的 《1110 0000》=128+64+32= 224，所以可以用 255.255.255.224 来表示 /27



该企业办公网络采用172.16.1.0/24地址段，部门终端数量如表1-1所示，请将网络地址规划补充完整。

| 部门   | 终端数量 | IP地址范围                | 子网掩码        |
| ------ | -------- | ------------------------- | --------------- |
| 行政部 | 28       | 172.16.1.1~172.16.1.30    | -1              |
| 市场部 | 42       | -2                        | 255.255.255.192 |
| 财务部 | 20       | -3                        | 255.255.255.224 |
| 业务部 | 120      | 172.16.1.129~172.16.1.254 | -4              |



(1)255.255.255.224

(2)172.16.1.65~172.16.1.126

(3)172.16.1.33-172.16.1.62

(4)255.255.255.128

| 块         | 组织                                                         | https://zh.wikipedia.org/wiki/互联网号码分配局分配日期 | https://zh.wikipedia.org/wiki/区域互联网注册管理机构分配日期 | 注                                                           |
| ---------- | ------------------------------------------------------------ | ------------------------------------------------------ | ------------------------------------------------------------ | ------------------------------------------------------------ |
| 4.0.0.0/8  | https://zh.wikipedia.org/wiki/Level_3通信                    | 1992-12                                                | 1992-12-01                                                   | 最初于1992年12月分配给https://zh.wikipedia.org/wiki/BBN%E7%A7%91%E6%8A%80（后由https://zh.wikipedia.org/w/index.php?title=GTE&action=edit&redlink=1和https://zh.wikipedia.org/w/index.php?title=Genuity_(%E4%BA%92%E8%81%94%E7%BD%91%E5%85%AC%E5%8F%B8)&action=edit&redlink=1继承)。2007年4月起转移至Level 3通信公司。 |
| 8.0.0.0/8  | https://zh.wikipedia.org/wiki/Level_3通信                    | 1992-12                                                | 1992-12-01                                                   | 最初于1992-12分配给https://zh.wikipedia.org/wiki/BBN%E7%A7%91%E6%8A%80（后由https://zh.wikipedia.org/w/index.php?title=GTE&action=edit&redlink=1和https://zh.wikipedia.org/w/index.php?title=Genuity_(%E4%BA%92%E8%81%94%E7%BD%91%E5%85%AC%E5%8F%B8)&action=edit&redlink=1继承)。2007年4月起转移至Level 3通信公司。 |
| 12.0.0.0/8 | https://zh.wikipedia.org/wiki/AT%26T                         | 1995-06                                                | 1983-08-23                                                   | 最初分配给https://zh.wikipedia.org/wiki/AT%26T%E8%B4%9D%E5%B0%94%E5%AE%9E%E9%AA%8C%E5%AE%A4，在贝尔实验室于1996年转让给https://zh.wikipedia.org/wiki/%E6%9C%97%E8%AE%AF%E7%A7%91%E6%8A%80后，由AT&T保留。 |
| 16.0.0.0/8 | https://zh.wikipedia.org/wiki/惠普                           | 1994-11                                                | 1989-05-18                                                   | https://zh.wikipedia.org/wiki/迪吉多，然后是https://zh.wikipedia.org/wiki/康柏，然后是惠普；现在是https://zh.wikipedia.org/wiki/慧與科技和https://zh.wikipedia.org/wiki/惠普公司共享 |
| 17.0.0.0/8 | https://zh.wikipedia.org/wiki/蘋果公司                       | 1992-07                                                | 1990-04-16                                                   |                                                              |
| 19.0.0.0/8 | https://zh.wikipedia.org/wiki/福特汽车                       | 1995-05                                                | 1988-06-15                                                   |                                                              |
| 38.0.0.0/8 | https://zh.wikipedia.org/w/index.php?title=PSINet&action=edit&redlink=1 | 1994-09                                                | 1991-04-16                                                   | 先是PSINet，然后由https://zh.wikipedia.org/wiki/Cogent%E9%80%9A%E4%BF%A1持有。 |
| 44.0.0.0/8 | https://zh.wikipedia.org/w/index.php?title=业余无线电数字通信网络&action=edit&redlink=1 | 1992-07                                                | 1992-07-01                                                   |                                                              |
| 48.0.0.0/8 | https://zh.wikipedia.org/w/index.php?title=保诚金融&action=edit&redlink=1 | 1995-05                                                | 1990-12-07                                                   | 美国https://zh.wikipedia.org/w/index.php?title=%E4%BF%9D%E8%AF%9A%E4%BF%9D%E9%99%A9%E5%85%AC%E5%8F%B8&action=edit&redlink=1 |
| 56.0.0.0/8 | https://zh.wikipedia.org/wiki/美國郵政署                     | 1994-06                                                | 1992-11-02                                                   |                                                              |



### C类地址



一个C类地址由3个字节的网络地址和1个字节的主机地址组成，网路地址的最高位必须是“110”，

也即网络地址的范围是：`11000000.00000000.00000000-11011111.11111111.11111111`转化为10进制为：`192.0.0.0`到`223.255.255.255`，默认的子网掩码为：`255.255.255.0`.

数量：可用的C类网络有：**2^16\*32**个，约有**209万**个。每个网路能容纳的主机个数为：254个。

应用：C类地址一般分配给小型网路，如一般的局域网和校园网，它连接的主机数量比较少，把用户分为若干段进行管理。



C段指的是同一内网段内的其他服务器，每个IP有ABCD四个段，举个例子，192.168.0.1，A段就是192，B段是168，C段是0，D段是1，而C段嗅探的意思就是拿下它同一C段中的其中一台服务器，也就是说是D段1-255中的一台服务器，然后利用工具嗅探拿下该服务器。



**C段扫描：运营商分配给IDC机房地址时大部分都是连续 的 IP地址，租给客户（渗透目标）时很大概率会分配同C段内IP地址（除非目标就一个IP地址），使用工具扫描可以探测出同段服务。**



### 私有地址

在互联网寻址架构中，互联网工程任务组（IETF）和互联网编号分配机构（IANA）为特殊目的保留了各种互联网协议（IP）地址

| 地址块CIDR         | 范围                          | 地址数      | 效用域   | 用途                                                       |
| ------------------ | ----------------------------- | ----------- | -------- | ---------------------------------------------------------- |
| 0.0.0.0/8          | 0.0.0.0 – 0.255.255.255       | 16,777,216  | 软件     | 用于广播信息到当前主机                                     |
| 10.0.0.0/8         | 10.0.0.0 – 10.255.255.255     | 16,777,216  | 专用网络 | 用于专用网络中的本地通信                                   |
| 100.64.0.0/10      | 100.64.0.0 – 100.127.255.255  | 4,194,304   | 专用网络 | 用于在电信级NAT环境中服务提供商与其用户通信                |
| 127.0.0.0/8        | 127.0.0.0 – 127.255.255.255   | 16,777,216  | 主机     | 用于到本地主机的环回地址                                   |
| 169.254.0.0/16     | 169.254.0.0 – 169.254.255.255 | 65,536      | 链路     | 用于单链路的两个主机之间的链路本地地址                     |
| 172.16.0.0/12      | 172.16.0.0 – 172.31.255.255   | 1,048,576   | 专用网络 | 用于专用网络中的本地通信                                   |
| 192.0.0.0/24       | 192.0.0.0 – 192.0.0.255       | 256         | 专用网络 | 用于IANA的IPv4特殊用途地址表                               |
| 192.0.2.0/24       | 192.0.2.0 – 192.0.2.255       | 256         | 文档     | 分配为用于文档和示例中的TEST-NET，不应该被公开使用         |
| 192.31.196.0/24    | 192.31.196.0 - 192.31.196.255 | 256         | 专用网络 | 旨在处理私有使用地址的反向DNS查询，不会出现在公共DNS系统中 |
| 192.52.193.0/24    | 192.52.193.0 - 192.52.193.255 | 256         | 专用网络 | 用于自动组播隧道AMT                                        |
| 192.88.99.0/24     | 192.88.99.0 – 192.88.99.255   | 256         | 互联网   | 用于 6to4 任播中继，已废弃                                 |
| 192.168.0.0/16     | 192.168.0.0 – 192.168.255.255 | 65,536      | 专用网络 | 用于专用网络中的本地通信                                   |
| 192.175.48.0/24    | 192.175.48.0 - 192.175.48.255 | 256         | 专用网络 | 旨在处理私有使用地址的反向DNS查询，不会出现在公共DNS系统中 |
| 198.18.0.0/15      | 198.18.0.0 – 198.19.255.255   | 131,072     | 专用网络 | 用于测试两个不同的子网的网间通信                           |
| 198.51.100.0/24    | 198.51.100.0 – 198.51.100.255 | 256         | 文档     | 分配为用于文档和示例中的TEST-NET-2，不应该被公开使用       |
| 203.0.113.0/24     | 203.0.113.0 – 203.0.113.255   | 256         | 文档     | 分配为用于文档和示例中的TEST-NET-3，不应该被公开使用       |
| 240.0.0.0/4        | 240.0.0.0 – 255.255.255.254   | 268,435,455 | 互联网   | 用于将来使用                                               |
| 255.255.255.255/32 | 255.255.255.255               | 1           | 子网     | 用于受限广播地址                                           |





### 子网划分/VLSM

IP地址的数量是有限的、紧缺的。当网络规模较少，不足以使用一个主类网地址段的时候，会产生地址浪费。

- 比如网络中只有2台主机，这个网络只需要2个IP地址，但是最小的主类网C类网的每个网段拥有254个可用地址，这样就会浪费252个地址。

- 比如网络中有260台主机，主类网C类网无法满足，B类网每个网段拥有65534个可用地址，这样就会产生非常多的浪费。当前，也可以分配2个C类网的网段，减少浪费，不过浪费还是不可避免的。

所以，在实际网络中，子网划分的必须要做的。



子网允许将一个大的网络划分成许多小的网络，以方便使用和管理。并且在一个企业或组织内部可以将子网应用到不同的部门，这样使得网络更加合理。

子网将一部分主机部分拿出来作为子网部分，俗称“借位”，从而形成一种新的IP地址结构，即在IP地址的网络部分和主机部分之间又出现了子网部分。



如何实现？1个IP地址如何区分它的网络部分（含子网部分）和主机部分？不同的IP地址又是如何区分它们是否在同一网段？这里说同一网段，一般是指同一个子网段。

子网划分的术语叫做VLSM（可变长子网掩码，Variable Length Subnet Mask），这里的子网掩码，又称为网络掩码，就是来解决子网划分的问题。

子网掩码和IP地址一样也是32位，用二进制表示是一堆连续的1、后面接一堆连续的0。值为1的位对应IP地址中的网络部分（含子网部分）；值为0的位对应主机部分。当然，子网掩码，也可以用点分十进制表示，或者直接用掩码长度表示。







通过将IP地址的网络部分进一步划分为若干个子网，解决了IP地址空间利用率低和两级IP地址不够灵活的问题。

当一个单位的主机很多时，为了便于管理，可将单位内部的主机号码再进一步划分为多个子网。通过子网划分，整个网络地址可以划分成更多的小网络。

子网的划分是网络内部的行为，从外部看，这个单位只有一个网络号码。只有当外部的报文进入到本单位范围后，本单位的路由设备才根据子网号码再进行选路，找到目的主机。



通过改变ip的掩码长度来改变ip的网络地址，把原来的ip地址从网络位+主机位，改成网络位+子网位+主机位。从而达到缩小主机个数或者扩大主机个数。

缩小主机位，可以避免ip资源的浪费，减小广播域，提高效率。扩大主机位可以使节点的路由条目简化。

就是借用ip地址四段中某一段，使得这段既有网络位又有主机位。



我们知道，ip地址用32位二进制数字表示，为了方便记忆，每8位用十进制数据和.来分开，如222.90.12.24，分为四段，每段的取值是在0-255间。

公网ip是用来寻址和定位某一台设备。



### 网络规划案例



https://blog.csdn.net/m0_63624418/article/details/133420879



## 网络层概述



## 路由

当路由器收到一个IP数据包，路由器会根据数据包的目的IP地址查找FIB（Forwarding Information Base，转发信息库）表，找到“最匹配”的路由条目后，将数据包根据路由条目所指示的出接口或下一跳转发出去。

路由就是报文从源端到目的端的路径。当报文从路由器到目的网段有多条路由可达时，路由器可以根据路由表中最佳路由进行转发。

最佳路由的选取与发现此路由的路由协议的优先级、路由的度量有关。当多条路由的协议优先级与路由度量都相同时，可以实现负载分担，缓解网络压力；

 路由器获取路由的方式有三种，分别是动态路由（例如OSPF）、静态路由、直连路由。一个网络中可能会同时存在这三种方式，那么采用不同方式获取路由的路由器之间如何实现路由可达？

当多条路由的协议优先级与路由度量不同时，可以构成路由备份，提高网络的可靠性。









### 路由表和转发表

路由器转发数据包的关键是路由表和FIB表，每个路由器都至少保存着一张路由表和一张FIB（Forwarding Information Base）表。路由器通过路由表选择路由，通过FIB表指导报文进行转发。

- **路由表**被称为路由信息库（Routing Information Base，简称RIB）
- **转发表**被称为转发信息库（Forwarding Information Base，简称FIB）





路由表是一个存储在路由器或者我们计算机中的电子表格或类数据库。路由表存储着指向特定网络地址的路径（在有些情况下，还记录有路径的路由度量值。）



| 路由字段    | 备注                                                       |      |
| ----------- | ---------------------------------------------------------- | ---- |
| Destination | 目标，标识报文的目标地址/目标网络                          |      |
| Mask        | 掩码，选择路由的重要判断依据（最长匹配原则）               |      |
| Protocol    | 协议类型，标明该路由条目的来源，学习方式                   |      |
| Preference  | 优先级，比较不同路由来源到达相同目标网络的优先级           |      |
| Cost        | 开销，比较形相同路由来源到达相同目标网络的不同路径的优先级 |      |
| NextHop     | 下一跳，指明IP报文所经由下一个路由设备的接口地址           |      |
| Interface   | 出接口，指明IP报文从当前路由器的哪个接口转发出去           |      |



- 目的地址Destination：标识目的地址
- 掩码Mask：与目的地址共同标识一个网段
  - 将目的地址和掩码一起可以计算出目标网段
- 协议Protocol：该路由的协议类型，也即路由器是通过什么协议获知该路由的。
- 优先级Preference：表示此路由的路由协议优先级。
  - 针对同一目的地，可能存在不同下一跳、出接口等多条路由，这些不同的路由可能是由不同的路由协议发现的，也可以是手工配置的静态路由。优先级最高（数值最小）者将成为当前的最优路由。
  - 当路由器从多种不同的途径获知到达同一个目的网段的路由（这些路由的目的网络地址及网络掩码均相同）时，路由器会比较这些路由的优先级，优选优先级值最小的路由。
  - 路由来源的优先级值（Preference）越小代表加入路由表的优先级越高。
  - 拥有最高优先级的路由将被添加进路由表。
- 路由开销Cost：当到达同一目的地的多条路由具有相同的路由优先级时，路由开销最小的将成为当前的最优路由。

- 下一跳NextHop：
- 出接口Interface：和下一跳同理，不过唯一区别就是出接口指的是自己本地出去的接口，而下一跳是直连路由器的ip地址，一个是接口，一个是IP地址，一个是本地，一个是下一路由器。







### 静态路由和动态路由

路由器不仅支持静态路由，同时也支持RIP（Routing Information Protocol）、OSPF（Open Shortest Path First）、IS-IS（Intermedia System-Intermedia System）和BGP（Border Gateway Protocol）等动态路由协议。



### 静态路由与动态路由的区别

路由协议是路由器之间维护路由表的规则，用于发现路由，生成路由表，并指导报文转发。依据来源的不同，路由可以分为三类：

- **直连路由**：通过链路层协议发现的路由。
- **静态路由**：通过网络管理员手动配置的路由。
- **动态路由**：通过动态路由协议发现的路由。



**静态路由**配置方便，对系统要求低，适用于拓扑结构简单并且稳定的小型网络。缺点是不能自动适应网络拓扑的变化，需要人工干预。

动态路由协议有自己的路由算法，能够自动适应网络拓扑的变化，适用于具有一定数量三层设备的网络。缺点是配置对用户要求比较高，对系统的要求高于静态路由，并将占用一定的网络资源和系统资源。



### 动态路由的分类

对动态路由协议的分类可以采用以下不同标准：

根据作用范围不同，路由协议可分为：

- 内部网关协议IGP（Interior Gateway Protocol）：在一个自治系统内部运行。常见的IGP协议包括RIP、OSPF和IS-IS。
- 外部网关协议EGP（Exterior Gateway Protocol）：运行于不同自治系统之间。BGP是目前最常用的EGP协议。

根据使用算法不同，路由协议可分为：

- 距离矢量协议（Distance-Vector Protocol）：包括RIP和BGP。其中，BGP也被称为路径矢量协议（Path-Vector Protocol）。
- 链路状态协议（Link-State Protocol）：包括OSPF和IS-IS。





### 路由优先级



| 路由来源   | 路由类型       | 默认优先级（数字越小，优先级越高） |
| ---------- | -------------- | ---------------------------------- |
| 直连Direct | 直连路由Direct | 0                                  |
| 静态Static | 静态路由Static | 60                                 |
| 动态       | OSPF内部路由   | 10                                 |
| 动态       | RIP            | 100                                |
| 动态       | OSPF外部路由   | 50                                 |
|            |                |                                    |

如果是思科，静态优于其他，仅次于直连。



具备路由功能的华为数通产品（如路由器、三层交换机等），都维护着两种重要的数据表：RIB与FIB。

为了提高转发性能。接口板其实是有自己的专用处理器（华为叫NP，网络处理器），可对报文进行硬件级转发。所以各个接口板其实是并行工作的，可以做到线速转发。





**最长匹配原则**

将数据包的目的IP地址与自己本地路由表中的所有路由表项进行**逐位(bit-by-bit)比对**，直到找到**匹配度最长**的条目。

`dis ip routing-table 192.168.2.1` 查看路由匹配情况，显示与目的地址最长匹配的路由表项。

- 对于**display ip routing-table** *ip-address*，显示与目的地址最长匹配的路由表项。
- 对于**display ip routing-table** *ip-address* *mask*，显示与目的地址和掩码精确匹配的路由表项。
- 对于**display ip routing-table** *ip-address* **longer-match**，显示与目的地址和自然掩码指定的IP地址匹配的所有路由表项。
- 对于**display ip routing-table** *ip-address* *mask* **longer-match**，显示与目的地址和输入掩码指定的IP地址匹配的所有路由表项。
- 对于**display ip routing-table** *ip-address1* *mask1* *ip-address2* *mask2*，该命令用来查看目的地址在输入的*ip-address1* *mask1*到*ip-address2* *mask2*范围内的路由表项。

### ECMP等价路由

多条路由的优先级和路由度量都相同时，这几条路由就称为等价路由。多条等价路由可以实现负载分担。

即根据五元组（源地址、目的地址、源端口、目的端口、协议）进行转发，当五元组相同时，路由器总是选择与上一次相同的下一跳地址发送报文。当五元组不同时，路由器会选取相对空闲的路径进行转发。

**现代路由的构成**

现代路由器一般是采用控制面与承载面分离的设计。高效分工、各司其职。

- 控制面：即路由器的CPU。主要是处理路由协议（ospf、ISIS、BGP）等决策性工作。

- 承载面：即接口、交换模块。进行具体的包转发工作。



各自职责：控制面作为“领导”，确定战略方向后，将工作细化成可执行的单元，下发给接口板上的转发信息表FIB。

报文到达时，各个接口直接查询FIB就能完成傻瓜似的转发。



![img](https://pic1.zhimg.com/80/v2-46603126f3781bdf27ff37bcee955824_720w.jpg?source=1940ef5c)







路由器数据转发过程



- 入接口处理（接口板）
  - 路由器收到这个报文，链路层将物理层的比特流解析为帧。如果报文的目的地址是路由器本身（包括MAC地址、PPP等），则进行三层解析。

- 三层解析、查路由表

  - 路由器进一步解析报文，得知帧所承载的协议类型为IPv4（协议类型值=0x800），即需要进行IPv4转发；

  - 查路由表（实际是接口板的FIB表），得知该报文并不是发给自己的，而是需要送往出端口Port2，因此，路由器不再继续分析IP头后面的内容。
- 出接口处理
  - IP报文的二层已经被剥离，但三层的源IP\目的IP是没有被修改过的（IP的TTL要减一）。
  - **需要确定二层的源地址、目的地址。**（**在发送报文时，路由器需要确定出接口上二层的源地址、目的地址。**）
  - 然后封装二层信息，从出接口发送出去。



- 数据平面

  - 数据平面功能，即网络层中每台路由器的功能，该数据平面功能决定到达路由器输入链路之一的数据报（即网络层的分组）如何转发到该路由器的输出链路之一。
  - **转发**：是指将分组从一个输入链路接口转移到适当的输出链路接口的路由器本地动作。时间短（几纳秒），通常用硬件来实现。
    - 转发是一个节点在本地执行的一个相对简单的过程，即报文从某台设备的一个端口进入而从另一个端口出去。
  - **路由选择**：是指确定分组从源到目的地所采取的的端到端路径的网络范围处理过程。时间长（几秒），通常用软件来实现。

  

- 控制平面
  
  网络层的控制平面的功能，即网络范围的逻辑，该控制平面功能控制数据报沿着从源主机到目的主机的端到端路径中路由器之间的路由方式。涉及到路由选择算法，以及广泛用于今天因特网中的诸如OSPF和BGP等路由选择协议。
  
  传统方法：由路由器的硬件使用路由选择算法决定插入该转发表的内容。控制平面路由选择协议和数据平面转发功能已经被实现成一个整体，位于一台路由器中。
  
  软件定义网络（Software-Defined Networking，SDN）通过将这些控制平面功能作为一种单独的服务，明确地分离数据平面和控制平面，控制平面功能通常置于一台远程控制器中。



https://www.zhihu.com/question/23328152



**路由表**







## 旁路由





## TTL

生存时间 (TTL) 是指数据包在被路由器丢弃之前可存在于网络内部的时间或“跃点”数。特指在网络层。

IP数据包被创建并通过 Internet 发送时，有可能持续无限期地在路由器之间传递。

IPv4数据包下存在 TTL（Time To Live）这一字段，数据包每经过一个路由器（即经过一个网段），该TTL值就会减一。



为了减轻这种可能性，数据包在设计时带有称为生存时间或跃点限制的到期时间。

数据包 TTL 可用于确定数据包已流通多长时间，并允许发送方通过 Internet 接收有关数据包路径的信息。

TTL 的设计原本是为了**防止网络出现环路**，限制一个包能被转发的最大次数。



设备（比如路由器）在转发IP数据包的时候会把 TTL 减 1，如果 TTL 还是大于 0，才会转发出去；

如果等于 0，包还没有到达目的地，设备就会丢弃这个包（然后可能发一个 ICMP 告诉 Src IP 这个包因为 TTL 减到 0 而寿终正寝了）。

当其存活次数为0时，路由器便会取消该数据包转发，IP网络的话，会向原数据包的发出者发送一个ICMP TTL数据包以告知跃点数超限。



常用的网络命令 ping 和 traceroute 都使用 TTL。使用 traceroute 命令时，一串剩余计数越来越高的 TTL 的数据包流将通过 Internet 发送到目的地。

由于连接的每一步都是其中一个数据包的最后一站，因此每个位置都会在丢弃数据包后向发送方返回 ICMP 消息。

然后，ICMP 消息返回到发送方所花费的时间就可以用于确定到达网络上每个连续跃点所花费的时间。



**为什么三层 IP 协议会有一个 TTL 字段，但是二层没有呢？**



TTL 这个机制只能作为防环的一种最后手段，并没有解决问题。在三层上讲，假设一个包的 TTL 被从 64 减到 0 最后丢弃了，那么包已经经过了 64 次转发，这些工作量已经被浪费掉了。在二层上讲，环路一旦出现，损失就更大了，每次转发流量都会被放大好几倍，可以想象，即使有  TTL，出现环路的话一个包也会被转发成千上万次，也不会有什么改善。



为什么三层还要有  TTL？因为二层网络一般是一个组织控制的，一个公司有多个网络，自己内部想怎么设计都可以。跨组织之间一般是三层，通过路由协议（最流行的是  BGP）来交换路由信息。一个网络内，我们可以通过技术手段保证没有环路，并对此负责。但是三层方面，我们不能保证邻居的网络没问题，不能保证他们不会把错误的包发送回来导致环路，所以 TTL 是一个在全局层面上，作的最后一个防线。





**TTL的典型应用**



**禁止共享网络**

某校园网，相信大家都知道是禁止单一账号下多设备同时访问互联网的，具体表现为 1 个账号只能同时让 1 台有线设备和 1 台无线设备接入互联网，这给我们一些拥有多设备的同学带来了很大的不便，因此不少同学想到了使用家用路由器的方式来解决这个问题，然而校园网会进行共享上网检测，一旦发现一个 IP 下有多个不同设备的流量，就会封禁账号 2-8 小时不等，害的同学们怨声载道。



对于家用的上网资费，平均一年就要数百甚至上千元人民币，而校园网的资费一般都很低，如果一个宿舍只用一个账号一个路由器就可以实现全员上网的话，那 ISP 肯定要亏死，因此肯定会封禁像路由器这种设备的。





ISP 在把 IP 包转发给用户这边的时候，无论 TTL 还剩下多少，都改成 1 才转发给用户。这样，用户的设备**可以收到包却不能转发**。

因为设备（比如路由器）在转发包的时候会把 TTL 减 1，如果 TTL 还是大于 0，才会转发出去；如果等于 0，就会直接丢弃。

**即，网络上是不存在 TTL=0 的包的，这是协议规定的。**

不同的操作系统的默认 TTL 值是不同的，Windows 是 128， macOS/iOS、Linux 是 64。

因此如果我们自己接入路由器到校园网，我们的通过路由器的数据包会变为 127 或 63，一旦校园网抓包检测到这种数据包TTL不是128或64，就会判定为用户接入了路由器。



**共享上网检测机制的研究**

目前已知的（可能）存在的有：

- 基于 IPv4 数据包包头内的 TTL 字段的检测
- 基于 HTTP 数据包请求头内的 User-Agent 字段的检测
- DPI (Deep Packet Inspection) 深度包检测技术
- 基于 IPv4 数据包包头内的 Identification 字段的检测
- 基于网络协议栈时钟偏移的检测技术
- Flash Cookie 检测技术



## Linux协议栈



https://arthurchiao.art/blog/linux-net-stack-zh/



### 收包流程

1. 网卡驱动初始化
2. 数据包到达网卡 NIC(Network Interface Card)
3. NIC 检验 MAC 网卡(网卡非混杂模式)和帧的校验字段





#### 网卡驱动初始化

网卡成功完成初始化之后，数据包通过网线到达网卡时，才能被正确地收起来送到更上层去处理。 因此，我们的工作必须从网卡初始化开始，更准确地说，就是**网卡驱动模块的初始化**。 这一过程虽然是**厂商相关**的，但是非常重要；弄清楚了网卡驱动的工作原理， 才能对后面的部分有更加清晰的认识和理解。

网卡驱动一般都是作为独立的**内核模块**（kernel module）维护



#### 数据包到达网卡



#### 网卡校验数据帧地址

NIC 会校验收到数据包的目的 MAC 地址是不是自己的 MAC 地址，在网卡非混杂模式下，MAC 地址不是自己的数据包通常就会丢弃。



帧的校验字段 FCS（Frame Check Sequence 帧校验序列）

校验完 MAC 地址之后 NIC 还会校验帧的校验字段 FCS，一次来确保接收到的数据包是正确的，如果校验失败就直接丢弃数据包



以太网卡有两种工作模式：正常模式和混杂模式。

- 网卡在正常模式下，处于非侦听状态，只能接收到发给自己的数据包和广播包，而丢弃其他包。

- 混杂模式下，使网卡工作在侦听状态时，网卡就具有了广播地址，可以接收流经该网卡的所有数据包，而不管数据包的目的 MAC 地址是不是与网卡本身一致。 



使用非混杂模式的场景：

- 抓包
- 虚拟机
- 抓包程序会把网卡设置为非混杂模式，因此抓包程序需要 root 权限，没有 root 权限无法修改硬件设备的配置。

校验完 MAC 地址之后 NIC 还会校验帧的校验字段 FCS，一次来确保接收到的数据包是正确的，如果校验失败就直接丢弃数据包







#### NIC 将数据包的引用放入接收的 ring buffer

单CPU处理网络IO存在瓶颈，目前经常使用网卡多队列提高性能。

通常情况下，每张网卡有一个队列(queue)，所有收到的包从这个队列入， 内核从这个队列里取数据处理。

该队列其实是ring buffer(环形队列)，内核如果取数据不及时，则会存在丢包的情况。

一个CPU处理一个队列的数据，这个叫中断。默认是cpu0(第一个CPU)处理， 一旦流量特别大， 这个CPU负载很高， 性能存在瓶颈。

在多核CPUI上，网卡开发了多队列功能，即一个网卡有多个队列，收到的包根据TCP四元组信息hash后放入其中一个队列，后面该链接的所有包都放入该队列。

每个队列对应不同的中断，使用irqbalance将不同的中断绑定到不同的核。充分利用了多核并行处理特性，提高了效率。







#### CPU 执行硬件中断和网卡的驱动程序



网卡接收到数据包后，会通过**硬件中断(IRQ)**的方式，通知内核有新的数据到了。这时内核就应该调用中断处理程序来响应它。

- 对上半部来说，既然是快速处理，其实就是要把网卡的数据读到内存中，然后更新一下硬件寄存器的状态（表示数据已经读好了）。最后再发送一个软中断信号，通知下半部做进一步的处理。
- 下半部被软中断信号唤醒后，需要从内存中找到网络数据，再按照网络协议栈，对数据进行逐层解析和处理，直到把它送给应用程序。

实际上，上半部会打断 CPU 正在执行的任务，然后立即执行中断处理程序。而下半部以内核线程的方式执行。

并且每个 CPU 都对应一个软中断内核线程，名字为 “ksoftirqd/CPU 编号”，比如说， 0 号 CPU 对应的软中断内核线程的名字就是 ksoftirqd/0。







## 网络服务模型和QOS



随着网络技术的飞速发展，IP网络已经从当初的单一数据网络向集成数据、语音、视频、游戏的多业务网络转变。网络中所承载的数据呈几何级倍数增长，而且这些业务对网络带宽、时延有着极高的要求。

同时，由于硬件芯片研发的难度大、周期长、成本高等原因，带宽逐渐成为互联网发展的瓶颈，导致网络发生拥塞，产生丢包，业务质量下降，严重时甚至造成业务不可用。

所以，要在IP网络上开展这些实时性业务，就必须解决网络拥塞问题。



解决网络拥塞的最好的办法是增加网络的带宽。但从运营、维护的成本考虑，一味增加网络带宽是不现实的，最有效的解决方案就是应用一个“有保证”的策略对网络拥塞进行管理。



QoS（Quality of Service，服务质量）技术就是在这种背景下发展起来的。

QoS技术本身不会增加网络带宽，而是在有限的带宽资源下，如何平衡地为各种业务分配带宽，针对各种业务的不同需求，为其提供端到端的服务质量保证。



QOS的度量指标

既然要提高网络质量，首先我们需要了解一下哪些因素会影响网络的服务质量。从传统意义上来讲，影响网络质量的因素包括：

- 带宽/吞吐量
- 时延
- 时延变化（抖动）
- 丢包率

因此，要提高网络的服务质量，就可以从保证传输链路的带宽，降低报文传送的时延和抖动，降低丢包率等方面着手。而这些影响网络服务质量的因素，也就成为QoS的度量指标。







### QoS服务模型

QoS模型不是一个具体功能，而是端到端QoS设计的一个方案。例如，网络中的两个主机通信时，中间可能会跨越各种各样的设备。

只有当网络中所有设备都遵循统一的QoS服务模型时，才能实现端到端的质量保证。IETF、ITU-T等国际组织都为自己所关注的业务设计了QoS模型。

- 尽力而为（Best-Effort）服务模型
- 综合服务（Integrated Service，简称IntServ）模型
- 差分服务（Differentiated Service，简称DiffServ）模型



#### 尽力而为（Best-Effort）服务模型

Best-Effort是最简单的QoS服务模型，应用程序可以在任何时候，发出任意数量的报文，而且不需要通知网络。对Best-Effort服务，网络尽最大的可能性来发送报文，但对时延、可靠性等性能不提供任何保证。

Best-Effort服务模型适用于对时延、可靠性等性能要求不高的业务质量保证。Best-Effort现在Internet的缺省服务模型，它适用于绝大多数网络应用，如FTP、E-Mail等。

在理想状态下，如果有足够的带宽，Best-Effort是最简单的服务模式。而实际上，这种“简单“带来一定的限制。因此，Best-Effort适用于对时延、可靠性等性能要求不高的业务，如FTP、E-Mail等。



#### 综合服务（IntServ）模型

由于网络带宽的限制，Best-Effort服务模型不能为一些实时性要求高的业务提供有力的质量保障，于是IETF在1994年的RFC1633中提出了InterServ模型。

IntServ模型是指用户在发送报文前，需要通过信令（Signaling）向网络描述自己的流量参数，申请特定的QoS服务。网络根据流量参数，预留资源（如带宽、优先级）以承诺满足该请求。

在收到确认信息，确定网络已经为这个应用程序的报文预留了资源后，用户才开始发送报文。

用户发送的报文应该控制在流量参数描述的范围内。网络节点需要为每个流维护一个状态，并基于这个状态执行相应的QoS动作，来满足对用户的承诺。









# 网络设备



**在企业组网中，防火墙，路由器，交换机是不可缺少的三大件。**



### 防火墙

防火墙通俗讲是用于控网络之间的隔离，专业讲是用于保护一个安全区域免受另外一个安全区域的网络攻击和入击行为。

从防火墙的定义中可以看出防火墙是基于安全区域的，其它厂商（Cisco,Juniper等）都是有这个概念的。

安全区域（Security Zone），也称为区域（Zone），是一个逻辑概念，用于管理防火墙设备上安全需求相同的多个接口，也就是说它是一个或多个接口的集合。



### 路由器



路由器是连接两个或多个网络的硬件设备，在网络间起[网关](https://baike.baidu.com/item/网关/98992)的作用，是读取每一个数据包中的地址然后决定如何传送的专用智能性的网络设备。

它能够理解不同的协议，例如某个局域网使用的以太网协议，因特网使用的[TCP/IP](https://baike.baidu.com/item/TCP%2FIP/214077)协议。这样，路由器可以分析各种不同类型网络传来的数据包的目的地址，把非TCP/IP网络的地址转换成TCP/IP地址。

或者反之；再根据选定的[路由算法](https://baike.baidu.com/item/路由算法/2709757)把各数据包按最佳路线传送到指定位置。所以路由器可以把非TCP/ IP网络连接到[因特网](https://baike.baidu.com/item/因特网/114119)上。

路由器可以割分广播域，路由器一个接口就是一个广播域（如：我们可以把路由器每个接口配置一个网段）



### 交换机

交换机的作用是放到路由器后端,来扩展路由器接口不够用而使用的。交

换机分为两种：二层交换机和三层交换机：

二层交换机：是我们比较常用的家廷傻瓜交换机，不需要做任何配置，直接插上去就可以使用，主要用来做网口的扩展。

三层交换机：拥有很强二层数据处理能力，工作在OSI网络标准模型的第三层：网络层。三层交换机的最重要目的是加快大型局域网内部的数据交换，同时具备vlan功能。

可以把大型局域网按功能或地域等因素划成一个个小的局域网，减小广播风暴的危害。

